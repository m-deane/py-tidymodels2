

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>py_workflows.workflow &mdash; py-tidymodels 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            py-tidymodels
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#installation-steps">Installation Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#clone-the-repository">1. Clone the Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#create-virtual-environment">2. Create Virtual Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#install-package">3. Install Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/installation.html#development-installation-editable">Development Installation (Editable)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/installation.html#standard-installation">Standard Installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#install-optional-dependencies">4. Install Optional Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#verify-installation">5. Verify Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#jupyter-notebook-setup">Jupyter Notebook Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#development-installation">Development Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#prophet-installation-issues">Prophet Installation Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#windows-issues">Windows Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#import-errors">Import Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#kernel-not-found-in-jupyter">Kernel Not Found in Jupyter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/quickstart.html">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#basic-regression">Basic Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#time-series-forecasting">Time Series Forecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#feature-engineering-with-recipes">Feature Engineering with Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#hyperparameter-tuning">Hyperparameter Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#multi-model-comparison">Multi-Model Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#model-stacking">Model Stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/concepts.html">Core Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#architecture-overview">Architecture Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#layer-1-py-hardhat">Layer 1: py-hardhat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#layer-2-py-parsnip">Layer 2: py-parsnip</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#layer-3-py-rsample">Layer 3: py-rsample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#layer-4-8-higher-level-tools">Layer 4-8: Higher-Level Tools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#key-design-principles">Key Design Principles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#immutability">Immutability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#composability">Composability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#method-chaining">Method Chaining</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#standardized-outputs">Standardized Outputs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#data-flow">Data Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#training-flow">Training Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#prediction-flow">Prediction Flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#working-with-formulas">Working with Formulas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#basic-formulas">Basic Formulas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#categorical-variables">Categorical Variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#working-with-recipes">Working with Recipes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#recipe-workflow">Recipe Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#why-prep-bake">Why prep/bake?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#time-series-considerations">Time Series Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#date-column-handling">Date Column Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#raw-vs-standard-path">Raw vs Standard Path</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#panel-grouped-modeling">Panel/Grouped Modeling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#nested-approach">Nested Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#global-approach">Global Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#when-to-use-each">When to Use Each</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/recipes.html">Recipe Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#what-are-recipes">What Are Recipes?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#the-prep-bake-pattern">The prep/bake Pattern</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#basic-workflow">Basic Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#why-separate-prep-and-bake">Why Separate prep and bake?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#recipe-steps-by-category">Recipe Steps by Category</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#imputation-steps">Imputation Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#normalization-steps">Normalization Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#encoding-steps">Encoding Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#feature-engineering-steps">Feature Engineering Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#filtering-steps">Filtering Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#time-series-steps">Time Series Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#complete-example">Complete Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#real-world-pipeline">Real-World Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#time-series-example">Time Series Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#selectors">Selectors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#built-in-selectors">Built-in Selectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#custom-selection">Custom Selection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#order-of-operations">Order of Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#avoid-data-leakage">Avoid Data Leakage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#reuse-prepped-recipes">Reuse Prepped Recipes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#common-patterns">Common Patterns</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#handling-missing-data">Handling Missing Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#dealing-with-skewness">Dealing with Skewness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#reducing-dimensionality">Reducing Dimensionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#rare-categories">Rare Categories</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/time_series.html">Time Series Modeling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#time-series-models">Time Series Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#native-time-series-models">Native Time Series Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#hybrid-models">Hybrid Models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#data-preparation">Data Preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#date-column-handling">Date Column Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#time-series-splits">Time Series Splits</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#feature-engineering-for-time-series">Feature Engineering for Time Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#lagged-features">Lagged Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#rolling-statistics">Rolling Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#time-features">Time Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#differencing">Differencing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#complete-examples">Complete Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#prophet-forecasting">Prophet Forecasting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#arima-with-auto-selection">ARIMA with Auto Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#recursive-ml-forecasting">Recursive ML Forecasting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#using-ml-models-for-time-series-regression">Using ML Models for Time Series Regression</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#random-forest-example">Random Forest Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#gradient-boosting-example-xgboost-lightgbm-catboost">Gradient Boosting Example (XGBoost/LightGBM/CatBoost)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#support-vector-machines-example">Support Vector Machines Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#k-nearest-neighbors-example">k-Nearest Neighbors Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#neural-network-mlp-example">Neural Network (MLP) Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#feature-engineering-for-ml-time-series-models">Feature Engineering for ML Time Series Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#understanding-the-three-dataframe-output">Understanding the Three-DataFrame Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#comparing-multiple-ml-models">Comparing Multiple ML Models</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#panel-grouped-time-series">Panel/Grouped Time Series</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#hyperparameter-tuning-for-time-series">Hyperparameter Tuning for Time Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#cross-validation">Cross-Validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#check-stationarity">Check Stationarity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#handle-seasonality">Handle Seasonality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#validate-on-holdout">Validate on Holdout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#check-residuals">Check Residuals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#use-appropriate-metrics">Use Appropriate Metrics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#common-issues">Common Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#missing-dates">Missing Dates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#irregular-frequency">Irregular Frequency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#multiple-seasonality">Multiple Seasonality</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/tuning.html">Hyperparameter Tuning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#grid-types">Grid Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/tuning.html#regular-grid">Regular Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/tuning.html#random-grid">Random Grid</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#analyzing-results">Analyzing Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#time-series-tuning">Time Series Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/workflows.html">Workflow Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#basic-workflow">Basic Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#method-chaining">Method Chaining</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#with-recipes">With Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#panel-grouped-models">Panel/Grouped Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/workflows.html#nested-approach">Nested Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/workflows.html#global-approach">Global Approach</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#extracting-components">Extracting Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/visualization.html">Visualization Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#basic-usage-pattern">Basic Usage Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#forecast-visualization">Forecast Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/visualization.html#plot-forecast">plot_forecast()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/visualization.html#plot-forecast-multi">plot_forecast_multi()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#residual-diagnostics">Residual Diagnostics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/visualization.html#plot-residuals">plot_residuals()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#model-comparison">Model Comparison</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/visualization.html#plot-model-comparison">plot_model_comparison()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#hyperparameter-tuning-visualization">Hyperparameter Tuning Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/visualization.html#plot-tune-results">plot_tune_results()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#saving-and-exporting-plots">Saving and Exporting Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#advanced-customization">Advanced Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#api-reference">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#examples">Examples</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html">Complete API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#linear-generalized-models">Linear &amp; Generalized Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#linear-reg">linear_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#poisson-reg">poisson_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#gen-additive-mod">gen_additive_mod()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#tree-based-models">Tree-Based Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#decision-tree">decision_tree()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#rand-forest">rand_forest()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#boost-tree">boost_tree()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#support-vector-machines">Support Vector Machines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#svm-rbf">svm_rbf()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#svm-linear">svm_linear()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#instance-based-models">Instance-Based Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#nearest-neighbor">nearest_neighbor()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#mars">mars()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#mlp">mlp()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#time-series-models">Time Series Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#arima-reg">arima_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#prophet-reg">prophet_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#exp-smoothing">exp_smoothing()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#seasonal-reg">seasonal_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#recursive-reg">recursive_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#varmax-reg">varmax_reg()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#hybrid-time-series-models">Hybrid Time Series Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#arima-boost">arima_boost()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#prophet-boost">prophet_boost()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#generic-hybrid-models">Generic Hybrid Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#hybrid-model">hybrid_model()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#baseline-models">Baseline Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#null-model">null_model()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#naive-reg">naive_reg()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#manual-coefficient-models">Manual Coefficient Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#manual-reg">manual_reg()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#cross-cutting-concepts">Cross-Cutting Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#engine-selection">Engine Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#mode-setting">Mode Setting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#tunable-parameters">Tunable Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#prediction-types">Prediction Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#output-structure">Output Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#formula-syntax">Formula Syntax</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#model-selection-guide">Model Selection Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#computational-complexity">Computational Complexity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#memory-usage">Memory Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#parallelization">Parallelization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#common-workflows">Common Workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#basic-regression">Basic Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#time-series-forecasting">Time Series Forecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#hyperparameter-tuning">Hyperparameter Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#multi-model-comparison">Multi-Model Comparison</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/hardhat.html">py-hardhat: Data Preprocessing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/hardhat.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint"><code class="docutils literal notranslate"><span class="pre">Blueprint</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.formula"><code class="docutils literal notranslate"><span class="pre">Blueprint.formula</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.roles"><code class="docutils literal notranslate"><span class="pre">Blueprint.roles</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.factor_levels"><code class="docutils literal notranslate"><span class="pre">Blueprint.factor_levels</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.column_order"><code class="docutils literal notranslate"><span class="pre">Blueprint.column_order</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.ptypes"><code class="docutils literal notranslate"><span class="pre">Blueprint.ptypes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.intercept"><code class="docutils literal notranslate"><span class="pre">Blueprint.intercept</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.indicators"><code class="docutils literal notranslate"><span class="pre">Blueprint.indicators</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.design_info"><code class="docutils literal notranslate"><span class="pre">Blueprint.design_info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.outcome_design_info"><code class="docutils literal notranslate"><span class="pre">Blueprint.outcome_design_info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id0"><code class="docutils literal notranslate"><span class="pre">Blueprint.formula</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id1"><code class="docutils literal notranslate"><span class="pre">Blueprint.roles</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id2"><code class="docutils literal notranslate"><span class="pre">Blueprint.factor_levels</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id3"><code class="docutils literal notranslate"><span class="pre">Blueprint.column_order</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id4"><code class="docutils literal notranslate"><span class="pre">Blueprint.ptypes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id5"><code class="docutils literal notranslate"><span class="pre">Blueprint.intercept</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id6"><code class="docutils literal notranslate"><span class="pre">Blueprint.indicators</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id7"><code class="docutils literal notranslate"><span class="pre">Blueprint.design_info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id8"><code class="docutils literal notranslate"><span class="pre">Blueprint.outcome_design_info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.__post_init__"><code class="docutils literal notranslate"><span class="pre">Blueprint.__post_init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.__init__"><code class="docutils literal notranslate"><span class="pre">Blueprint.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData"><code class="docutils literal notranslate"><span class="pre">MoldedData</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.outcomes"><code class="docutils literal notranslate"><span class="pre">MoldedData.outcomes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.predictors"><code class="docutils literal notranslate"><span class="pre">MoldedData.predictors</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.blueprint"><code class="docutils literal notranslate"><span class="pre">MoldedData.blueprint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.extras"><code class="docutils literal notranslate"><span class="pre">MoldedData.extras</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id9"><code class="docutils literal notranslate"><span class="pre">MoldedData.outcomes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id10"><code class="docutils literal notranslate"><span class="pre">MoldedData.predictors</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id11"><code class="docutils literal notranslate"><span class="pre">MoldedData.blueprint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id12"><code class="docutils literal notranslate"><span class="pre">MoldedData.extras</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.__post_init__"><code class="docutils literal notranslate"><span class="pre">MoldedData.__post_init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.__init__"><code class="docutils literal notranslate"><span class="pre">MoldedData.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hardhat.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.mold"><code class="docutils literal notranslate"><span class="pre">mold()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.forge"><code class="docutils literal notranslate"><span class="pre">forge()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hardhat.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#basic-mold-forge">Basic Mold/Forge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#formula-transformations">Formula Transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#categorical-handling">Categorical Handling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/parsnip.html">py-parsnip: Model Specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec"><code class="docutils literal notranslate"><span class="pre">ModelSpec</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.model_type"><code class="docutils literal notranslate"><span class="pre">ModelSpec.model_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.engine"><code class="docutils literal notranslate"><span class="pre">ModelSpec.engine</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.mode"><code class="docutils literal notranslate"><span class="pre">ModelSpec.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.args"><code class="docutils literal notranslate"><span class="pre">ModelSpec.args</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.date_col"><code class="docutils literal notranslate"><span class="pre">ModelSpec.date_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id0"><code class="docutils literal notranslate"><span class="pre">ModelSpec.model_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id1"><code class="docutils literal notranslate"><span class="pre">ModelSpec.engine</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id2"><code class="docutils literal notranslate"><span class="pre">ModelSpec.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id3"><code class="docutils literal notranslate"><span class="pre">ModelSpec.args</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id4"><code class="docutils literal notranslate"><span class="pre">ModelSpec.date_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.set_engine"><code class="docutils literal notranslate"><span class="pre">ModelSpec.set_engine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.set_mode"><code class="docutils literal notranslate"><span class="pre">ModelSpec.set_mode()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.set_args"><code class="docutils literal notranslate"><span class="pre">ModelSpec.set_args()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.fit"><code class="docutils literal notranslate"><span class="pre">ModelSpec.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.fit_nested"><code class="docutils literal notranslate"><span class="pre">ModelSpec.fit_nested()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.fit_global"><code class="docutils literal notranslate"><span class="pre">ModelSpec.fit_global()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.__init__"><code class="docutils literal notranslate"><span class="pre">ModelSpec.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit"><code class="docutils literal notranslate"><span class="pre">ModelFit</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.spec"><code class="docutils literal notranslate"><span class="pre">ModelFit.spec</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.fit_data"><code class="docutils literal notranslate"><span class="pre">ModelFit.fit_data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.blueprint"><code class="docutils literal notranslate"><span class="pre">ModelFit.blueprint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.fit_time"><code class="docutils literal notranslate"><span class="pre">ModelFit.fit_time</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.evaluation_data"><code class="docutils literal notranslate"><span class="pre">ModelFit.evaluation_data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.model_name"><code class="docutils literal notranslate"><span class="pre">ModelFit.model_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.model_group_name"><code class="docutils literal notranslate"><span class="pre">ModelFit.model_group_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id5"><code class="docutils literal notranslate"><span class="pre">ModelFit.spec</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id6"><code class="docutils literal notranslate"><span class="pre">ModelFit.fit_data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id7"><code class="docutils literal notranslate"><span class="pre">ModelFit.blueprint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id8"><code class="docutils literal notranslate"><span class="pre">ModelFit.fit_time</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id9"><code class="docutils literal notranslate"><span class="pre">ModelFit.evaluation_data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id10"><code class="docutils literal notranslate"><span class="pre">ModelFit.model_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id11"><code class="docutils literal notranslate"><span class="pre">ModelFit.model_group_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.predict"><code class="docutils literal notranslate"><span class="pre">ModelFit.predict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.extract_fit_engine"><code class="docutils literal notranslate"><span class="pre">ModelFit.extract_fit_engine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.evaluate"><code class="docutils literal notranslate"><span class="pre">ModelFit.evaluate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.extract_outputs"><code class="docutils literal notranslate"><span class="pre">ModelFit.extract_outputs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.__init__"><code class="docutils literal notranslate"><span class="pre">ModelFit.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#linear-models">Linear Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.linear_reg"><code class="docutils literal notranslate"><span class="pre">linear_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.poisson_reg"><code class="docutils literal notranslate"><span class="pre">poisson_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.gen_additive_mod"><code class="docutils literal notranslate"><span class="pre">gen_additive_mod()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#tree-based-models">Tree-Based Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.decision_tree"><code class="docutils literal notranslate"><span class="pre">decision_tree()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.rand_forest"><code class="docutils literal notranslate"><span class="pre">rand_forest()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.boost_tree"><code class="docutils literal notranslate"><span class="pre">boost_tree()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#support-vector-machines">Support Vector Machines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.svm_rbf"><code class="docutils literal notranslate"><span class="pre">svm_rbf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.svm_linear"><code class="docutils literal notranslate"><span class="pre">svm_linear()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#instance-based-models">Instance-Based Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.nearest_neighbor"><code class="docutils literal notranslate"><span class="pre">nearest_neighbor()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.mars"><code class="docutils literal notranslate"><span class="pre">mars()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.mlp"><code class="docutils literal notranslate"><span class="pre">mlp()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#time-series-models">Time Series Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.arima_reg"><code class="docutils literal notranslate"><span class="pre">arima_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.prophet_reg"><code class="docutils literal notranslate"><span class="pre">prophet_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.exp_smoothing"><code class="docutils literal notranslate"><span class="pre">exp_smoothing()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.seasonal_reg"><code class="docutils literal notranslate"><span class="pre">seasonal_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.recursive_reg"><code class="docutils literal notranslate"><span class="pre">recursive_reg()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#hybrid-time-series-models">Hybrid Time Series Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.arima_boost"><code class="docutils literal notranslate"><span class="pre">arima_boost()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.prophet_boost"><code class="docutils literal notranslate"><span class="pre">prophet_boost()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#baseline-models">Baseline Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.null_model"><code class="docutils literal notranslate"><span class="pre">null_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.naive_reg"><code class="docutils literal notranslate"><span class="pre">naive_reg()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#generic-hybrid-models">Generic Hybrid Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.hybrid_model"><code class="docutils literal notranslate"><span class="pre">hybrid_model()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#manual-coefficient-models">Manual Coefficient Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.manual_reg"><code class="docutils literal notranslate"><span class="pre">manual_reg()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#module-py_parsnip.engine_registry">Engine Registry</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine"><code class="docutils literal notranslate"><span class="pre">Engine</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine.param_map"><code class="docutils literal notranslate"><span class="pre">Engine.param_map</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine.fit"><code class="docutils literal notranslate"><span class="pre">Engine.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine.predict"><code class="docutils literal notranslate"><span class="pre">Engine.predict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine.extract_outputs"><code class="docutils literal notranslate"><span class="pre">Engine.extract_outputs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine.translate_params"><code class="docutils literal notranslate"><span class="pre">Engine.translate_params()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.register_engine"><code class="docutils literal notranslate"><span class="pre">register_engine()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.get_engine"><code class="docutils literal notranslate"><span class="pre">get_engine()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.list_engines"><code class="docutils literal notranslate"><span class="pre">list_engines()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#time-series-model">Time Series Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#gradient-boosting">Gradient Boosting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/rsample.html">py-rsample: Resampling &amp; Cross-Validation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/rsample.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split"><code class="docutils literal notranslate"><span class="pre">Split</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split.data"><code class="docutils literal notranslate"><span class="pre">Split.data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split.in_id"><code class="docutils literal notranslate"><span class="pre">Split.in_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split.out_id"><code class="docutils literal notranslate"><span class="pre">Split.out_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split.id"><code class="docutils literal notranslate"><span class="pre">Split.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id0"><code class="docutils literal notranslate"><span class="pre">Split.data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id1"><code class="docutils literal notranslate"><span class="pre">Split.in_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id2"><code class="docutils literal notranslate"><span class="pre">Split.out_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id3"><code class="docutils literal notranslate"><span class="pre">Split.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split.__init__"><code class="docutils literal notranslate"><span class="pre">Split.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit"><code class="docutils literal notranslate"><span class="pre">RSplit</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.split"><code class="docutils literal notranslate"><span class="pre">RSplit.split</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.training"><code class="docutils literal notranslate"><span class="pre">RSplit.training()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.testing"><code class="docutils literal notranslate"><span class="pre">RSplit.testing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.analysis"><code class="docutils literal notranslate"><span class="pre">RSplit.analysis()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.assessment"><code class="docutils literal notranslate"><span class="pre">RSplit.assessment()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.__init__"><code class="docutils literal notranslate"><span class="pre">RSplit.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id4"><code class="docutils literal notranslate"><span class="pre">RSplit.split</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id5"><code class="docutils literal notranslate"><span class="pre">RSplit.training()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id6"><code class="docutils literal notranslate"><span class="pre">RSplit.testing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id7"><code class="docutils literal notranslate"><span class="pre">RSplit.analysis()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id8"><code class="docutils literal notranslate"><span class="pre">RSplit.assessment()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.__repr__"><code class="docutils literal notranslate"><span class="pre">RSplit.__repr__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.__len__"><code class="docutils literal notranslate"><span class="pre">RSplit.__len__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/rsample.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#train-test-split">Train/Test Split</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.initial_split"><code class="docutils literal notranslate"><span class="pre">initial_split()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.initial_time_split"><code class="docutils literal notranslate"><span class="pre">initial_time_split()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.training"><code class="docutils literal notranslate"><span class="pre">training()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.testing"><code class="docutils literal notranslate"><span class="pre">testing()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#cross-validation">Cross-Validation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.vfold_cv"><code class="docutils literal notranslate"><span class="pre">vfold_cv()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.time_series_cv"><code class="docutils literal notranslate"><span class="pre">time_series_cv()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/rsample.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#basic-split">Basic Split</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#time-series-split">Time Series Split</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#k-fold-cross-validation">K-Fold Cross-Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#time-series-cross-validation">Time Series Cross-Validation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/workflows.html">py-workflows: Pipeline Composition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/workflows.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow"><code class="docutils literal notranslate"><span class="pre">Workflow</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.preprocessor"><code class="docutils literal notranslate"><span class="pre">Workflow.preprocessor</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.spec"><code class="docutils literal notranslate"><span class="pre">Workflow.spec</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.post"><code class="docutils literal notranslate"><span class="pre">Workflow.post</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.case_weights"><code class="docutils literal notranslate"><span class="pre">Workflow.case_weights</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.model_name"><code class="docutils literal notranslate"><span class="pre">Workflow.model_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.model_group_name"><code class="docutils literal notranslate"><span class="pre">Workflow.model_group_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id0"><code class="docutils literal notranslate"><span class="pre">Workflow.preprocessor</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id1"><code class="docutils literal notranslate"><span class="pre">Workflow.spec</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id2"><code class="docutils literal notranslate"><span class="pre">Workflow.post</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id3"><code class="docutils literal notranslate"><span class="pre">Workflow.case_weights</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id4"><code class="docutils literal notranslate"><span class="pre">Workflow.model_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id5"><code class="docutils literal notranslate"><span class="pre">Workflow.model_group_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.add_formula"><code class="docutils literal notranslate"><span class="pre">Workflow.add_formula()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.add_model"><code class="docutils literal notranslate"><span class="pre">Workflow.add_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.add_recipe"><code class="docutils literal notranslate"><span class="pre">Workflow.add_recipe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.add_model_name"><code class="docutils literal notranslate"><span class="pre">Workflow.add_model_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.add_model_group_name"><code class="docutils literal notranslate"><span class="pre">Workflow.add_model_group_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.remove_formula"><code class="docutils literal notranslate"><span class="pre">Workflow.remove_formula()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.remove_model"><code class="docutils literal notranslate"><span class="pre">Workflow.remove_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.update_formula"><code class="docutils literal notranslate"><span class="pre">Workflow.update_formula()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.update_model"><code class="docutils literal notranslate"><span class="pre">Workflow.update_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.fit"><code class="docutils literal notranslate"><span class="pre">Workflow.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.fit_nested"><code class="docutils literal notranslate"><span class="pre">Workflow.fit_nested()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.fit_global"><code class="docutils literal notranslate"><span class="pre">Workflow.fit_global()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.__init__"><code class="docutils literal notranslate"><span class="pre">Workflow.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit"><code class="docutils literal notranslate"><span class="pre">WorkflowFit</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.workflow"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.workflow</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.pre"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.pre</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.fit"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.fit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.post"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.post</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.formula"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.formula</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.recipe_prepped_without_outcome"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.recipe_prepped_without_outcome</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id6"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.workflow</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id7"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.pre</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id8"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.fit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id9"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.post</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id10"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.formula</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id11"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.recipe_prepped_without_outcome</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.is_global_fit"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.is_global_fit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.group_col"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.group_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.predict"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.predict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.evaluate"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.evaluate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_fit_parsnip"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_fit_parsnip()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_preprocessor"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_preprocessor()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_spec_parsnip"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_spec_parsnip()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_outputs"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_outputs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_formula"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_formula()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_preprocessed_data"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_preprocessed_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.__init__"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/workflows.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#py_workflows.workflow"><code class="docutils literal notranslate"><span class="pre">workflow()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/workflows.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#basic-workflow">Basic Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#method-chaining">Method Chaining</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#panel-grouped-models">Panel/Grouped Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#extracting-components">Extracting Components</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/recipes.html">py-recipes: Feature Engineering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe"><code class="docutils literal notranslate"><span class="pre">Recipe</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.steps"><code class="docutils literal notranslate"><span class="pre">Recipe.steps</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.template"><code class="docutils literal notranslate"><span class="pre">Recipe.template</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.roles"><code class="docutils literal notranslate"><span class="pre">Recipe.roles</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#id0"><code class="docutils literal notranslate"><span class="pre">Recipe.steps</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#id1"><code class="docutils literal notranslate"><span class="pre">Recipe.template</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#id2"><code class="docutils literal notranslate"><span class="pre">Recipe.roles</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.add_step"><code class="docutils literal notranslate"><span class="pre">Recipe.add_step()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_rm"><code class="docutils literal notranslate"><span class="pre">Recipe.step_rm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_normalize"><code class="docutils literal notranslate"><span class="pre">Recipe.step_normalize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_dummy"><code class="docutils literal notranslate"><span class="pre">Recipe.step_dummy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_impute_mean"><code class="docutils literal notranslate"><span class="pre">Recipe.step_impute_mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_impute_median"><code class="docutils literal notranslate"><span class="pre">Recipe.step_impute_median()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_mutate"><code class="docutils literal notranslate"><span class="pre">Recipe.step_mutate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_lag"><code class="docutils literal notranslate"><span class="pre">Recipe.step_lag()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_diff"><code class="docutils literal notranslate"><span class="pre">Recipe.step_diff()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_pct_change"><code class="docutils literal notranslate"><span class="pre">Recipe.step_pct_change()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_rolling"><code class="docutils literal notranslate"><span class="pre">Recipe.step_rolling()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_date"><code class="docutils literal notranslate"><span class="pre">Recipe.step_date()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_pca"><code class="docutils literal notranslate"><span class="pre">Recipe.step_pca()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_corr"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_corr()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_log"><code class="docutils literal notranslate"><span class="pre">Recipe.step_log()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_sqrt"><code class="docutils literal notranslate"><span class="pre">Recipe.step_sqrt()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_boxcox"><code class="docutils literal notranslate"><span class="pre">Recipe.step_boxcox()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_yeojohnson"><code class="docutils literal notranslate"><span class="pre">Recipe.step_yeojohnson()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_inverse"><code class="docutils literal notranslate"><span class="pre">Recipe.step_inverse()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_center"><code class="docutils literal notranslate"><span class="pre">Recipe.step_center()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_scale"><code class="docutils literal notranslate"><span class="pre">Recipe.step_scale()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_range"><code class="docutils literal notranslate"><span class="pre">Recipe.step_range()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_zv"><code class="docutils literal notranslate"><span class="pre">Recipe.step_zv()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_nzv"><code class="docutils literal notranslate"><span class="pre">Recipe.step_nzv()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_lincomb"><code class="docutils literal notranslate"><span class="pre">Recipe.step_lincomb()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_missing"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_missing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_anova"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_anova()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_rf_importance"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_rf_importance()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_mutual_info"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_mutual_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_roc_auc"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_roc_auc()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_chisq"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_chisq()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_shap"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_shap()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_permutation"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_permutation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_genetic_algorithm"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_genetic_algorithm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_splitwise"><code class="docutils literal notranslate"><span class="pre">Recipe.step_splitwise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_safe"><code class="docutils literal notranslate"><span class="pre">Recipe.step_safe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_safe_v2"><code class="docutils literal notranslate"><span class="pre">Recipe.step_safe_v2()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_eix"><code class="docutils literal notranslate"><span class="pre">Recipe.step_eix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_naomit"><code class="docutils literal notranslate"><span class="pre">Recipe.step_naomit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_other"><code class="docutils literal notranslate"><span class="pre">Recipe.step_other()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_novel"><code class="docutils literal notranslate"><span class="pre">Recipe.step_novel()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_unknown"><code class="docutils literal notranslate"><span class="pre">Recipe.step_unknown()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_indicate_na"><code class="docutils literal notranslate"><span class="pre">Recipe.step_indicate_na()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_integer"><code class="docutils literal notranslate"><span class="pre">Recipe.step_integer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_impute_mode"><code class="docutils literal notranslate"><span class="pre">Recipe.step_impute_mode()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_impute_knn"><code class="docutils literal notranslate"><span class="pre">Recipe.step_impute_knn()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_impute_linear"><code class="docutils literal notranslate"><span class="pre">Recipe.step_impute_linear()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_bs"><code class="docutils literal notranslate"><span class="pre">Recipe.step_bs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_ns"><code class="docutils literal notranslate"><span class="pre">Recipe.step_ns()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_poly"><code class="docutils literal notranslate"><span class="pre">Recipe.step_poly()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_harmonic"><code class="docutils literal notranslate"><span class="pre">Recipe.step_harmonic()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_interact"><code class="docutils literal notranslate"><span class="pre">Recipe.step_interact()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_ratio"><code class="docutils literal notranslate"><span class="pre">Recipe.step_ratio()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_discretize"><code class="docutils literal notranslate"><span class="pre">Recipe.step_discretize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_cut"><code class="docutils literal notranslate"><span class="pre">Recipe.step_cut()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_percentile"><code class="docutils literal notranslate"><span class="pre">Recipe.step_percentile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_ica"><code class="docutils literal notranslate"><span class="pre">Recipe.step_ica()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_kpca"><code class="docutils literal notranslate"><span class="pre">Recipe.step_kpca()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_pls"><code class="docutils literal notranslate"><span class="pre">Recipe.step_pls()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_holiday"><code class="docutils literal notranslate"><span class="pre">Recipe.step_holiday()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_fourier"><code class="docutils literal notranslate"><span class="pre">Recipe.step_fourier()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_timeseries_signature"><code class="docutils literal notranslate"><span class="pre">Recipe.step_timeseries_signature()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_lead"><code class="docutils literal notranslate"><span class="pre">Recipe.step_lead()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_ewm"><code class="docutils literal notranslate"><span class="pre">Recipe.step_ewm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_expanding"><code class="docutils literal notranslate"><span class="pre">Recipe.step_expanding()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.update_role"><code class="docutils literal notranslate"><span class="pre">Recipe.update_role()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.add_role"><code class="docutils literal notranslate"><span class="pre">Recipe.add_role()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.remove_role"><code class="docutils literal notranslate"><span class="pre">Recipe.remove_role()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.has_role"><code class="docutils literal notranslate"><span class="pre">Recipe.has_role()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_vip"><code class="docutils literal notranslate"><span class="pre">Recipe.step_vip()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_boruta"><code class="docutils literal notranslate"><span class="pre">Recipe.step_boruta()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_rfe"><code class="docutils literal notranslate"><span class="pre">Recipe.step_rfe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_dt_discretiser"><code class="docutils literal notranslate"><span class="pre">Recipe.step_dt_discretiser()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_winsorizer"><code class="docutils literal notranslate"><span class="pre">Recipe.step_winsorizer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_outlier_trimmer"><code class="docutils literal notranslate"><span class="pre">Recipe.step_outlier_trimmer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_dt_features"><code class="docutils literal notranslate"><span class="pre">Recipe.step_dt_features()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_smart_corr"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_smart_corr()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_psi"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_psi()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_clean_anomalies"><code class="docutils literal notranslate"><span class="pre">Recipe.step_clean_anomalies()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_stationary"><code class="docutils literal notranslate"><span class="pre">Recipe.step_stationary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_deseasonalize"><code class="docutils literal notranslate"><span class="pre">Recipe.step_deseasonalize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_detrend"><code class="docutils literal notranslate"><span class="pre">Recipe.step_detrend()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_h_stat"><code class="docutils literal notranslate"><span class="pre">Recipe.step_h_stat()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_best_lag"><code class="docutils literal notranslate"><span class="pre">Recipe.step_best_lag()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_vif"><code class="docutils literal notranslate"><span class="pre">Recipe.step_vif()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_pvalue"><code class="docutils literal notranslate"><span class="pre">Recipe.step_pvalue()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_stability"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_stability()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_lofo"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_lofo()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_granger"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_granger()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_stepwise"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_stepwise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_probe"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_probe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_lasso"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_lasso()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_ridge"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_ridge()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_elastic_net"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_elastic_net()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_univariate"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_univariate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_variance_threshold"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_variance_threshold()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_stationary"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_stationary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_cointegration"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_cointegration()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_seasonal"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_seasonal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_fractional_diff"><code class="docutils literal notranslate"><span class="pre">Recipe.step_fractional_diff()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_volatility_ewm"><code class="docutils literal notranslate"><span class="pre">Recipe.step_volatility_ewm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_permutation_entropy"><code class="docutils literal notranslate"><span class="pre">Recipe.step_permutation_entropy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_weight_time_decay"><code class="docutils literal notranslate"><span class="pre">Recipe.step_weight_time_decay()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.prep"><code class="docutils literal notranslate"><span class="pre">Recipe.prep()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.__init__"><code class="docutils literal notranslate"><span class="pre">Recipe.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.recipe"><code class="docutils literal notranslate"><span class="pre">recipe()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#module-py_recipes.selectors">Selectors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_numeric"><code class="docutils literal notranslate"><span class="pre">all_numeric()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_nominal"><code class="docutils literal notranslate"><span class="pre">all_nominal()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_integer"><code class="docutils literal notranslate"><span class="pre">all_integer()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_float"><code class="docutils literal notranslate"><span class="pre">all_float()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_string"><code class="docutils literal notranslate"><span class="pre">all_string()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_datetime"><code class="docutils literal notranslate"><span class="pre">all_datetime()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.starts_with"><code class="docutils literal notranslate"><span class="pre">starts_with()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.ends_with"><code class="docutils literal notranslate"><span class="pre">ends_with()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.contains"><code class="docutils literal notranslate"><span class="pre">contains()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.matches"><code class="docutils literal notranslate"><span class="pre">matches()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.everything"><code class="docutils literal notranslate"><span class="pre">everything()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.one_of"><code class="docutils literal notranslate"><span class="pre">one_of()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.none_of"><code class="docutils literal notranslate"><span class="pre">none_of()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.where"><code class="docutils literal notranslate"><span class="pre">where()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.union"><code class="docutils literal notranslate"><span class="pre">union()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.intersection"><code class="docutils literal notranslate"><span class="pre">intersection()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.difference"><code class="docutils literal notranslate"><span class="pre">difference()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_predictors"><code class="docutils literal notranslate"><span class="pre">all_predictors()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_outcomes"><code class="docutils literal notranslate"><span class="pre">all_outcomes()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_numeric_predictors"><code class="docutils literal notranslate"><span class="pre">all_numeric_predictors()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_nominal_predictors"><code class="docutils literal notranslate"><span class="pre">all_nominal_predictors()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.has_role"><code class="docutils literal notranslate"><span class="pre">has_role()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.resolve_selector"><code class="docutils literal notranslate"><span class="pre">resolve_selector()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#imputation-steps-6">Imputation Steps (6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#normalization-steps-4">Normalization Steps (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#encoding-steps-6">Encoding Steps (6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#feature-engineering-steps-8">Feature Engineering Steps (8)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#filtering-steps-6">Filtering Steps (6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#row-operations-6">Row Operations (6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#transformation-steps-6">Transformation Steps (6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#time-series-steps-4">Time Series Steps (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#basic-recipe">Basic Recipe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#advanced-recipe">Advanced Recipe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#time-series-recipe">Time Series Recipe</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/yardstick.html">py-yardstick: Model Metrics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/yardstick.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#metric-set">Metric Set</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.metric_set"><code class="docutils literal notranslate"><span class="pre">metric_set()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#regression-metrics-7">Regression Metrics (7)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.rmse"><code class="docutils literal notranslate"><span class="pre">rmse()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.mae"><code class="docutils literal notranslate"><span class="pre">mae()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.mape"><code class="docutils literal notranslate"><span class="pre">mape()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.smape"><code class="docutils literal notranslate"><span class="pre">smape()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.r_squared"><code class="docutils literal notranslate"><span class="pre">r_squared()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#classification-metrics-10">Classification Metrics (10)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.accuracy"><code class="docutils literal notranslate"><span class="pre">accuracy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.precision"><code class="docutils literal notranslate"><span class="pre">precision()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.recall"><code class="docutils literal notranslate"><span class="pre">recall()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.roc_auc"><code class="docutils literal notranslate"><span class="pre">roc_auc()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/yardstick.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#individual-metrics">Individual Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#id1">Metric Set</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#with-dataframes">With DataFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#classification-metrics">Classification Metrics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tune.html">py-tune: Hyperparameter Tuning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/tune.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults"><code class="docutils literal notranslate"><span class="pre">TuneResults</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.metrics"><code class="docutils literal notranslate"><span class="pre">TuneResults.metrics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.predictions"><code class="docutils literal notranslate"><span class="pre">TuneResults.predictions</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.workflow"><code class="docutils literal notranslate"><span class="pre">TuneResults.workflow</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.resamples"><code class="docutils literal notranslate"><span class="pre">TuneResults.resamples</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.grid"><code class="docutils literal notranslate"><span class="pre">TuneResults.grid</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.collect_metrics"><code class="docutils literal notranslate"><span class="pre">TuneResults.collect_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.collect_predictions"><code class="docutils literal notranslate"><span class="pre">TuneResults.collect_predictions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.show_best"><code class="docutils literal notranslate"><span class="pre">TuneResults.show_best()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.select_best"><code class="docutils literal notranslate"><span class="pre">TuneResults.select_best()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.select_by_one_std_err"><code class="docutils literal notranslate"><span class="pre">TuneResults.select_by_one_std_err()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.__init__"><code class="docutils literal notranslate"><span class="pre">TuneResults.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/tune.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#tuning">Tuning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.tune"><code class="docutils literal notranslate"><span class="pre">tune()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.tune_grid"><code class="docutils literal notranslate"><span class="pre">tune_grid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.fit_resamples"><code class="docutils literal notranslate"><span class="pre">fit_resamples()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#grid-generation">Grid Generation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.grid_regular"><code class="docutils literal notranslate"><span class="pre">grid_regular()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.grid_random"><code class="docutils literal notranslate"><span class="pre">grid_random()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#finalization">Finalization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.finalize_workflow"><code class="docutils literal notranslate"><span class="pre">finalize_workflow()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/tune.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#basic-tuning">Basic Tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#analyze-results">Analyze Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#finalize-workflow">Finalize Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#random-grid">Random Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#fit-resamples-without-tuning">Fit Resamples Without Tuning</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/workflowsets.html">py-workflowsets: Multi-Model Comparison</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/workflowsets.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet"><code class="docutils literal notranslate"><span class="pre">WorkflowSet</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.workflows"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.workflows</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.info"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#id0"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.workflows</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#id1"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.from_workflows"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.from_workflows()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.from_cross"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.from_cross()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__len__"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.__len__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__iter__"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.__iter__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__getitem__"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.__getitem__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.workflow_ids"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.workflow_ids</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.workflow_map"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.workflow_map()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_resamples"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.fit_resamples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.tune_grid"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.tune_grid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_nested"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.fit_nested()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_global"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.fit_global()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_nested_resamples"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.fit_nested_resamples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_global_resamples"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.fit_global_resamples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__init__"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.results"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.results</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.workflow_set"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.workflow_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.metrics"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.metrics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#id2"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.results</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#id3"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.workflow_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#id4"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.metrics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.collect_metrics"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.collect_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.collect_predictions"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.collect_predictions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.rank_results"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.rank_results()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.autoplot"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.autoplot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.__init__"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/workflowsets.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#basic-workflow-set">Basic Workflow Set</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#evaluate-workflows">Evaluate Workflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#select-best-workflow">Select Best Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#from-explicit-workflows">From Explicit Workflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#access-individual-workflows">Access Individual Workflows</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/visualize.html">py-visualize: Interactive Visualizations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/visualize.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#forecast-visualization">Forecast Visualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/visualize.html#py_visualize.plot_forecast"><code class="docutils literal notranslate"><span class="pre">plot_forecast()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#residual-diagnostics">Residual Diagnostics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/visualize.html#py_visualize.plot_residuals"><code class="docutils literal notranslate"><span class="pre">plot_residuals()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#model-comparison">Model Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/visualize.html#py_visualize.plot_model_comparison"><code class="docutils literal notranslate"><span class="pre">plot_model_comparison()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#decomposition-plots">Decomposition Plots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/visualize.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#forecast-plot">Forecast Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#id1">Residual Diagnostics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#id2">Model Comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#decomposition-plot">Decomposition Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#customization">Customization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/stacks.html">py-stacks: Model Ensembling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/stacks.html#core-classes">Core Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/stacks.html#main-functions">Main Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/stacks.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/stacks.html#basic-stacking">Basic Stacking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/stacks.html#model-weights">Model Weights</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/stacks.html#non-negative-weights">Non-Negative Weights</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/stacks.html#cross-validation-stacking">Cross-Validation Stacking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/stacks.html#evaluate-stack">Evaluate Stack</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../models/linear_models.html">Linear Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/linear_models.html#linear-reg">linear_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/linear_models.html#poisson-reg">poisson_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/linear_models.html#gen-additive-mod">gen_additive_mod()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/linear_models.html#when-to-use">When to Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/linear_models.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../models/tree_models.html">Tree-Based Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/tree_models.html#decision-tree">decision_tree()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/tree_models.html#rand-forest">rand_forest()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/tree_models.html#boost-tree">boost_tree()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/tree_models.html#when-to-use">When to Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/tree_models.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../models/time_series.html">Time Series Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#arima-reg">arima_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#prophet-reg">prophet_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#exp-smoothing">exp_smoothing()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#seasonal-reg">seasonal_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#recursive-reg">recursive_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#hybrid-models">Hybrid Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../models/time_series.html#arima-boost">arima_boost()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../models/time_series.html#prophet-boost">prophet_boost()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#when-to-use">When to Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../models/ensemble_models.html">Ensemble Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/ensemble_models.html#boost-tree">boost_tree()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/ensemble_models.html#hybrid-time-series">Hybrid Time Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../models/ensemble_models.html#arima-boost">arima_boost()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../models/ensemble_models.html#prophet-boost">prophet_boost()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../models/ensemble_models.html#model-stacking">Model Stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/ensemble_models.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../models/baseline_models.html">Baseline Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline_models.html#null-model">null_model()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline_models.html#naive-reg">naive_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline_models.html#when-to-use">When to Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline_models.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples/basic_regression.html">Basic Regression Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/basic_regression.html#simple-linear-regression">Simple Linear Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/basic_regression.html#with-feature-engineering">With Feature Engineering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/basic_regression.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/time_series_forecasting.html">Time Series Forecasting Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/time_series_forecasting.html#prophet-forecasting">Prophet Forecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/time_series_forecasting.html#arima-forecasting">ARIMA Forecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/time_series_forecasting.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/hyperparameter_tuning.html">Hyperparameter Tuning Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/hyperparameter_tuning.html#grid-search">Grid Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/hyperparameter_tuning.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/panel_models.html">Panel/Grouped Model Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/panel_models.html#nested-approach">Nested Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/panel_models.html#global-approach">Global Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/panel_models.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/model_stacking.html">Model Stacking Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/model_stacking.html#basic-stacking">Basic Stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/model_stacking.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/contributing.html">Contributing Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html#development-setup">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html#running-tests">Running Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html#code-style">Code Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/architecture.html">Architecture Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/architecture.html#layers">Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/architecture.html#key-patterns">Key Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/architecture.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/testing.html">Testing Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/testing.html#test-structure">Test Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/testing.html#running-tests">Running Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/testing.html#test-coverage">Test Coverage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/testing.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/changelog.html#version-0-1-0-current">Version 0.1.0 (Current)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/changelog.html#see-also">See Also</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">py-tidymodels</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">py_workflows.workflow</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for py_workflows.workflow</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Workflow composition for preprocessing and modeling</span>

<span class="sd">Provides Workflow and WorkflowFit classes for composing preprocessing steps</span>
<span class="sd">with model specifications into complete pipelines.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">replace</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">joblib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">py_parsnip</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelSpec</span><span class="p">,</span> <span class="n">ModelFit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">py_recipes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Recipe</span><span class="p">,</span> <span class="n">PreparedRecipe</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.parallel_utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">validate_n_jobs</span><span class="p">,</span>
    <span class="n">get_joblib_backend</span><span class="p">,</span>
    <span class="n">check_windows_compatibility</span><span class="p">,</span>
    <span class="n">format_parallel_info</span>
<span class="p">)</span>


<div class="viewcode-block" id="Workflow">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow">[docs]</a>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Workflow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Immutable workflow composition.</span>

<span class="sd">    Workflows combine preprocessing (formula or recipe) with a model specification</span>
<span class="sd">    into a single pipeline that can be fitted and used for prediction.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        preprocessor: Formula string or Recipe object (or None)</span>
<span class="sd">        spec: ModelSpec for the model to fit</span>
<span class="sd">        post: Post-processing steps (future use)</span>
<span class="sd">        case_weights: Column name for case weights (optional)</span>
<span class="sd">        model_name: Optional name for the model (used in extract_outputs())</span>
<span class="sd">        model_group_name: Optional group name for organizing models (used in extract_outputs())</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Create workflow with formula and model</span>
<span class="sd">        &gt;&gt;&gt; wf = (</span>
<span class="sd">        ...     workflow()</span>
<span class="sd">        ...     .add_formula(&quot;sales ~ price + advertising&quot;)</span>
<span class="sd">        ...     .add_model(linear_reg().set_engine(&quot;sklearn&quot;))</span>
<span class="sd">        ...     .add_model_name(&quot;baseline&quot;)</span>
<span class="sd">        ...     .add_model_group_name(&quot;linear_models&quot;)</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Fit workflow</span>
<span class="sd">        &gt;&gt;&gt; wf_fit = wf.fit(train_data)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Predict on new data</span>
<span class="sd">        &gt;&gt;&gt; predictions = wf_fit.predict(test_data)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Extract outputs with custom model names</span>
<span class="sd">        &gt;&gt;&gt; outputs, _, _ = wf_fit.extract_outputs()</span>
<span class="sd">        &gt;&gt;&gt; print(outputs[&quot;model&quot;].unique())  # [&#39;baseline&#39;]</span>
<span class="sd">        &gt;&gt;&gt; print(outputs[&quot;model_group_name&quot;].unique())  # [&#39;linear_models&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preprocessor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Formula string or Recipe</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ModelSpec</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">post</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">case_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">model_group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Workflow.add_formula">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.add_formula">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formula</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a formula for preprocessing.</span>

<span class="sd">        Args:</span>
<span class="sd">            formula: R-style formula string (e.g., &quot;y ~ x1 + x2&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            New Workflow with formula added</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If workflow already has a preprocessor</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; wf = workflow().add_formula(&quot;sales ~ price + advertising&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workflow already has a preprocessor&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preprocessor</span><span class="o">=</span><span class="n">formula</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.add_model">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.add_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="n">ModelSpec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a model specification.</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: ModelSpec instance (from linear_reg(), rand_forest(), etc.)</span>

<span class="sd">        Returns:</span>
<span class="sd">            New Workflow with model added</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If workflow already has a model</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; wf = workflow().add_model(linear_reg().set_engine(&quot;sklearn&quot;))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workflow already has a model&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.add_recipe">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.add_recipe">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_recipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recipe</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a recipe for preprocessing.</span>

<span class="sd">        Args:</span>
<span class="sd">            recipe: Recipe object with preprocessing steps</span>

<span class="sd">        Returns:</span>
<span class="sd">            New Workflow with recipe added</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If workflow already has a preprocessor</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from py_recipes import recipe</span>
<span class="sd">            &gt;&gt;&gt; rec = recipe().step_normalize().step_dummy([&quot;category&quot;])</span>
<span class="sd">            &gt;&gt;&gt; wf = workflow().add_recipe(rec).add_model(linear_reg())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workflow already has a preprocessor&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preprocessor</span><span class="o">=</span><span class="n">recipe</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.add_model_name">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.add_model_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a model name for identification in outputs.</span>

<span class="sd">        The model name will appear in the &quot;model&quot; column of DataFrames</span>
<span class="sd">        returned by extract_outputs().</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name for this model (e.g., &quot;baseline&quot;, &quot;poly&quot;, &quot;interaction&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            New Workflow with model_name set</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; wf = (</span>
<span class="sd">            ...     workflow()</span>
<span class="sd">            ...     .add_model(linear_reg())</span>
<span class="sd">            ...     .add_model_name(&quot;baseline&quot;)</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; fit = wf.fit(train_data)</span>
<span class="sd">            &gt;&gt;&gt; outputs, _, _ = fit.extract_outputs()</span>
<span class="sd">            &gt;&gt;&gt; print(outputs[&quot;model&quot;].unique())  # [&#39;baseline&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.add_model_group_name">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.add_model_group_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_model_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a model group name for organizing related models.</span>

<span class="sd">        The model group name will appear in the &quot;model_group_name&quot; column of</span>
<span class="sd">        DataFrames returned by extract_outputs(). Useful for organizing models</span>
<span class="sd">        into logical groups (e.g., &quot;linear_models&quot;, &quot;tree_models&quot;, &quot;ensemble&quot;).</span>

<span class="sd">        Args:</span>
<span class="sd">            group_name: Group name for organizing models (e.g., &quot;linear_models&quot;, &quot;polynomial&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            New Workflow with model_group_name set</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; wf = (</span>
<span class="sd">            ...     workflow()</span>
<span class="sd">            ...     .add_model(linear_reg())</span>
<span class="sd">            ...     .add_model_name(&quot;baseline&quot;)</span>
<span class="sd">            ...     .add_model_group_name(&quot;linear_models&quot;)</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; fit = wf.fit(train_data)</span>
<span class="sd">            &gt;&gt;&gt; outputs, _, _ = fit.extract_outputs()</span>
<span class="sd">            &gt;&gt;&gt; print(outputs[&quot;model_group_name&quot;].unique())  # [&#39;linear_models&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.remove_formula">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.remove_formula">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the preprocessor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            New Workflow without preprocessor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preprocessor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_recipe_requires_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recipe</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if recipe contains supervised steps that require outcome during prep/bake.</span>

<span class="sd">        Supervised feature selection steps need the outcome column to calculate</span>
<span class="sd">        feature importance or relevance scores.</span>

<span class="sd">        Args:</span>
<span class="sd">            recipe: Recipe or PreparedRecipe object to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if recipe has supervised steps requiring outcome, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle both Recipe and PreparedRecipe</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="s1">&#39;steps&#39;</span><span class="p">):</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">steps</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="s1">&#39;prepared_steps&#39;</span><span class="p">):</span>
            <span class="c1"># PreparedRecipe uses prepared_steps</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">prepared_steps</span>

        <span class="k">if</span> <span class="n">steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Supervised step class names that require outcome during prep/bake</span>
        <span class="n">supervised_step_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># Phase 2 Supervised Selection Steps</span>
            <span class="s1">&#39;StepFilterAnova&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepFilterRfImportance&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepFilterMutualInfo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepFilterRocAuc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepFilterChisq&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectShap&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectPermutation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSafe&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSafeV2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSplitwise&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepEIX&#39;</span><span class="p">,</span>
            <span class="c1"># Phase 3 Advanced Selection Steps</span>
            <span class="s1">&#39;StepPvalue&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectStability&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectLofo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectGranger&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectStepwise&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectProbe&#39;</span><span class="p">,</span>
            <span class="c1"># Phase 4 Practical Selection Steps</span>
            <span class="s1">&#39;StepSelectLasso&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectRidge&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectElasticNet&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectUnivariate&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectCointegration&#39;</span><span class="p">,</span>
            <span class="c1"># Feature Engineering Steps</span>
            <span class="s1">&#39;StepDtDiscretiser&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepDtFeatures&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepSelectSmartCorr&#39;</span><span class="p">,</span>
            <span class="c1"># Interaction Detection Steps</span>
            <span class="s1">&#39;StepHStat&#39;</span><span class="p">,</span>
            <span class="c1"># Time Series Lag Selection Steps</span>
            <span class="s1">&#39;StepBestLag&#39;</span><span class="p">,</span>
            <span class="c1"># Advanced Feature Selection Steps</span>
            <span class="s1">&#39;StepVip&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepBoruta&#39;</span><span class="p">,</span>
            <span class="s1">&#39;StepRfe&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
            <span class="n">step_class_name</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">if</span> <span class="n">step_class_name</span> <span class="ow">in</span> <span class="n">supervised_step_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_outcome_from_recipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recipe</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract outcome column name from supervised feature selection steps.</span>

<span class="sd">        Args:</span>
<span class="sd">            recipe: Recipe or PreparedRecipe object</span>

<span class="sd">        Returns:</span>
<span class="sd">            Outcome column name if found in supervised steps, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle both Recipe and PreparedRecipe</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="s1">&#39;steps&#39;</span><span class="p">):</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">steps</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="s1">&#39;prepared_steps&#39;</span><span class="p">):</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">prepared_steps</span>

        <span class="k">if</span> <span class="n">steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Check each step for outcome attribute</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;outcome&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">step</span><span class="o">.</span><span class="n">outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">step</span><span class="o">.</span><span class="n">outcome</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auto-detect outcome column from original data.</span>

<span class="sd">        Args:</span>
<span class="sd">            original_data: Original data before preprocessing</span>

<span class="sd">        Returns:</span>
<span class="sd">            Name of outcome column</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If outcome column cannot be detected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Try common names first</span>
        <span class="k">for</span> <span class="n">common_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;outcome&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">common_name</span> <span class="ow">in</span> <span class="n">original_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">common_name</span>

        <span class="c1"># If no common name found, use the first numeric column</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">original_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="n">original_data</span><span class="p">[</span><span class="n">col</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">col</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Could not auto-detect outcome column. Please ensure your data has &quot;</span>
            <span class="s2">&quot;a column named &#39;y&#39;, &#39;target&#39;, or &#39;outcome&#39;, or that the first numeric &quot;</span>
            <span class="s2">&quot;column is the outcome variable.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prep_and_bake_with_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">outcome_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prep and bake a recipe while preserving the outcome column.</span>

<span class="sd">        Args:</span>
<span class="sd">            recipe: Recipe or PreparedRecipe</span>
<span class="sd">            data: Data to process</span>
<span class="sd">            outcome_col: Name of outcome column to preserve</span>

<span class="sd">        Returns:</span>
<span class="sd">            Processed data with outcome column preserved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">py_recipes.recipe</span><span class="w"> </span><span class="kn">import</span> <span class="n">PreparedRecipe</span>

        <span class="c1"># Check if recipe has supervised steps that need outcome during bake</span>
        <span class="n">needs_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recipe_requires_outcome</span><span class="p">(</span><span class="n">recipe</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="n">PreparedRecipe</span><span class="p">)</span> <span class="k">else</span> <span class="n">recipe</span><span class="p">)</span>

        <span class="c1"># DEBUG</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;_workflow_debug&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   [DEBUG] _prep_and_bake_with_outcome:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;           needs_outcome=</span><span class="si">{</span><span class="n">needs_outcome</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;           input columns=</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">needs_outcome</span><span class="p">:</span>
            <span class="c1"># Bake with outcome included (for supervised feature selection)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="n">PreparedRecipe</span><span class="p">):</span>
                <span class="n">processed_data</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prepped</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">prep</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">processed_data</span> <span class="o">=</span> <span class="n">prepped</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># DEBUG</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;_workflow_debug&#39;</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;           output columns=</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">processed_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Separate outcome from predictors</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">outcome_col</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">predictors</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">outcome_col</span><span class="p">])</span>

            <span class="c1"># Prep/bake predictors only</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="n">PreparedRecipe</span><span class="p">):</span>
                <span class="n">processed_predictors</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prepped</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">prep</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
                <span class="n">processed_predictors</span> <span class="o">=</span> <span class="n">prepped</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>

            <span class="c1"># Recombine with outcome (align by index in case rows were removed by step_naomit)</span>
            <span class="n">processed_data</span> <span class="o">=</span> <span class="n">processed_predictors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">processed_data</span><span class="p">[</span><span class="n">outcome_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">outcome</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">processed_predictors</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="k">return</span> <span class="n">processed_data</span>

<div class="viewcode-block" id="Workflow.remove_model">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.remove_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the model specification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            New Workflow without model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.update_formula">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.update_formula">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formula</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the formula.</span>

<span class="sd">        Args:</span>
<span class="sd">            formula: New formula string</span>

<span class="sd">        Returns:</span>
<span class="sd">            New Workflow with updated formula</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preprocessor</span><span class="o">=</span><span class="n">formula</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.update_model">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.update_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="n">ModelSpec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the model specification.</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: New ModelSpec</span>

<span class="sd">        Returns:</span>
<span class="sd">            New Workflow with updated model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.fit">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.fit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowFit&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the entire workflow to training data.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Training data DataFrame</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowFit object containing fitted pipeline</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If workflow doesn&#39;t have a model</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; wf = (</span>
<span class="sd">            ...     workflow()</span>
<span class="sd">            ...     .add_formula(&quot;sales ~ price&quot;)</span>
<span class="sd">            ...     .add_model(linear_reg().set_engine(&quot;sklearn&quot;))</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; wf_fit = wf.fit(train_data)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workflow must have a model specification&quot;</span><span class="p">)</span>

        <span class="c1"># Store original training data for engines that need raw datetime/categorical values</span>
        <span class="n">original_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Handle preprocessor</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># It&#39;s a formula - pass directly to model</span>
                <span class="n">formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span>
                <span class="n">processed_data</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">fitted_preprocessor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Recipe</span><span class="p">):</span>
                <span class="c1"># It&#39;s a recipe - prep and bake</span>
                <span class="n">prepared_recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">prep</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">processed_data</span> <span class="o">=</span> <span class="n">prepared_recipe</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="c1"># Auto-detect outcome column</span>
                <span class="c1"># Try common names first, then use first numeric column</span>
                <span class="n">outcome_col</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">common_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;outcome&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">common_name</span> <span class="ow">in</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">outcome_col</span> <span class="o">=</span> <span class="n">common_name</span>
                        <span class="k">break</span>

                <span class="c1"># If no common name found, use the first column from original data</span>
                <span class="c1"># that&#39;s still present and numeric</span>
                <span class="k">if</span> <span class="n">outcome_col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="n">processed_data</span><span class="p">[</span><span class="n">col</span><span class="p">]):</span>
                            <span class="n">outcome_col</span> <span class="o">=</span> <span class="n">col</span>
                            <span class="k">break</span>

                <span class="k">if</span> <span class="n">outcome_col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Could not auto-detect outcome column. Please ensure your data has &quot;</span>
                        <span class="s2">&quot;a column named &#39;y&#39;, &#39;target&#39;, or &#39;outcome&#39;, or that the first numeric &quot;</span>
                        <span class="s2">&quot;column is the outcome variable.&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># Build explicit formula (patsy doesn&#39;t support &quot;y ~ .&quot; notation)</span>
                <span class="c1"># Exclude datetime columns - they should be indices, not predictors</span>
                <span class="n">predictor_cols</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">columns</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="n">outcome_col</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_datetime64_any_dtype</span><span class="p">(</span><span class="n">processed_data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictor_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No predictor columns found after recipe preprocessing&quot;</span><span class="p">)</span>

                <span class="c1"># Escape column names that contain Patsy special characters</span>
                <span class="c1"># Special chars: ^ * : + - / ( ) ** [ ] { }</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">escape_column_name</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\^\*\:\+\-\/\(\)\[\]\{\}]&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
                        <span class="c1"># Wrap in Q() for Patsy to treat as literal column name</span>
                        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Q(&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&quot;)&#39;</span>
                    <span class="k">return</span> <span class="n">col</span>

                <span class="n">escaped_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">escape_column_name</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">predictor_cols</span><span class="p">]</span>
                <span class="n">formula</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s2"> ~ </span><span class="si">{</span><span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">escaped_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">fitted_preprocessor</span> <span class="o">=</span> <span class="n">prepared_recipe</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown preprocessor type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No preprocessor - use default formula</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workflow must have a formula (via add_formula()) or recipe (via add_recipe())&quot;</span><span class="p">)</span>

        <span class="c1"># Fit the model (data first, then formula)</span>
        <span class="c1"># Pass original training data for engines that need raw datetime/categorical values</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">processed_data</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">original_training_data</span><span class="o">=</span><span class="n">original_data</span><span class="p">)</span>

        <span class="c1"># Set model_name and model_group_name from workflow if provided</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model_fit</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span>
                <span class="n">model_fit</span><span class="p">,</span>
                <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
                <span class="n">model_group_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">model_group_name</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">WorkflowFit</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">pre</span><span class="o">=</span><span class="n">fitted_preprocessor</span><span class="p">,</span>
            <span class="n">fit</span><span class="o">=</span><span class="n">model_fit</span><span class="p">,</span>
            <span class="n">post</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
            <span class="n">formula</span><span class="o">=</span><span class="n">formula</span>  <span class="c1"># Store formula for easy access</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_fit_single_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">group</span><span class="p">,</span>
        <span class="n">group_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">per_group_prep</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">min_group_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">global_recipe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedRecipe</span><span class="p">],</span>
        <span class="n">outcome_col_global</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit model for a single group.</span>

<span class="sd">        Helper function for parallel execution in fit_nested.</span>

<span class="sd">        Args:</span>
<span class="sd">            group: Group identifier</span>
<span class="sd">            group_data: Data for this group</span>
<span class="sd">            group_col: Name of group column</span>
<span class="sd">            per_group_prep: Whether to use per-group preprocessing</span>
<span class="sd">            min_group_size: Minimum size for per-group preprocessing</span>
<span class="sd">            global_recipe: Pre-prepared global recipe (if any)</span>
<span class="sd">            outcome_col_global: Outcome column name</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (group_fit, group_recipe, group_train_data, error_msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Import WorkflowFit at function level (needed in multiple paths)</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">py_workflows.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkflowFit</span>

            <span class="c1"># Store original group training data</span>
            <span class="n">group_train_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Determine if we should use per-group preprocessing</span>
            <span class="n">use_group_recipe</span> <span class="o">=</span> <span class="n">per_group_prep</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_group_size</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_group_recipe</span> <span class="ow">and</span> <span class="n">per_group_prep</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_group_size</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; has only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(minimum: </span><span class="si">{</span><span class="n">min_group_size</span><span class="si">}</span><span class="s2">). Using global recipe instead.&quot;</span><span class="p">,</span>
                    <span class="ne">UserWarning</span>
                <span class="p">)</span>

            <span class="c1"># For recursive models, set date as index if needed</span>
            <span class="n">is_recursive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;recursive_reg&quot;</span>
            <span class="k">if</span> <span class="n">is_recursive</span> <span class="ow">and</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="n">group_data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                <span class="n">group_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
                <span class="n">group_data_no_group</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">group_col</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group_data_no_group</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">group_col</span><span class="p">])</span>

            <span class="c1"># Detect outcome column</span>
            <span class="n">outcome_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_outcome_from_recipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Recipe</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">outcome_col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">outcome_col</span> <span class="o">=</span> <span class="n">outcome_col_global</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_outcome</span><span class="p">(</span><span class="n">group_data_no_group</span><span class="p">)</span>

            <span class="c1"># Fit based on preprocessing strategy</span>
            <span class="k">if</span> <span class="n">use_group_recipe</span><span class="p">:</span>
                <span class="c1"># Prep recipe on THIS group&#39;s data only</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">needs_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recipe_requires_outcome</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">needs_outcome</span><span class="p">:</span>
                        <span class="n">group_recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">prep</span><span class="p">(</span><span class="n">group_data_no_group</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">predictors</span> <span class="o">=</span> <span class="n">group_data_no_group</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">outcome_col</span><span class="p">])</span>
                        <span class="n">group_recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">prep</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Recipe prep failed for group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Falling back to global recipe for this group.&quot;</span><span class="p">,</span>
                        <span class="ne">UserWarning</span>
                    <span class="p">)</span>
                    <span class="n">group_recipe</span> <span class="o">=</span> <span class="n">global_recipe</span>

                <span class="c1"># Bake data with group&#39;s recipe</span>
                <span class="n">processed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_and_bake_with_outcome</span><span class="p">(</span>
                    <span class="n">group_recipe</span><span class="p">,</span>
                    <span class="n">group_data_no_group</span><span class="p">,</span>
                    <span class="n">outcome_col</span>
                <span class="p">)</span>

                <span class="c1"># Build formula</span>
                <span class="n">predictor_cols</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">columns</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="n">outcome_col</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_datetime64_any_dtype</span><span class="p">(</span><span class="n">processed_data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
                <span class="p">]</span>
                <span class="n">formula</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s2"> ~ </span><span class="si">{</span><span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">predictor_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="c1"># Fit model</span>
                <span class="n">model_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">processed_data</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">original_training_data</span><span class="o">=</span><span class="n">group_data_no_group</span><span class="p">)</span>

                <span class="c1"># Set model names</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">model_fit</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span>
                        <span class="n">model_fit</span><span class="p">,</span>
                        <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
                        <span class="n">model_group_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">model_group_name</span>
                    <span class="p">)</span>

                <span class="c1"># Wrap in WorkflowFit</span>
                <span class="n">group_fit</span> <span class="o">=</span> <span class="n">WorkflowFit</span><span class="p">(</span>
                    <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">pre</span><span class="o">=</span><span class="n">group_recipe</span><span class="p">,</span>
                    <span class="n">fit</span><span class="o">=</span><span class="n">model_fit</span><span class="p">,</span>
                    <span class="n">post</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
                    <span class="n">formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span>
                    <span class="n">recipe_prepped_without_outcome</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">per_group_prep</span><span class="p">:</span>
                <span class="c1"># Small group - use global recipe</span>
                <span class="n">group_recipe</span> <span class="o">=</span> <span class="n">global_recipe</span>

                <span class="c1"># Bake data with global recipe</span>
                <span class="n">processed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_and_bake_with_outcome</span><span class="p">(</span>
                    <span class="n">global_recipe</span><span class="p">,</span>
                    <span class="n">group_data_no_group</span><span class="p">,</span>
                    <span class="n">outcome_col</span>
                <span class="p">)</span>

                <span class="c1"># Build formula</span>
                <span class="n">predictor_cols</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">columns</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="n">outcome_col</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_datetime64_any_dtype</span><span class="p">(</span><span class="n">processed_data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
                <span class="p">]</span>
                <span class="n">formula</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s2"> ~ </span><span class="si">{</span><span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">predictor_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="c1"># Fit model</span>
                <span class="n">model_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">processed_data</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">original_training_data</span><span class="o">=</span><span class="n">group_data_no_group</span><span class="p">)</span>

                <span class="c1"># Set model names</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">model_fit</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span>
                        <span class="n">model_fit</span><span class="p">,</span>
                        <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
                        <span class="n">model_group_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">model_group_name</span>
                    <span class="p">)</span>

                <span class="c1"># Wrap in WorkflowFit</span>
                <span class="n">group_fit</span> <span class="o">=</span> <span class="n">WorkflowFit</span><span class="p">(</span>
                    <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">pre</span><span class="o">=</span><span class="n">global_recipe</span><span class="p">,</span>
                    <span class="n">fit</span><span class="o">=</span><span class="n">model_fit</span><span class="p">,</span>
                    <span class="n">post</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
                    <span class="n">formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span>
                    <span class="n">recipe_prepped_without_outcome</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Standard shared preprocessing</span>
                <span class="k">if</span> <span class="n">global_recipe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Recipe-based</span>
                    <span class="n">processed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_and_bake_with_outcome</span><span class="p">(</span>
                        <span class="n">global_recipe</span><span class="p">,</span>
                        <span class="n">group_data_no_group</span><span class="p">,</span>
                        <span class="n">outcome_col</span>
                    <span class="p">)</span>

                    <span class="c1"># Build formula</span>
                    <span class="n">predictor_cols</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">columns</span>
                        <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="n">outcome_col</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_datetime64_any_dtype</span><span class="p">(</span><span class="n">processed_data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
                    <span class="p">]</span>
                    <span class="n">formula</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s2"> ~ </span><span class="si">{</span><span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">predictor_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="c1"># Fit model</span>
                    <span class="n">model_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">processed_data</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">original_training_data</span><span class="o">=</span><span class="n">group_data_no_group</span><span class="p">)</span>

                    <span class="c1"># Set model names</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span>
                            <span class="n">model_fit</span><span class="p">,</span>
                            <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
                            <span class="n">model_group_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">model_group_name</span>
                        <span class="p">)</span>

                    <span class="c1"># Wrap in WorkflowFit</span>
                    <span class="n">group_fit</span> <span class="o">=</span> <span class="n">WorkflowFit</span><span class="p">(</span>
                        <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">pre</span><span class="o">=</span><span class="n">global_recipe</span><span class="p">,</span>
                        <span class="n">fit</span><span class="o">=</span><span class="n">model_fit</span><span class="p">,</span>
                        <span class="n">post</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
                        <span class="n">formula</span><span class="o">=</span><span class="n">formula</span>
                    <span class="p">)</span>
                    <span class="n">group_recipe</span> <span class="o">=</span> <span class="n">global_recipe</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Formula-based</span>
                    <span class="n">group_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">group_data_no_group</span><span class="p">)</span>
                    <span class="n">group_recipe</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">group_fit</span><span class="p">,</span> <span class="n">group_recipe</span><span class="p">,</span> <span class="n">group_train_data</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; failed with error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>

<div class="viewcode-block" id="Workflow.fit_nested">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.fit_nested">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_nested</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">per_group_prep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_group_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NestedWorkflowFit&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit separate models for each group in the data (panel/grouped modeling).</span>

<span class="sd">        This method fits one independent model per group value, useful for:</span>
<span class="sd">        - Multi-store sales forecasting (one model per store)</span>
<span class="sd">        - Multi-product demand forecasting (one model per product)</span>
<span class="sd">        - Multi-region time series (one model per region)</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Training data DataFrame with group column</span>
<span class="sd">            group_col: Column name containing group identifiers</span>
<span class="sd">            per_group_prep: If True, prep recipe separately for each group.</span>
<span class="sd">                           Enables group-specific feature engineering (PCA, feature selection).</span>
<span class="sd">                           Default: True (each group gets optimized preprocessing).</span>
<span class="sd">            min_group_size: Minimum samples required for per-group preprocessing.</span>
<span class="sd">                           Groups smaller than this use global recipe (if per_group_prep=True).</span>
<span class="sd">                           Default: 30.</span>
<span class="sd">            n_jobs: Number of parallel jobs. None or 1 for sequential execution,</span>
<span class="sd">                    -1 for all CPU cores, or positive integer for specific number of cores.</span>
<span class="sd">            verbose: If True, display progress messages</span>

<span class="sd">        Returns:</span>
<span class="sd">            NestedWorkflowFit containing dict of fitted models per group</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If group_col not in data or workflow doesn&#39;t have model</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Fit separate models for each store (shared preprocessing)</span>
<span class="sd">            &gt;&gt;&gt; wf = (</span>
<span class="sd">            ...     workflow()</span>
<span class="sd">            ...     .add_formula(&quot;sales ~ date&quot;)</span>
<span class="sd">            ...     .add_model(recursive_reg(base_model=rand_forest(), lags=7))</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; nested_fit = wf.fit_nested(data, group_col=&quot;store_id&quot;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Fit with parallel execution</span>
<span class="sd">            &gt;&gt;&gt; nested_fit = wf.fit_nested(data, group_col=&quot;store_id&quot;, n_jobs=-1, verbose=True)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Fit with per-group feature engineering (e.g., PCA)</span>
<span class="sd">            &gt;&gt;&gt; wf_pca = (</span>
<span class="sd">            ...     workflow()</span>
<span class="sd">            ...     .add_recipe(recipe().step_pca(num_comp=5))</span>
<span class="sd">            ...     .add_model(linear_reg())</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; nested_fit = wf_pca.fit_nested(</span>
<span class="sd">            ...     data,</span>
<span class="sd">            ...     group_col=&quot;store_id&quot;,</span>
<span class="sd">            ...     per_group_prep=True,  # Each group gets own PCA components</span>
<span class="sd">            ...     n_jobs=4  # Use 4 cores</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Predict for all groups</span>
<span class="sd">            &gt;&gt;&gt; predictions = nested_fit.predict(test_data)</span>
<span class="sd">            &gt;&gt;&gt; # Extract outputs with group column</span>
<span class="sd">            &gt;&gt;&gt; outputs, coeffs, stats = nested_fit.extract_outputs()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workflow must have a model specification&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">group_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group column &#39;</span><span class="si">{</span><span class="n">group_col</span><span class="si">}</span><span class="s2">&#39; not found in data&quot;</span><span class="p">)</span>

        <span class="c1"># Get unique groups</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">group_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="c1"># For per-group prep, we need a recipe (not just formula)</span>
        <span class="k">if</span> <span class="n">per_group_prep</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Recipe</span><span class="p">):</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;per_group_prep=True requires a recipe preprocessor. &quot;</span>
                <span class="s2">&quot;Workflow uses formula-only preprocessing. &quot;</span>
                <span class="s2">&quot;Falling back to per_group_prep=False.&quot;</span><span class="p">,</span>
                <span class="ne">UserWarning</span>
            <span class="p">)</span>
            <span class="n">per_group_prep</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Prep global/shared recipe if needed</span>
        <span class="n">global_recipe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">outcome_col_global</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">per_group_prep</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Recipe</span><span class="p">):</span>
            <span class="c1"># Detect outcome column from full data</span>
            <span class="c1"># For supervised feature selection, get outcome from recipe; otherwise auto-detect</span>
            <span class="n">outcome_col_global</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_outcome_from_recipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">outcome_col_global</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">outcome_col_global</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_outcome</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Check if recipe has supervised steps that need outcome during prep</span>
            <span class="n">needs_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recipe_requires_outcome</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">needs_outcome</span><span class="p">:</span>
                <span class="c1"># Prep with outcome included (for supervised feature selection)</span>
                <span class="n">prep_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">group_col</span><span class="p">])</span>
                <span class="n">global_recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">prep</span><span class="p">(</span><span class="n">prep_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Prep on predictors only (excluding outcome)</span>
                <span class="n">predictors_global</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">outcome_col_global</span><span class="p">,</span> <span class="n">group_col</span><span class="p">])</span>
                <span class="n">global_recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">prep</span><span class="p">(</span><span class="n">predictors_global</span><span class="p">)</span>

        <span class="c1"># Fit separate model for each group</span>
        <span class="n">group_fits</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">group_recipes</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">per_group_prep</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">group_train_data</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Store original training data per group (for date extraction)</span>

        <span class="c1"># Prepare list of group data</span>
        <span class="n">group_data_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">group</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">group_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>

        <span class="c1"># Validate and resolve n_jobs with warnings</span>
        <span class="n">effective_n_jobs</span> <span class="o">=</span> <span class="n">validate_n_jobs</span><span class="p">(</span><span class="n">n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Windows compatibility check</span>
        <span class="k">if</span> <span class="n">effective_n_jobs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">check_windows_compatibility</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Decide between sequential and parallel execution</span>
        <span class="k">if</span> <span class="n">effective_n_jobs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Sequential execution</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">format_parallel_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">),</span> <span class="s2">&quot;groups&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">group_data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">group_data_list</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_group</span><span class="p">(</span>
                    <span class="n">group</span><span class="p">,</span> <span class="n">group_data</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">per_group_prep</span><span class="p">,</span>
                    <span class="n">min_group_size</span><span class="p">,</span> <span class="n">global_recipe</span><span class="p">,</span> <span class="n">outcome_col_global</span>
                <span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">group</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Group </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">) complete&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Parallel execution</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">format_parallel_info</span><span class="p">(</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">),</span> <span class="s2">&quot;groups&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

            <span class="n">joblib_verbose</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">get_joblib_backend</span><span class="p">()</span>
            <span class="n">parallel_results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">joblib_verbose</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)(</span>
                <span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_group</span><span class="p">)(</span>
                    <span class="n">group</span><span class="p">,</span> <span class="n">group_data</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">per_group_prep</span><span class="p">,</span>
                    <span class="n">min_group_size</span><span class="p">,</span> <span class="n">global_recipe</span><span class="p">,</span> <span class="n">outcome_col_global</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="n">group_data_list</span>
            <span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">group_data_list</span><span class="p">],</span> <span class="n">parallel_results</span><span class="p">))</span>

        <span class="c1"># Process results</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="p">(</span><span class="n">group_fit</span><span class="p">,</span> <span class="n">group_recipe</span><span class="p">,</span> <span class="n">g_train_data</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group_fits</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_fit</span>
                <span class="k">if</span> <span class="n">per_group_prep</span> <span class="ow">and</span> <span class="n">group_recipe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">group_recipes</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_recipe</span>
                <span class="k">if</span> <span class="n">g_train_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">group_train_data</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_train_data</span>

        <span class="c1"># Print errors</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check if any groups were successfully fitted</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">group_fits</span><span class="p">:</span>
            <span class="n">error_summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">All </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2"> groups failed to fit. Errors:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">error</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">errors</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># Show first 10 errors</span>
                <span class="n">error_summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">error_summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more errors</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;fit_nested() failed: No groups were successfully fitted out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2"> total groups.</span><span class="si">{</span><span class="n">error_summary</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Nested fitting complete: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group_fits</span><span class="p">)</span><span class="si">}</span><span class="s2"> successful groups&quot;</span><span class="p">)</span>

        <span class="c1"># Skip the original loop code below (lines 820-1001)</span>
        <span class="c1"># Return early to avoid duplicate processing</span>
        <span class="k">return</span> <span class="n">NestedWorkflowFit</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">group_col</span><span class="o">=</span><span class="n">group_col</span><span class="p">,</span>
            <span class="n">group_fits</span><span class="o">=</span><span class="n">group_fits</span><span class="p">,</span>
            <span class="n">group_recipes</span><span class="o">=</span><span class="n">group_recipes</span><span class="p">,</span>
            <span class="n">group_train_data</span><span class="o">=</span><span class="n">group_train_data</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Workflow.fit_global">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.Workflow.fit_global">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowFit&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit a single global model using group as a feature.</span>

<span class="sd">        This method fits one model using all groups together, with the group</span>
<span class="sd">        column as an additional predictor. Useful when:</span>
<span class="sd">        - Groups share common patterns</span>
<span class="sd">        - Insufficient data per group for separate models</span>
<span class="sd">        - Want to capture cross-group effects</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Training data DataFrame with group column</span>
<span class="sd">            group_col: Column name containing group identifiers (used as feature)</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowFit with group column included as predictor</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If group_col not in data or workflow doesn&#39;t have model</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Fit single model using store_id as a feature</span>
<span class="sd">            &gt;&gt;&gt; wf = (</span>
<span class="sd">            ...     workflow()</span>
<span class="sd">            ...     .add_formula(&quot;sales ~ date + store_id&quot;)</span>
<span class="sd">            ...     .add_model(rand_forest())</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; global_fit = wf.fit_global(data, group_col=&quot;store_id&quot;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Group column is automatically included as predictor</span>
<span class="sd">            &gt;&gt;&gt; predictions = global_fit.predict(test_data)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workflow must have a model specification&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">group_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group column &#39;</span><span class="si">{</span><span class="n">group_col</span><span class="si">}</span><span class="s2">&#39; not found in data&quot;</span><span class="p">)</span>

        <span class="c1"># Update formula to include group column as a feature</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span>

            <span class="c1"># Validate formula structure</span>
            <span class="k">if</span> <span class="s1">&#39;~&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid formula format: </span><span class="si">{</span><span class="n">formula</span><span class="si">}</span><span class="s2">. Formula must contain &#39;~&#39;&quot;</span><span class="p">)</span>

            <span class="c1"># Robust formula parsing with whitespace normalization</span>
            <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">formula</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="n">lhs</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">predictors</span> <span class="o">=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># Check if group_col is already in the formula</span>
            <span class="c1"># Split predictors on &#39;+&#39; and check each term</span>
            <span class="n">predictor_terms</span> <span class="o">=</span> <span class="p">[</span><span class="n">term</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">predictors</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)]</span>

            <span class="k">if</span> <span class="n">group_col</span> <span class="ow">in</span> <span class="n">predictor_terms</span> <span class="ow">or</span> <span class="n">predictors</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
                <span class="c1"># group_col already in formula or using &quot;.&quot; notation (includes all columns)</span>
                <span class="n">updated_formula</span> <span class="o">=</span> <span class="n">formula</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Add group_col explicitly</span>
                <span class="n">updated_formula</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outcome</span><span class="si">}</span><span class="s2"> ~ </span><span class="si">{</span><span class="n">predictors</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="n">group_col</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Update workflow with new formula</span>
            <span class="n">updated_workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_formula</span><span class="p">(</span><span class="n">updated_formula</span><span class="p">)</span>
            <span class="n">fit_result</span> <span class="o">=</span> <span class="n">updated_workflow</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1"># Mark this as a global fit and store the group column</span>
            <span class="n">fit_result</span><span class="o">.</span><span class="n">is_global_fit</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fit_result</span><span class="o">.</span><span class="n">group_col</span> <span class="o">=</span> <span class="n">group_col</span>
            <span class="c1"># Store group column values from training data (indexed by original data index)</span>
            <span class="n">fit_result</span><span class="o">.</span><span class="n">_train_group_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">group_col</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">group_col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">fit_result</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Recipe</span><span class="p">):</span>
            <span class="c1"># For recipes, group column will be included automatically if present in data</span>
            <span class="n">fit_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1"># Mark this as a global fit and store the group column</span>
            <span class="n">fit_result</span><span class="o">.</span><span class="n">is_global_fit</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fit_result</span><span class="o">.</span><span class="n">group_col</span> <span class="o">=</span> <span class="n">group_col</span>
            <span class="c1"># Store group column values from training data (indexed by original data index)</span>
            <span class="n">fit_result</span><span class="o">.</span><span class="n">_train_group_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">group_col</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">group_col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">fit_result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workflow must have a formula or recipe preprocessor&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="WorkflowFit">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.WorkflowFit">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WorkflowFit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fitted workflow containing preprocessing and model fit.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        workflow: Original Workflow specification</span>
<span class="sd">        pre: Fitted preprocessor (formula or recipe)</span>
<span class="sd">        fit: ModelFit object from parsnip</span>
<span class="sd">        post: Post-processing steps (future use)</span>
<span class="sd">        formula: Formula used for model fitting (stored for convenience)</span>
<span class="sd">        recipe_prepped_without_outcome: Whether recipe was prepped excluding outcome column</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; wf_fit = workflow().add_formula(&quot;y ~ x&quot;).add_model(spec).fit(train)</span>
<span class="sd">        &gt;&gt;&gt; predictions = wf_fit.predict(test)</span>
<span class="sd">        &gt;&gt;&gt; outputs, coeffs, stats = wf_fit.extract_outputs()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">workflow</span><span class="p">:</span> <span class="n">Workflow</span>
    <span class="n">pre</span><span class="p">:</span> <span class="n">Any</span>  <span class="c1"># Fitted preprocessor (formula string or PreparedRecipe)</span>
    <span class="n">fit</span><span class="p">:</span> <span class="n">ModelFit</span>
    <span class="n">post</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Formula used for model fitting</span>
    <span class="n">recipe_prepped_without_outcome</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># True only for per-group preprocessing</span>
    <span class="n">is_global_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># True if created via fit_global()</span>
    <span class="n">group_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Group column name for global fits (for plotting)</span>
    <span class="n">_train_group_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Original group values from training data</span>
    <span class="n">_test_group_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Original group values from test data</span>

<div class="viewcode-block" id="WorkflowFit.predict">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.WorkflowFit.predict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">new_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;numeric&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate predictions using the fitted workflow.</span>

<span class="sd">        Automatically applies preprocessing before prediction.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_data: New data for prediction</span>
<span class="sd">            type: Prediction type (&quot;numeric&quot;, &quot;conf_int&quot;, &quot;pred_int&quot;, etc.)</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with predictions</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; predictions = wf_fit.predict(test_data)</span>
<span class="sd">            &gt;&gt;&gt; # With prediction intervals</span>
<span class="sd">            &gt;&gt;&gt; predictions = wf_fit.predict(test_data, type=&quot;pred_int&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Apply preprocessing to new data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Formula - pass data directly to model (forge() handles it)</span>
            <span class="n">processed_data</span> <span class="o">=</span> <span class="n">new_data</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">,</span> <span class="n">PreparedRecipe</span><span class="p">):</span>
            <span class="c1"># Recipe - apply fitted transformations</span>
            <span class="n">processed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown preprocessor type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Model prediction (handles forge() internally)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">processed_data</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">predictions</span></div>


<div class="viewcode-block" id="WorkflowFit.evaluate">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.WorkflowFit.evaluate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">test_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">outcome_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowFit&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate workflow on test data.</span>

<span class="sd">        Stores test predictions for comprehensive train/test metrics.</span>

<span class="sd">        Args:</span>
<span class="sd">            test_data: Test data with actual outcomes</span>
<span class="sd">            outcome_col: Name of outcome column (auto-detected if None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Self for method chaining</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; wf_fit = wf.fit(train).evaluate(test)</span>
<span class="sd">            &gt;&gt;&gt; outputs, coeffs, stats = wf_fit.extract_outputs()</span>
<span class="sd">            &gt;&gt;&gt; # Now outputs includes both train and test observations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Apply preprocessing to test data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Formula - pass data directly to model (forge() handles it)</span>
            <span class="n">processed_test_data</span> <span class="o">=</span> <span class="n">test_data</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">,</span> <span class="n">PreparedRecipe</span><span class="p">):</span>
            <span class="c1"># Recipe - apply fitted transformations</span>

            <span class="c1"># Only separate outcome if recipe was prepped WITHOUT outcome (per-group case)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipe_prepped_without_outcome</span><span class="p">:</span>
                <span class="c1"># Per-group preprocessing: recipe prepped on predictors only</span>
                <span class="c1"># IMPORTANT: Preserve outcome column during baking</span>

                <span class="c1"># Detect outcome column if not provided</span>
                <span class="k">if</span> <span class="n">outcome_col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># For supervised steps, get outcome from recipe; otherwise auto-detect</span>
                    <span class="n">outcome_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">_get_outcome_from_recipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">outcome_col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">outcome_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">_detect_outcome</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

                <span class="c1"># Check if outcome exists in test data</span>
                <span class="k">if</span> <span class="n">outcome_col</span> <span class="ow">in</span> <span class="n">test_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="c1"># Check if recipe has supervised steps that need outcome during bake</span>
                    <span class="n">needs_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">_recipe_requires_outcome</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">needs_outcome</span><span class="p">:</span>
                        <span class="c1"># Bake with outcome included (for supervised feature selection)</span>
                        <span class="n">processed_test_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Separate outcome from predictors</span>
                        <span class="n">outcome</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="n">outcome_col</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">predictors</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">outcome_col</span><span class="p">])</span>

                        <span class="c1"># Bake predictors only</span>
                        <span class="n">processed_predictors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>

                        <span class="c1"># Recombine with outcome (align by index to handle step_naomit)</span>
                        <span class="n">processed_test_data</span> <span class="o">=</span> <span class="n">processed_predictors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">processed_test_data</span><span class="p">[</span><span class="n">outcome_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">outcome</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">processed_predictors</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># No outcome in test data (prediction only scenario)</span>
                    <span class="n">processed_test_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Standard workflow: recipe prepped on all data including outcome</span>
                <span class="c1"># Bake normally (recipe expects outcome to be present)</span>
                <span class="n">processed_test_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown preprocessor type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Delegate to the underlying ModelFit with both original and preprocessed data</span>
        <span class="c1"># Pass original test data so engines can access raw datetime/categorical values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">processed_test_data</span><span class="p">,</span> <span class="n">outcome_col</span><span class="p">,</span> <span class="n">original_test_data</span><span class="o">=</span><span class="n">test_data</span><span class="p">)</span>

        <span class="c1"># For global fits, store test group values for plotting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_global_fit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_col</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_col</span> <span class="ow">in</span> <span class="n">test_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_test_group_values</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="WorkflowFit.extract_fit_parsnip">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_fit_parsnip">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_fit_parsnip</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelFit</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the underlying parsnip ModelFit.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ModelFit object</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; model_fit = wf_fit.extract_fit_parsnip()</span>
<span class="sd">            &gt;&gt;&gt; # Access underlying model</span>
<span class="sd">            &gt;&gt;&gt; sklearn_model = model_fit.fit_data[&quot;model&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span></div>


<div class="viewcode-block" id="WorkflowFit.extract_preprocessor">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_preprocessor">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_preprocessor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the fitted preprocessor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formula string or PreparedRecipe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre</span></div>


<div class="viewcode-block" id="WorkflowFit.extract_spec_parsnip">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_spec_parsnip">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_spec_parsnip</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelSpec</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the model specification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ModelSpec object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">spec</span></div>


<div class="viewcode-block" id="WorkflowFit.extract_outputs">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_outputs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract comprehensive three-DataFrame outputs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (outputs, coefficients, stats) DataFrames per</span>
<span class="sd">            .claude_plans/model_outputs.md specification</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; outputs, coefficients, stats = wf_fit.extract_outputs()</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Outputs: observation-level results</span>
<span class="sd">            &gt;&gt;&gt; print(outputs[[&quot;actuals&quot;, &quot;fitted&quot;, &quot;forecast&quot;, &quot;split&quot;]])</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Coefficients: variable-level parameters</span>
<span class="sd">            &gt;&gt;&gt; print(coefficients[[&quot;variable&quot;, &quot;coefficient&quot;, &quot;p_value&quot;]])</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Stats: model-level metrics by split</span>
<span class="sd">            &gt;&gt;&gt; print(stats[stats[&quot;metric&quot;].isin([&quot;rmse&quot;, &quot;mae&quot;, &quot;r_squared&quot;])])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">,</span> <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">extract_outputs</span><span class="p">()</span>

        <span class="c1"># For global fits, replace the &#39;group&#39; column with original group values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_global_fit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_col</span> <span class="ow">and</span> <span class="s1">&#39;group&#39;</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># Combine train and test group values</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_group_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_group_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Create combined group DataFrame indexed by original data indices</span>
                <span class="n">all_group_values</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_group_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">all_group_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_train_group_values</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_group_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">all_group_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_group_values</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">all_group_values</span><span class="p">:</span>
                    <span class="n">combined_groups</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_group_values</span><span class="p">)</span>
                    <span class="c1"># Map original indices to group values</span>
                    <span class="c1"># outputs index should match the original data indices</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">combined_groups</span><span class="p">):</span>
                        <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_groups</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Reorder columns for consistent ordering: date first, then core columns</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">py_parsnip.utils.output_ordering</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">reorder_outputs_columns</span><span class="p">,</span>
            <span class="n">reorder_coefficients_columns</span><span class="p">,</span>
            <span class="n">reorder_stats_columns</span>
        <span class="p">)</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="n">reorder_outputs_columns</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">group_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">coefficients</span> <span class="o">=</span> <span class="n">reorder_coefficients_columns</span><span class="p">(</span><span class="n">coefficients</span><span class="p">,</span> <span class="n">group_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">reorder_stats_columns</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">group_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">,</span> <span class="n">stats</span></div>


<div class="viewcode-block" id="WorkflowFit.extract_formula">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_formula">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the formula used for model fitting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Formula string (e.g., &quot;y ~ x1 + x2&quot;)</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; wf_fit = workflow().add_formula(&quot;sales ~ price&quot;).add_model(spec).fit(train)</span>
<span class="sd">            &gt;&gt;&gt; formula = wf_fit.extract_formula()</span>
<span class="sd">            &gt;&gt;&gt; print(formula)</span>
<span class="sd">            &#39;sales ~ price&#39;</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # For recipes, returns auto-generated formula</span>
<span class="sd">            &gt;&gt;&gt; rec = recipe().step_normalize()</span>
<span class="sd">            &gt;&gt;&gt; wf_fit = workflow().add_recipe(rec).add_model(spec).fit(train)</span>
<span class="sd">            &gt;&gt;&gt; formula = wf_fit.extract_formula()</span>
<span class="sd">            &gt;&gt;&gt; print(formula)</span>
<span class="sd">            &#39;y ~ x1 + x2 + x3&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No formula stored in WorkflowFit&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span></div>


<div class="viewcode-block" id="WorkflowFit.extract_preprocessed_data">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_preprocessed_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_preprocessed_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the fitted preprocessor to data and return transformed data.</span>

<span class="sd">        This is a convenience function to get the preprocessed data that would</span>
<span class="sd">        be used by the model, useful for:</span>
<span class="sd">        - Inspecting transformed features</span>
<span class="sd">        - Understanding what the model actually sees</span>
<span class="sd">        - Debugging preprocessing pipelines</span>
<span class="sd">        - Manual analysis of transformed data</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Data to preprocess (train or test data)</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with preprocessing applied</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # With formula</span>
<span class="sd">            &gt;&gt;&gt; wf_fit = workflow().add_formula(&quot;y ~ x1 + x2&quot;).add_model(spec).fit(train)</span>
<span class="sd">            &gt;&gt;&gt; train_transformed = wf_fit.extract_preprocessed_data(train)</span>
<span class="sd">            &gt;&gt;&gt; test_transformed = wf_fit.extract_preprocessed_data(test)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # With recipe</span>
<span class="sd">            &gt;&gt;&gt; rec = recipe().step_normalize().step_dummy()</span>
<span class="sd">            &gt;&gt;&gt; wf_fit = workflow().add_recipe(rec).add_model(spec).fit(train)</span>
<span class="sd">            &gt;&gt;&gt; train_transformed = wf_fit.extract_preprocessed_data(train)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Inspect transformed columns</span>
<span class="sd">            &gt;&gt;&gt; print(train_transformed.columns)</span>
<span class="sd">            &gt;&gt;&gt; print(train_transformed.head())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Formula - use mold() to get preprocessed data</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">py_hardhat</span><span class="w"> </span><span class="kn">import</span> <span class="n">mold</span>
            <span class="n">molded</span> <span class="o">=</span> <span class="n">mold</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="c1"># Return predictors and outcomes combined</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">molded</span><span class="o">.</span><span class="n">predictors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># Add outcome column(s) if present</span>
            <span class="k">if</span> <span class="n">molded</span><span class="o">.</span><span class="n">outcomes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">molded</span><span class="o">.</span><span class="n">outcomes</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">molded</span><span class="o">.</span><span class="n">outcomes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">molded</span><span class="o">.</span><span class="n">outcomes</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">,</span> <span class="n">PreparedRecipe</span><span class="p">):</span>
            <span class="c1"># Recipe - use bake()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown preprocessor type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>
</div>



<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NestedWorkflowFit</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fitted workflow with separate models for each group (panel/grouped modeling).</span>

<span class="sd">    This class holds multiple fitted models, one per group, enabling</span>
<span class="sd">    independent forecasting for each group while maintaining a unified interface.</span>

<span class="sd">    When per_group_prep=True, also stores separate recipes per group, enabling</span>
<span class="sd">    group-specific feature engineering (e.g., different PCA components per group).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        workflow: Original Workflow specification</span>
<span class="sd">        group_col: Column name containing group identifiers</span>
<span class="sd">        group_fits: Dict mapping group values to WorkflowFit objects</span>
<span class="sd">        group_recipes: Optional dict mapping group values to PreparedRecipe objects</span>
<span class="sd">                      (None if per_group_prep=False)</span>
<span class="sd">        group_train_data: Dict mapping group values to original training data</span>
<span class="sd">                         (for date extraction in extract_outputs)</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Standard nested fit (shared preprocessing)</span>
<span class="sd">        &gt;&gt;&gt; wf = workflow().add_formula(&quot;sales ~ date&quot;).add_model(spec)</span>
<span class="sd">        &gt;&gt;&gt; nested_fit = wf.fit_nested(data, group_col=&quot;store_id&quot;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Nested fit with per-group feature engineering</span>
<span class="sd">        &gt;&gt;&gt; wf_pca = (</span>
<span class="sd">        ...     workflow()</span>
<span class="sd">        ...     .add_recipe(recipe().step_pca(num_comp=5))</span>
<span class="sd">        ...     .add_model(linear_reg())</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; nested_fit = wf_pca.fit_nested(</span>
<span class="sd">        ...     data,</span>
<span class="sd">        ...     group_col=&quot;store_id&quot;,</span>
<span class="sd">        ...     per_group_prep=True</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Predict for all groups (automatic routing)</span>
<span class="sd">        &gt;&gt;&gt; predictions = nested_fit.predict(test_data)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Compare features across groups</span>
<span class="sd">        &gt;&gt;&gt; feature_comp = nested_fit.get_feature_comparison()</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Extract outputs with group column</span>
<span class="sd">        &gt;&gt;&gt; outputs, coeffs, stats = nested_fit.extract_outputs()</span>
<span class="sd">        &gt;&gt;&gt; print(outputs[[&quot;date&quot;, &quot;group&quot;, &quot;actuals&quot;, &quot;forecast&quot;]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">workflow</span><span class="p">:</span> <span class="n">Workflow</span>
    <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">group_fits</span><span class="p">:</span> <span class="nb">dict</span>  <span class="c1"># {group_value: WorkflowFit}</span>
    <span class="n">group_recipes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>  <span class="c1"># {group_value: PreparedRecipe} or None</span>
    <span class="n">group_train_data</span><span class="p">:</span> <span class="nb">dict</span>  <span class="c1"># {group_value: DataFrame} - original training data with dates</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">new_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;numeric&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate predictions for all groups.</span>

<span class="sd">        Automatically routes each row to the appropriate group model.</span>
<span class="sd">        If per_group_prep=True was used during fitting, applies group-specific</span>
<span class="sd">        preprocessing (recipes) before prediction.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_data: New data with group column</span>
<span class="sd">            type: Prediction type (&quot;numeric&quot;, &quot;conf_int&quot;, &quot;pred_int&quot;, etc.)</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with predictions and group column</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If group_col not in new_data or new groups encountered</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; predictions = nested_fit.predict(test_data)</span>
<span class="sd">            &gt;&gt;&gt; predictions = nested_fit.predict(test_data, type=&quot;pred_int&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="si">}</span><span class="s2">&#39; not found in new_data&quot;</span><span class="p">)</span>

        <span class="c1"># Check for new groups not seen during training</span>
        <span class="n">new_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="n">training_groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">unseen_groups</span> <span class="o">=</span> <span class="n">new_groups</span> <span class="o">-</span> <span class="n">training_groups</span>

        <span class="k">if</span> <span class="n">unseen_groups</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;New group(s) not seen during training: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">unseen_groups</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Available groups: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">training_groups</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot predict for unseen groups.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Get predictions for each group</span>
        <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">is_recursive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">spec</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;recursive_reg&quot;</span>

        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">group_fit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Filter data for this group</span>
            <span class="n">group_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="n">new_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Skip groups not in new_data</span>

            <span class="c1"># For recursive models, set date as index if needed</span>
            <span class="k">if</span> <span class="n">is_recursive</span> <span class="ow">and</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="n">group_data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                <span class="c1"># Set date as index before removing group column (recursive models need this)</span>
                <span class="n">group_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
                <span class="n">group_data_no_group</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Remove group column before prediction</span>
                <span class="n">group_data_no_group</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">])</span>

            <span class="c1"># Apply group-specific preprocessing if available</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_recipes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Per-group preprocessing: bake with group&#39;s recipe</span>
                <span class="n">group_recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_recipes</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
                <span class="n">processed_data</span> <span class="o">=</span> <span class="n">group_recipe</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">group_data_no_group</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Standard preprocessing: will be applied inside group_fit.predict()</span>
                <span class="n">processed_data</span> <span class="o">=</span> <span class="n">group_data_no_group</span>

            <span class="c1"># Get predictions</span>
            <span class="n">group_preds</span> <span class="o">=</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">processed_data</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>

            <span class="c1"># Add group column back</span>
            <span class="n">group_preds</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>

            <span class="n">all_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_preds</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_predictions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No matching groups found in new_data&quot;</span><span class="p">)</span>

        <span class="c1"># Combine predictions from all groups</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_predictions</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">test_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">outcome_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;NestedWorkflowFit&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate all group models on test data.</span>

<span class="sd">        Args:</span>
<span class="sd">            test_data: Test data with actual outcomes and group column</span>
<span class="sd">            outcome_col: Name of outcome column (auto-detected if None)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Self for method chaining</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; nested_fit = wf.fit_nested(train, &quot;store_id&quot;)</span>
<span class="sd">            &gt;&gt;&gt; nested_fit = nested_fit.evaluate(test)</span>
<span class="sd">            &gt;&gt;&gt; outputs, coeffs, stats = nested_fit.extract_outputs()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">test_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="si">}</span><span class="s2">&#39; not found in test_data&quot;</span><span class="p">)</span>

        <span class="c1"># Store original test data per group for date extraction later</span>
        <span class="c1"># This is needed because recipes may exclude date columns during preprocessing</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;group_test_data&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_test_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Evaluate each group model</span>
        <span class="n">is_recursive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">spec</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;recursive_reg&quot;</span>

        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">group_fit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Filter data for this group</span>
            <span class="n">group_data</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="n">test_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Skip groups not in test_data</span>

            <span class="c1"># Store original group test data (WITH group column, date, etc.)</span>
            <span class="c1"># This preserves date column for later extraction in extract_outputs()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_test_data</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># For recursive models, set date as index if needed</span>
            <span class="k">if</span> <span class="n">is_recursive</span> <span class="ow">and</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="n">group_data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                <span class="c1"># Set date as index before removing group column (recursive models need this)</span>
                <span class="n">group_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
                <span class="n">group_data_no_group</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Remove group column before evaluation</span>
                <span class="n">group_data_no_group</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">])</span>

            <span class="c1"># Evaluate this group&#39;s model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">group_data_no_group</span><span class="p">,</span> <span class="n">outcome_col</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_feature_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compare which features are used by each group.</span>

<span class="sd">        Only applicable when per_group_prep=True was used during fitting.</span>
<span class="sd">        Returns a DataFrame showing which features are present for each group,</span>
<span class="sd">        enabling cross-group comparison of feature engineering results.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with groups as rows, features as columns,</span>
<span class="sd">            bool values indicating if feature is present for that group.</span>
<span class="sd">            Returns None if per_group_prep=False (shared preprocessing).</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # After fitting with per_group_prep=True</span>
<span class="sd">            &gt;&gt;&gt; nested_fit = wf.fit_nested(data, group_col=&quot;country&quot;, per_group_prep=True)</span>
<span class="sd">            &gt;&gt;&gt; comparison = nested_fit.get_feature_comparison()</span>
<span class="sd">            &gt;&gt;&gt; print(comparison)</span>
<span class="sd">            #           PC1    PC2    PC3    PC4    PC5</span>
<span class="sd">            # USA      True   True   True   True  False</span>
<span class="sd">            # UK       True   True   True  False  False</span>
<span class="sd">            # Canada   True   True   True   True   True</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # See which features are shared vs group-specific</span>
<span class="sd">            &gt;&gt;&gt; shared_features = comparison.columns[comparison.all()]</span>
<span class="sd">            &gt;&gt;&gt; group_specific = comparison.columns[~comparison.all()]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_recipes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No per-group preprocessing. All groups use the same features.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Get feature names from each group&#39;s workflow fit</span>
        <span class="n">feature_usage</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_features</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Method 1: Try to get from model fit&#39;s molded data</span>
                <span class="n">group_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="p">,</span> <span class="s1">&#39;molded&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">molded</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">molded</span><span class="o">.</span><span class="n">predictors</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                    <span class="n">feature_usage</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
                    <span class="n">all_features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># Method 2: Try to get from formula</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">group_fit</span><span class="p">,</span> <span class="s1">&#39;formula&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">formula</span><span class="p">:</span>
                    <span class="c1"># Parse formula to get predictor names</span>
                    <span class="c1"># Formula format: &quot;outcome ~ pred1 + pred2 + pred3&quot;</span>
                    <span class="n">formula</span> <span class="o">=</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">formula</span>
                    <span class="k">if</span> <span class="s1">&#39;~&#39;</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">:</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="n">formula</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="c1"># Split by + and clean up whitespace</span>
                        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">rhs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)]</span>
                        <span class="n">feature_usage</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
                        <span class="n">all_features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="c1"># Method 3: Get from model&#39;s training data or fit_data</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="p">,</span> <span class="s1">&#39;fit_data&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;X&#39;</span> <span class="ow">in</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">fit_data</span><span class="p">:</span>
                    <span class="n">X</span> <span class="o">=</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">):</span>
                        <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                        <span class="n">feature_usage</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
                        <span class="n">all_features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="c1"># If all methods fail, mark as empty</span>
                <span class="n">feature_usage</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Could not extract feature names for group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="ne">UserWarning</span>
                <span class="p">)</span>
                <span class="n">feature_usage</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_features</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not determine feature names from any group.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Create comparison DataFrame</span>
        <span class="n">comparison</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="n">feature</span><span class="p">:</span> <span class="p">[</span><span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
                      <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
             <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_features</span><span class="p">)},</span>
            <span class="n">index</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">comparison</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract comprehensive three-DataFrame outputs for all groups.</span>

<span class="sd">        Combines outputs from all group models and adds group column.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (outputs, coefficients, stats) DataFrames</span>
<span class="sd">            - outputs: Includes &#39;group&#39; column showing which group each row belongs to</span>
<span class="sd">            - coefficients: Includes &#39;group&#39; column</span>
<span class="sd">            - stats: Includes &#39;group&#39; column</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; outputs, coefficients, stats = nested_fit.extract_outputs()</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Filter to specific group</span>
<span class="sd">            &gt;&gt;&gt; store_a_outputs = outputs[outputs[&quot;group&quot;] == &quot;A&quot;]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Compare metrics across groups</span>
<span class="sd">            &gt;&gt;&gt; test_rmse = stats[</span>
<span class="sd">            ...     (stats[&quot;metric&quot;] == &quot;rmse&quot;) &amp;</span>
<span class="sd">            ...     (stats[&quot;split&quot;] == &quot;test&quot;)</span>
<span class="sd">            ... ][[&quot;group&quot;, &quot;value&quot;]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if any groups were successfully fitted</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;No groups were successfully fitted. This can happen if:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;1. All groups failed during fit_nested() due to errors (check for warnings)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;2. The group column has no unique values</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;3. All groups had insufficient data for model fitting</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Tip: Try running fit_nested() with verbose=True to see per-group fitting status.&quot;</span>
            <span class="p">)</span>

        <span class="n">all_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_coefficients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_stats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">extraction_errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">group_fit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Extract outputs for this group</span>
                <span class="n">outputs</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">,</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">extract_outputs</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">extraction_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>  <span class="c1"># Skip this group and continue with others</span>

            <span class="c1"># Preserve date information if available in index or molded data</span>
            <span class="c1"># This is needed for plot_forecast() to work</span>
            <span class="k">if</span> <span class="s2">&quot;date&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="c1"># Make a copy to avoid SettingWithCopyWarning</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="c1"># Try to get TRAINING dates from stored group_train_data (PRIMARY source)</span>
                <span class="c1"># This is more reliable than molded data because it preserves original unprocessed data</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;group_train_data&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_train_data</span><span class="p">:</span>
                    <span class="n">train_data_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_train_data</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="n">train_data_orig</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">train_dates</span> <span class="o">=</span> <span class="n">train_data_orig</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                        <span class="n">train_mask</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span>
                        <span class="k">if</span> <span class="n">train_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dates</span><span class="p">):</span>
                            <span class="n">outputs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_mask</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dates</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">train_data_orig</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                        <span class="n">train_dates</span> <span class="o">=</span> <span class="n">train_data_orig</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                        <span class="n">train_mask</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span>
                        <span class="k">if</span> <span class="n">train_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dates</span><span class="p">):</span>
                            <span class="n">outputs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_mask</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dates</span>
                <span class="c1"># Fallback: Try to get date from the fit&#39;s molded data (training data)</span>
                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="p">,</span> <span class="s1">&#39;molded&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">molded</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">molded_outcomes</span> <span class="o">=</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">molded</span><span class="o">.</span><span class="n">outcomes</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">molded_outcomes</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">molded_outcomes</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                        <span class="c1"># Date is in the outcomes index</span>
                        <span class="n">date_index</span> <span class="o">=</span> <span class="n">molded_outcomes</span><span class="o">.</span><span class="n">index</span>
                        <span class="n">train_mask</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span>
                        <span class="k">if</span> <span class="n">train_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">date_index</span><span class="p">):</span>
                            <span class="n">outputs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_mask</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_index</span><span class="o">.</span><span class="n">values</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">molded_outcomes</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">molded_outcomes</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                        <span class="c1"># Outcomes is a Series with date index</span>
                        <span class="n">date_index</span> <span class="o">=</span> <span class="n">molded_outcomes</span><span class="o">.</span><span class="n">index</span>
                        <span class="n">train_mask</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span>
                        <span class="k">if</span> <span class="n">train_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">date_index</span><span class="p">):</span>
                            <span class="n">outputs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_mask</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_index</span><span class="o">.</span><span class="n">values</span>

                <span class="c1"># Try to get TEST dates from stored group_test_data (PRIMARY source)</span>
                <span class="c1"># This is more reliable than evaluation_data because it preserves original unprocessed data</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;group_test_data&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_test_data</span><span class="p">:</span>
                    <span class="n">test_data_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_test_data</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="n">test_data_orig</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">test_dates</span> <span class="o">=</span> <span class="n">test_data_orig</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                        <span class="n">test_mask</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span>
                        <span class="k">if</span> <span class="n">test_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_dates</span><span class="p">):</span>
                            <span class="n">outputs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_mask</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dates</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_data_orig</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                        <span class="n">test_dates</span> <span class="o">=</span> <span class="n">test_data_orig</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                        <span class="n">test_mask</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span>
                        <span class="k">if</span> <span class="n">test_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_dates</span><span class="p">):</span>
                            <span class="n">outputs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_mask</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dates</span>
                <span class="c1"># Fallback: Try to get test dates from evaluation data (processed data - may not have date)</span>
                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="p">,</span> <span class="s1">&#39;evaluation_data&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;test_data&quot;</span> <span class="ow">in</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">evaluation_data</span><span class="p">:</span>
                    <span class="n">test_data</span> <span class="o">=</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">evaluation_data</span><span class="p">[</span><span class="s2">&quot;test_data&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="n">test_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">test_dates</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                        <span class="n">test_mask</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span>
                        <span class="k">if</span> <span class="n">test_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_dates</span><span class="p">):</span>
                            <span class="n">outputs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_mask</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dates</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                        <span class="n">test_dates</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                        <span class="n">test_mask</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span>
                        <span class="k">if</span> <span class="n">test_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_dates</span><span class="p">):</span>
                            <span class="n">outputs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_mask</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dates</span>

            <span class="c1"># Add group column (both specific and generic)</span>
            <span class="n">outputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>
            <span class="n">coefficients</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>
            <span class="n">stats</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>

            <span class="c1"># FIX: Also update the generic &#39;group&#39; column</span>
            <span class="c1"># This ensures df[df[&#39;group&#39;] == &#39;USA&#39;] filtering works</span>
            <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>
            <span class="n">coefficients</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>

            <span class="n">all_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
            <span class="n">all_coefficients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span>
            <span class="n">all_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>

        <span class="c1"># Check if any outputs were successfully extracted</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_outputs</span><span class="p">:</span>
            <span class="n">error_summary</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Extraction failed for all groups. Errors:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">error</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">extraction_errors</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">error_summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extraction_errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">error_summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">extraction_errors</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more errors</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;extract_outputs() failed: No outputs could be extracted from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="p">)</span><span class="si">}</span><span class="s2"> fitted groups.</span><span class="si">{</span><span class="n">error_summary</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Print warnings if some (but not all) groups failed</span>
        <span class="k">if</span> <span class="n">extraction_errors</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">extraction_errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> group(s) failed during output extraction:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">extraction_errors</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extraction_errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">extraction_errors</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="si">}</span><span class="s2"> more errors&quot;</span><span class="p">)</span>

        <span class="c1"># Combine all groups (preserve dates if present)</span>
        <span class="n">combined_outputs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_outputs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">combined_coefficients</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_coefficients</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">combined_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_stats</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Reorder columns for consistent ordering: date first, group second, then core columns</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">py_parsnip.utils.output_ordering</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">reorder_outputs_columns</span><span class="p">,</span>
            <span class="n">reorder_coefficients_columns</span><span class="p">,</span>
            <span class="n">reorder_stats_columns</span>
        <span class="p">)</span>

        <span class="n">combined_outputs</span> <span class="o">=</span> <span class="n">reorder_outputs_columns</span><span class="p">(</span><span class="n">combined_outputs</span><span class="p">,</span> <span class="n">group_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">)</span>
        <span class="n">combined_coefficients</span> <span class="o">=</span> <span class="n">reorder_coefficients_columns</span><span class="p">(</span><span class="n">combined_coefficients</span><span class="p">,</span> <span class="n">group_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">)</span>
        <span class="n">combined_stats</span> <span class="o">=</span> <span class="n">reorder_stats_columns</span><span class="p">(</span><span class="n">combined_stats</span><span class="p">,</span> <span class="n">group_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">combined_outputs</span><span class="p">,</span> <span class="n">combined_coefficients</span><span class="p">,</span> <span class="n">combined_stats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_preprocessed_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract preprocessed data showing what the models see after recipe transformations.</span>

<span class="sd">        This is useful for inspecting how recipes transform your data, especially with</span>
<span class="sd">        per-group preprocessing where each group may have different transformations</span>
<span class="sd">        (e.g., different PCA components, different selected features).</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Original data to preprocess (train or test data with group column)</span>
<span class="sd">            split: Which data split this is (&quot;train&quot; or &quot;test&quot;) - for informational purposes</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with preprocessed data for all groups, including group column</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Fit nested workflow with per-group preprocessing</span>
<span class="sd">            &gt;&gt;&gt; wf = workflow().add_recipe(recipe().step_normalize()).add_model(linear_reg())</span>
<span class="sd">            &gt;&gt;&gt; nested_fit = wf.fit_nested(train_data, group_col=&#39;country&#39;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Extract preprocessed training data</span>
<span class="sd">            &gt;&gt;&gt; processed_train = nested_fit.extract_preprocessed_data(train_data, split=&#39;train&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(processed_train.head())</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # After evaluation, extract preprocessed test data</span>
<span class="sd">            &gt;&gt;&gt; nested_fit = nested_fit.evaluate(test_data)</span>
<span class="sd">            &gt;&gt;&gt; processed_test = nested_fit.extract_preprocessed_data(test_data, split=&#39;test&#39;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Compare preprocessing across groups</span>
<span class="sd">            &gt;&gt;&gt; for group in processed_train[nested_fit.group_col].unique():</span>
<span class="sd">            ...     group_data = processed_train[processed_train[nested_fit.group_col] == group]</span>
<span class="sd">            ...     print(f&quot;{group}: mean={group_data[&#39;x1&#39;].mean():.4f}, std={group_data[&#39;x1&#39;].std():.4f}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="si">}</span><span class="s2">&#39; not found in data&quot;</span><span class="p">)</span>

        <span class="c1"># Process each group</span>
        <span class="n">processed_groups</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="c1"># Get data for this group</span>
            <span class="n">group_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Remove group column before preprocessing (it&#39;s metadata, not a predictor)</span>
            <span class="n">group_data_no_group</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">])</span>

            <span class="c1"># Apply preprocessing based on whether per-group recipes exist</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_recipes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_recipes</span><span class="p">:</span>
                <span class="c1"># Per-group preprocessing: use group-specific recipe</span>
                <span class="n">group_recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_recipes</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
                <span class="n">processed</span> <span class="o">=</span> <span class="n">group_recipe</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">group_data_no_group</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">pre</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Shared preprocessing: use the recipe from group_fit</span>
                <span class="n">preprocessor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">pre</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="s1">&#39;bake&#39;</span><span class="p">):</span>
                    <span class="c1"># It&#39;s a PreparedRecipe</span>
                    <span class="n">processed</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span><span class="n">group_data_no_group</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># It&#39;s a formula string - return original data (formula applied during fit/predict)</span>
                    <span class="n">processed</span> <span class="o">=</span> <span class="n">group_data_no_group</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No preprocessing</span>
                <span class="n">processed</span> <span class="o">=</span> <span class="n">group_data_no_group</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Add group column back</span>
            <span class="n">processed</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>

            <span class="c1"># Add metadata columns if they exist in original data</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;split&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">group_data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">processed</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">processed</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

            <span class="n">processed_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>

        <span class="c1"># Combine all groups</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">processed_groups</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Add split column if not already present</span>
        <span class="k">if</span> <span class="s1">&#39;split&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">split</span>

        <span class="c1"># Reorder columns: date, group_col, then others</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">priority_cols</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s1">&#39;date&#39;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">priority_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
            <span class="n">cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">priority_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">)</span>
            <span class="n">cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">)</span>

        <span class="n">final_cols</span> <span class="o">=</span> <span class="n">priority_cols</span> <span class="o">+</span> <span class="n">cols</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">final_cols</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the formula used for each group.</span>

<span class="sd">        Returns a dictionary mapping group values to their formulas.</span>
<span class="sd">        Useful for understanding what formula was used for each group,</span>
<span class="sd">        especially when auto-generated or with per-group preprocessing.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping group values to formula strings</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; nested_fit = wf.fit_nested(train_data, group_col=&#39;country&#39;)</span>
<span class="sd">            &gt;&gt;&gt; formulas = nested_fit.extract_formula()</span>
<span class="sd">            &gt;&gt;&gt; print(formulas)</span>
<span class="sd">            &gt;&gt;&gt; # {&#39;USA&#39;: &#39;sales ~ x1 + x2 + x3&#39;, &#39;UK&#39;: &#39;sales ~ x1 + x2 + x3&#39;}</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Check if all groups use same formula</span>
<span class="sd">            &gt;&gt;&gt; if len(set(formulas.values())) == 1:</span>
<span class="sd">            ...     print(f&quot;All groups use: {list(formulas.values())[0]}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">formulas</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">group_fit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">formulas</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">extract_formula</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">formulas</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_spec_parsnip</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelSpec</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the ModelSpec specification.</span>

<span class="sd">        This returns the shared model specification used across all groups.</span>
<span class="sd">        The spec is the same for all groups (e.g., linear_reg(), prophet_reg()).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ModelSpec object</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; nested_fit = wf.fit_nested(train_data, group_col=&#39;country&#39;)</span>
<span class="sd">            &gt;&gt;&gt; spec = nested_fit.extract_spec_parsnip()</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Model type: {spec.model_type}&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Engine: {spec.engine}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">spec</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_preprocessor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the preprocessor (formula or recipe) for groups.</span>

<span class="sd">        Args:</span>
<span class="sd">            group: If specified, returns preprocessor for that group only.</span>
<span class="sd">                  If None, returns dict mapping all groups to their preprocessors.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If group is specified: Preprocessor for that group (formula string or PreparedRecipe)</span>
<span class="sd">            If group is None: Dict mapping group values to their preprocessors</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If specified group not found</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Get preprocessor for specific group</span>
<span class="sd">            &gt;&gt;&gt; usa_preprocessor = nested_fit.extract_preprocessor(group=&#39;USA&#39;)</span>
<span class="sd">            &gt;&gt;&gt; if isinstance(usa_preprocessor, str):</span>
<span class="sd">            ...     print(f&quot;USA uses formula: {usa_preprocessor}&quot;)</span>
<span class="sd">            &gt;&gt;&gt; else:</span>
<span class="sd">            ...     print(f&quot;USA uses recipe with {len(usa_preprocessor.steps)} steps&quot;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Get all preprocessors</span>
<span class="sd">            &gt;&gt;&gt; all_preprocessors = nested_fit.extract_preprocessor()</span>
<span class="sd">            &gt;&gt;&gt; for group, prep in all_preprocessors.items():</span>
<span class="sd">            ...     print(f&quot;{group}: {type(prep).__name__}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Return specific group&#39;s preprocessor</span>
            <span class="k">if</span> <span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; not found. Available groups: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">extract_preprocessor</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Return dict of all preprocessors</span>
            <span class="n">preprocessors</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grp</span><span class="p">,</span> <span class="n">group_fit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">preprocessors</span><span class="p">[</span><span class="n">grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">extract_preprocessor</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">preprocessors</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_fit_parsnip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ModelFit</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the fitted ModelFit object(s) for groups.</span>

<span class="sd">        Args:</span>
<span class="sd">            group: If specified, returns ModelFit for that group only.</span>
<span class="sd">                  If None, returns dict mapping all groups to their ModelFits.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If group is specified: ModelFit for that group</span>
<span class="sd">            If group is None: Dict mapping group values to their ModelFits</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If specified group not found</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Get ModelFit for specific group</span>
<span class="sd">            &gt;&gt;&gt; usa_fit = nested_fit.extract_fit_parsnip(group=&#39;USA&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;USA model type: {usa_fit.spec.model_type}&quot;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Get all ModelFits</span>
<span class="sd">            &gt;&gt;&gt; all_fits = nested_fit.extract_fit_parsnip()</span>
<span class="sd">            &gt;&gt;&gt; for group, fit in all_fits.items():</span>
<span class="sd">            ...     outputs, _, stats = fit.extract_outputs()</span>
<span class="sd">            ...     print(f&quot;{group} RMSE: {stats[stats[&#39;split&#39;]==&#39;test&#39;][&#39;rmse&#39;].values[0]:.2f}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Return specific group&#39;s ModelFit</span>
            <span class="k">if</span> <span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&#39; not found. Available groups: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">extract_fit_parsnip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Return dict of all ModelFits</span>
            <span class="n">model_fits</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grp</span><span class="p">,</span> <span class="n">group_fit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">model_fits</span><span class="p">[</span><span class="n">grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_fit</span><span class="o">.</span><span class="n">extract_fit_parsnip</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">model_fits</span>


<div class="viewcode-block" id="workflow">
<a class="viewcode-back" href="../../api/workflows.html#py_workflows.workflow">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">workflow</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Workflow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new empty workflow.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Empty Workflow ready for composition</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; wf = (</span>
<span class="sd">        ...     workflow()</span>
<span class="sd">        ...     .add_formula(&quot;sales ~ price + advertising&quot;)</span>
<span class="sd">        ...     .add_model(linear_reg(penalty=0.1).set_engine(&quot;sklearn&quot;))</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; wf_fit = wf.fit(train_data)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Workflow</span><span class="p">()</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Matthew Deane.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>