

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>py_workflowsets.workflowset &mdash; py-tidymodels 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            py-tidymodels
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#installation-steps">Installation Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#clone-the-repository">1. Clone the Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#create-virtual-environment">2. Create Virtual Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#install-package">3. Install Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/installation.html#development-installation-editable">Development Installation (Editable)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/installation.html#standard-installation">Standard Installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#install-optional-dependencies">4. Install Optional Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#verify-installation">5. Verify Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#jupyter-notebook-setup">Jupyter Notebook Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#development-installation">Development Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/installation.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#prophet-installation-issues">Prophet Installation Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#windows-issues">Windows Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#import-errors">Import Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/installation.html#kernel-not-found-in-jupyter">Kernel Not Found in Jupyter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/quickstart.html">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#basic-regression">Basic Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#time-series-forecasting">Time Series Forecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#feature-engineering-with-recipes">Feature Engineering with Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#hyperparameter-tuning">Hyperparameter Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#multi-model-comparison">Multi-Model Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#model-stacking">Model Stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/concepts.html">Core Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#architecture-overview">Architecture Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#layer-1-py-hardhat">Layer 1: py-hardhat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#layer-2-py-parsnip">Layer 2: py-parsnip</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#layer-3-py-rsample">Layer 3: py-rsample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#layer-4-8-higher-level-tools">Layer 4-8: Higher-Level Tools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#key-design-principles">Key Design Principles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#immutability">Immutability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#composability">Composability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#method-chaining">Method Chaining</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#standardized-outputs">Standardized Outputs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#data-flow">Data Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#training-flow">Training Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#prediction-flow">Prediction Flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#working-with-formulas">Working with Formulas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#basic-formulas">Basic Formulas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#categorical-variables">Categorical Variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#working-with-recipes">Working with Recipes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#recipe-workflow">Recipe Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#why-prep-bake">Why prep/bake?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#time-series-considerations">Time Series Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#date-column-handling">Date Column Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#raw-vs-standard-path">Raw vs Standard Path</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#panel-grouped-modeling">Panel/Grouped Modeling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#nested-approach">Nested Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#global-approach">Global Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/concepts.html#when-to-use-each">When to Use Each</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/concepts.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/recipes.html">Recipe Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#what-are-recipes">What Are Recipes?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#the-prep-bake-pattern">The prep/bake Pattern</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#basic-workflow">Basic Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#why-separate-prep-and-bake">Why Separate prep and bake?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#recipe-steps-by-category">Recipe Steps by Category</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#imputation-steps">Imputation Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#normalization-steps">Normalization Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#encoding-steps">Encoding Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#feature-engineering-steps">Feature Engineering Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#filtering-steps">Filtering Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#time-series-steps">Time Series Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#complete-example">Complete Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#real-world-pipeline">Real-World Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#time-series-example">Time Series Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#selectors">Selectors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#built-in-selectors">Built-in Selectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#custom-selection">Custom Selection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#order-of-operations">Order of Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#avoid-data-leakage">Avoid Data Leakage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#reuse-prepped-recipes">Reuse Prepped Recipes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#common-patterns">Common Patterns</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#handling-missing-data">Handling Missing Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#dealing-with-skewness">Dealing with Skewness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#reducing-dimensionality">Reducing Dimensionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/recipes.html#rare-categories">Rare Categories</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/recipes.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/time_series.html">Time Series Modeling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#time-series-models">Time Series Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#native-time-series-models">Native Time Series Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#hybrid-models">Hybrid Models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#data-preparation">Data Preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#date-column-handling">Date Column Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#time-series-splits">Time Series Splits</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#feature-engineering-for-time-series">Feature Engineering for Time Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#lagged-features">Lagged Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#rolling-statistics">Rolling Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#time-features">Time Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#differencing">Differencing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#complete-examples">Complete Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#prophet-forecasting">Prophet Forecasting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#arima-with-auto-selection">ARIMA with Auto Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#recursive-ml-forecasting">Recursive ML Forecasting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#using-ml-models-for-time-series-regression">Using ML Models for Time Series Regression</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#random-forest-example">Random Forest Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#gradient-boosting-example-xgboost-lightgbm-catboost">Gradient Boosting Example (XGBoost/LightGBM/CatBoost)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#support-vector-machines-example">Support Vector Machines Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#k-nearest-neighbors-example">k-Nearest Neighbors Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#neural-network-mlp-example">Neural Network (MLP) Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#feature-engineering-for-ml-time-series-models">Feature Engineering for ML Time Series Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#understanding-the-three-dataframe-output">Understanding the Three-DataFrame Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../user_guide/time_series.html#comparing-multiple-ml-models">Comparing Multiple ML Models</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#panel-grouped-time-series">Panel/Grouped Time Series</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#hyperparameter-tuning-for-time-series">Hyperparameter Tuning for Time Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#cross-validation">Cross-Validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#check-stationarity">Check Stationarity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#handle-seasonality">Handle Seasonality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#validate-on-holdout">Validate on Holdout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#check-residuals">Check Residuals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#use-appropriate-metrics">Use Appropriate Metrics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#common-issues">Common Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#missing-dates">Missing Dates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#irregular-frequency">Irregular Frequency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/time_series.html#multiple-seasonality">Multiple Seasonality</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/time_series.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/tuning.html">Hyperparameter Tuning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#grid-types">Grid Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/tuning.html#regular-grid">Regular Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/tuning.html#random-grid">Random Grid</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#analyzing-results">Analyzing Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#time-series-tuning">Time Series Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/tuning.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/workflows.html">Workflow Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#basic-workflow">Basic Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#method-chaining">Method Chaining</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#with-recipes">With Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#panel-grouped-models">Panel/Grouped Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/workflows.html#nested-approach">Nested Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/workflows.html#global-approach">Global Approach</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#extracting-components">Extracting Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/workflows.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/visualization.html">Visualization Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#basic-usage-pattern">Basic Usage Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#forecast-visualization">Forecast Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/visualization.html#plot-forecast">plot_forecast()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/visualization.html#plot-forecast-multi">plot_forecast_multi()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#residual-diagnostics">Residual Diagnostics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/visualization.html#plot-residuals">plot_residuals()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#model-comparison">Model Comparison</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/visualization.html#plot-model-comparison">plot_model_comparison()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#hyperparameter-tuning-visualization">Hyperparameter Tuning Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../user_guide/visualization.html#plot-tune-results">plot_tune_results()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#saving-and-exporting-plots">Saving and Exporting Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#advanced-customization">Advanced Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#api-reference">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/visualization.html#examples">Examples</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html">Complete API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#linear-generalized-models">Linear &amp; Generalized Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#linear-reg">linear_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#poisson-reg">poisson_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#gen-additive-mod">gen_additive_mod()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#tree-based-models">Tree-Based Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#decision-tree">decision_tree()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#rand-forest">rand_forest()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#boost-tree">boost_tree()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#support-vector-machines">Support Vector Machines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#svm-rbf">svm_rbf()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#svm-linear">svm_linear()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#instance-based-models">Instance-Based Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#nearest-neighbor">nearest_neighbor()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#mars">mars()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#mlp">mlp()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#time-series-models">Time Series Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#arima-reg">arima_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#prophet-reg">prophet_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#exp-smoothing">exp_smoothing()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#seasonal-reg">seasonal_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#recursive-reg">recursive_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#varmax-reg">varmax_reg()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#hybrid-time-series-models">Hybrid Time Series Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#arima-boost">arima_boost()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#prophet-boost">prophet_boost()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#generic-hybrid-models">Generic Hybrid Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#hybrid-model">hybrid_model()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#baseline-models">Baseline Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#null-model">null_model()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#naive-reg">naive_reg()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#manual-coefficient-models">Manual Coefficient Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#manual-reg">manual_reg()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#cross-cutting-concepts">Cross-Cutting Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#engine-selection">Engine Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#mode-setting">Mode Setting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#tunable-parameters">Tunable Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#prediction-types">Prediction Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#output-structure">Output Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#formula-syntax">Formula Syntax</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#model-selection-guide">Model Selection Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#computational-complexity">Computational Complexity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#memory-usage">Memory Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#parallelization">Parallelization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../complete_api_reference.html#common-workflows">Common Workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#basic-regression">Basic Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#time-series-forecasting">Time Series Forecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#hyperparameter-tuning">Hyperparameter Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../complete_api_reference.html#multi-model-comparison">Multi-Model Comparison</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/hardhat.html">py-hardhat: Data Preprocessing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/hardhat.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint"><code class="docutils literal notranslate"><span class="pre">Blueprint</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.formula"><code class="docutils literal notranslate"><span class="pre">Blueprint.formula</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.roles"><code class="docutils literal notranslate"><span class="pre">Blueprint.roles</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.factor_levels"><code class="docutils literal notranslate"><span class="pre">Blueprint.factor_levels</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.column_order"><code class="docutils literal notranslate"><span class="pre">Blueprint.column_order</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.ptypes"><code class="docutils literal notranslate"><span class="pre">Blueprint.ptypes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.intercept"><code class="docutils literal notranslate"><span class="pre">Blueprint.intercept</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.indicators"><code class="docutils literal notranslate"><span class="pre">Blueprint.indicators</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.design_info"><code class="docutils literal notranslate"><span class="pre">Blueprint.design_info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.outcome_design_info"><code class="docutils literal notranslate"><span class="pre">Blueprint.outcome_design_info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id0"><code class="docutils literal notranslate"><span class="pre">Blueprint.formula</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id1"><code class="docutils literal notranslate"><span class="pre">Blueprint.roles</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id2"><code class="docutils literal notranslate"><span class="pre">Blueprint.factor_levels</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id3"><code class="docutils literal notranslate"><span class="pre">Blueprint.column_order</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id4"><code class="docutils literal notranslate"><span class="pre">Blueprint.ptypes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id5"><code class="docutils literal notranslate"><span class="pre">Blueprint.intercept</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id6"><code class="docutils literal notranslate"><span class="pre">Blueprint.indicators</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id7"><code class="docutils literal notranslate"><span class="pre">Blueprint.design_info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id8"><code class="docutils literal notranslate"><span class="pre">Blueprint.outcome_design_info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.__post_init__"><code class="docutils literal notranslate"><span class="pre">Blueprint.__post_init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.Blueprint.__init__"><code class="docutils literal notranslate"><span class="pre">Blueprint.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData"><code class="docutils literal notranslate"><span class="pre">MoldedData</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.outcomes"><code class="docutils literal notranslate"><span class="pre">MoldedData.outcomes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.predictors"><code class="docutils literal notranslate"><span class="pre">MoldedData.predictors</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.blueprint"><code class="docutils literal notranslate"><span class="pre">MoldedData.blueprint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.extras"><code class="docutils literal notranslate"><span class="pre">MoldedData.extras</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id9"><code class="docutils literal notranslate"><span class="pre">MoldedData.outcomes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id10"><code class="docutils literal notranslate"><span class="pre">MoldedData.predictors</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id11"><code class="docutils literal notranslate"><span class="pre">MoldedData.blueprint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#id12"><code class="docutils literal notranslate"><span class="pre">MoldedData.extras</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.__post_init__"><code class="docutils literal notranslate"><span class="pre">MoldedData.__post_init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.MoldedData.__init__"><code class="docutils literal notranslate"><span class="pre">MoldedData.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hardhat.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.mold"><code class="docutils literal notranslate"><span class="pre">mold()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#py_hardhat.forge"><code class="docutils literal notranslate"><span class="pre">forge()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hardhat.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#basic-mold-forge">Basic Mold/Forge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#formula-transformations">Formula Transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/hardhat.html#categorical-handling">Categorical Handling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/parsnip.html">py-parsnip: Model Specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec"><code class="docutils literal notranslate"><span class="pre">ModelSpec</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.model_type"><code class="docutils literal notranslate"><span class="pre">ModelSpec.model_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.engine"><code class="docutils literal notranslate"><span class="pre">ModelSpec.engine</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.mode"><code class="docutils literal notranslate"><span class="pre">ModelSpec.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.args"><code class="docutils literal notranslate"><span class="pre">ModelSpec.args</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.date_col"><code class="docutils literal notranslate"><span class="pre">ModelSpec.date_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id0"><code class="docutils literal notranslate"><span class="pre">ModelSpec.model_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id1"><code class="docutils literal notranslate"><span class="pre">ModelSpec.engine</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id2"><code class="docutils literal notranslate"><span class="pre">ModelSpec.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id3"><code class="docutils literal notranslate"><span class="pre">ModelSpec.args</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id4"><code class="docutils literal notranslate"><span class="pre">ModelSpec.date_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.set_engine"><code class="docutils literal notranslate"><span class="pre">ModelSpec.set_engine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.set_mode"><code class="docutils literal notranslate"><span class="pre">ModelSpec.set_mode()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.set_args"><code class="docutils literal notranslate"><span class="pre">ModelSpec.set_args()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.fit"><code class="docutils literal notranslate"><span class="pre">ModelSpec.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.fit_nested"><code class="docutils literal notranslate"><span class="pre">ModelSpec.fit_nested()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.fit_global"><code class="docutils literal notranslate"><span class="pre">ModelSpec.fit_global()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelSpec.__init__"><code class="docutils literal notranslate"><span class="pre">ModelSpec.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit"><code class="docutils literal notranslate"><span class="pre">ModelFit</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.spec"><code class="docutils literal notranslate"><span class="pre">ModelFit.spec</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.fit_data"><code class="docutils literal notranslate"><span class="pre">ModelFit.fit_data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.blueprint"><code class="docutils literal notranslate"><span class="pre">ModelFit.blueprint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.fit_time"><code class="docutils literal notranslate"><span class="pre">ModelFit.fit_time</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.evaluation_data"><code class="docutils literal notranslate"><span class="pre">ModelFit.evaluation_data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.model_name"><code class="docutils literal notranslate"><span class="pre">ModelFit.model_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.model_group_name"><code class="docutils literal notranslate"><span class="pre">ModelFit.model_group_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id5"><code class="docutils literal notranslate"><span class="pre">ModelFit.spec</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id6"><code class="docutils literal notranslate"><span class="pre">ModelFit.fit_data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id7"><code class="docutils literal notranslate"><span class="pre">ModelFit.blueprint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id8"><code class="docutils literal notranslate"><span class="pre">ModelFit.fit_time</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id9"><code class="docutils literal notranslate"><span class="pre">ModelFit.evaluation_data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id10"><code class="docutils literal notranslate"><span class="pre">ModelFit.model_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#id11"><code class="docutils literal notranslate"><span class="pre">ModelFit.model_group_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.predict"><code class="docutils literal notranslate"><span class="pre">ModelFit.predict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.extract_fit_engine"><code class="docutils literal notranslate"><span class="pre">ModelFit.extract_fit_engine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.evaluate"><code class="docutils literal notranslate"><span class="pre">ModelFit.evaluate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.extract_outputs"><code class="docutils literal notranslate"><span class="pre">ModelFit.extract_outputs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.ModelFit.__init__"><code class="docutils literal notranslate"><span class="pre">ModelFit.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#linear-models">Linear Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.linear_reg"><code class="docutils literal notranslate"><span class="pre">linear_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.poisson_reg"><code class="docutils literal notranslate"><span class="pre">poisson_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.gen_additive_mod"><code class="docutils literal notranslate"><span class="pre">gen_additive_mod()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#tree-based-models">Tree-Based Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.decision_tree"><code class="docutils literal notranslate"><span class="pre">decision_tree()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.rand_forest"><code class="docutils literal notranslate"><span class="pre">rand_forest()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.boost_tree"><code class="docutils literal notranslate"><span class="pre">boost_tree()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#support-vector-machines">Support Vector Machines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.svm_rbf"><code class="docutils literal notranslate"><span class="pre">svm_rbf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.svm_linear"><code class="docutils literal notranslate"><span class="pre">svm_linear()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#instance-based-models">Instance-Based Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.nearest_neighbor"><code class="docutils literal notranslate"><span class="pre">nearest_neighbor()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.mars"><code class="docutils literal notranslate"><span class="pre">mars()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.mlp"><code class="docutils literal notranslate"><span class="pre">mlp()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#time-series-models">Time Series Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.arima_reg"><code class="docutils literal notranslate"><span class="pre">arima_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.prophet_reg"><code class="docutils literal notranslate"><span class="pre">prophet_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.exp_smoothing"><code class="docutils literal notranslate"><span class="pre">exp_smoothing()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.seasonal_reg"><code class="docutils literal notranslate"><span class="pre">seasonal_reg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.recursive_reg"><code class="docutils literal notranslate"><span class="pre">recursive_reg()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#hybrid-time-series-models">Hybrid Time Series Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.arima_boost"><code class="docutils literal notranslate"><span class="pre">arima_boost()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.prophet_boost"><code class="docutils literal notranslate"><span class="pre">prophet_boost()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#baseline-models">Baseline Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.null_model"><code class="docutils literal notranslate"><span class="pre">null_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.naive_reg"><code class="docutils literal notranslate"><span class="pre">naive_reg()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#generic-hybrid-models">Generic Hybrid Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.hybrid_model"><code class="docutils literal notranslate"><span class="pre">hybrid_model()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#manual-coefficient-models">Manual Coefficient Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.manual_reg"><code class="docutils literal notranslate"><span class="pre">manual_reg()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#module-py_parsnip.engine_registry">Engine Registry</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine"><code class="docutils literal notranslate"><span class="pre">Engine</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine.param_map"><code class="docutils literal notranslate"><span class="pre">Engine.param_map</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine.fit"><code class="docutils literal notranslate"><span class="pre">Engine.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine.predict"><code class="docutils literal notranslate"><span class="pre">Engine.predict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine.extract_outputs"><code class="docutils literal notranslate"><span class="pre">Engine.extract_outputs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.Engine.translate_params"><code class="docutils literal notranslate"><span class="pre">Engine.translate_params()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.register_engine"><code class="docutils literal notranslate"><span class="pre">register_engine()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.get_engine"><code class="docutils literal notranslate"><span class="pre">get_engine()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#py_parsnip.engine_registry.list_engines"><code class="docutils literal notranslate"><span class="pre">list_engines()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/parsnip.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#time-series-model">Time Series Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/parsnip.html#gradient-boosting">Gradient Boosting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/rsample.html">py-rsample: Resampling &amp; Cross-Validation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/rsample.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split"><code class="docutils literal notranslate"><span class="pre">Split</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split.data"><code class="docutils literal notranslate"><span class="pre">Split.data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split.in_id"><code class="docutils literal notranslate"><span class="pre">Split.in_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split.out_id"><code class="docutils literal notranslate"><span class="pre">Split.out_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split.id"><code class="docutils literal notranslate"><span class="pre">Split.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id0"><code class="docutils literal notranslate"><span class="pre">Split.data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id1"><code class="docutils literal notranslate"><span class="pre">Split.in_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id2"><code class="docutils literal notranslate"><span class="pre">Split.out_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id3"><code class="docutils literal notranslate"><span class="pre">Split.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.Split.__init__"><code class="docutils literal notranslate"><span class="pre">Split.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit"><code class="docutils literal notranslate"><span class="pre">RSplit</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.split"><code class="docutils literal notranslate"><span class="pre">RSplit.split</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.training"><code class="docutils literal notranslate"><span class="pre">RSplit.training()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.testing"><code class="docutils literal notranslate"><span class="pre">RSplit.testing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.analysis"><code class="docutils literal notranslate"><span class="pre">RSplit.analysis()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.assessment"><code class="docutils literal notranslate"><span class="pre">RSplit.assessment()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.__init__"><code class="docutils literal notranslate"><span class="pre">RSplit.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id4"><code class="docutils literal notranslate"><span class="pre">RSplit.split</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id5"><code class="docutils literal notranslate"><span class="pre">RSplit.training()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id6"><code class="docutils literal notranslate"><span class="pre">RSplit.testing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id7"><code class="docutils literal notranslate"><span class="pre">RSplit.analysis()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#id8"><code class="docutils literal notranslate"><span class="pre">RSplit.assessment()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.__repr__"><code class="docutils literal notranslate"><span class="pre">RSplit.__repr__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.RSplit.__len__"><code class="docutils literal notranslate"><span class="pre">RSplit.__len__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/rsample.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#train-test-split">Train/Test Split</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.initial_split"><code class="docutils literal notranslate"><span class="pre">initial_split()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.initial_time_split"><code class="docutils literal notranslate"><span class="pre">initial_time_split()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.training"><code class="docutils literal notranslate"><span class="pre">training()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.testing"><code class="docutils literal notranslate"><span class="pre">testing()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#cross-validation">Cross-Validation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.vfold_cv"><code class="docutils literal notranslate"><span class="pre">vfold_cv()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rsample.html#py_rsample.time_series_cv"><code class="docutils literal notranslate"><span class="pre">time_series_cv()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/rsample.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#basic-split">Basic Split</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#time-series-split">Time Series Split</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#k-fold-cross-validation">K-Fold Cross-Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/rsample.html#time-series-cross-validation">Time Series Cross-Validation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/workflows.html">py-workflows: Pipeline Composition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/workflows.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow"><code class="docutils literal notranslate"><span class="pre">Workflow</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.preprocessor"><code class="docutils literal notranslate"><span class="pre">Workflow.preprocessor</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.spec"><code class="docutils literal notranslate"><span class="pre">Workflow.spec</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.post"><code class="docutils literal notranslate"><span class="pre">Workflow.post</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.case_weights"><code class="docutils literal notranslate"><span class="pre">Workflow.case_weights</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.model_name"><code class="docutils literal notranslate"><span class="pre">Workflow.model_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.model_group_name"><code class="docutils literal notranslate"><span class="pre">Workflow.model_group_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id0"><code class="docutils literal notranslate"><span class="pre">Workflow.preprocessor</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id1"><code class="docutils literal notranslate"><span class="pre">Workflow.spec</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id2"><code class="docutils literal notranslate"><span class="pre">Workflow.post</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id3"><code class="docutils literal notranslate"><span class="pre">Workflow.case_weights</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id4"><code class="docutils literal notranslate"><span class="pre">Workflow.model_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id5"><code class="docutils literal notranslate"><span class="pre">Workflow.model_group_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.add_formula"><code class="docutils literal notranslate"><span class="pre">Workflow.add_formula()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.add_model"><code class="docutils literal notranslate"><span class="pre">Workflow.add_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.add_recipe"><code class="docutils literal notranslate"><span class="pre">Workflow.add_recipe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.add_model_name"><code class="docutils literal notranslate"><span class="pre">Workflow.add_model_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.add_model_group_name"><code class="docutils literal notranslate"><span class="pre">Workflow.add_model_group_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.remove_formula"><code class="docutils literal notranslate"><span class="pre">Workflow.remove_formula()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.remove_model"><code class="docutils literal notranslate"><span class="pre">Workflow.remove_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.update_formula"><code class="docutils literal notranslate"><span class="pre">Workflow.update_formula()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.update_model"><code class="docutils literal notranslate"><span class="pre">Workflow.update_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.fit"><code class="docutils literal notranslate"><span class="pre">Workflow.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.fit_nested"><code class="docutils literal notranslate"><span class="pre">Workflow.fit_nested()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.fit_global"><code class="docutils literal notranslate"><span class="pre">Workflow.fit_global()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.Workflow.__init__"><code class="docutils literal notranslate"><span class="pre">Workflow.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit"><code class="docutils literal notranslate"><span class="pre">WorkflowFit</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.workflow"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.workflow</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.pre"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.pre</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.fit"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.fit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.post"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.post</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.formula"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.formula</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.recipe_prepped_without_outcome"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.recipe_prepped_without_outcome</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id6"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.workflow</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id7"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.pre</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id8"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.fit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id9"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.post</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id10"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.formula</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#id11"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.recipe_prepped_without_outcome</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.is_global_fit"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.is_global_fit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.group_col"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.group_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.predict"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.predict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.evaluate"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.evaluate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_fit_parsnip"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_fit_parsnip()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_preprocessor"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_preprocessor()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_spec_parsnip"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_spec_parsnip()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_outputs"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_outputs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_formula"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_formula()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.extract_preprocessed_data"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.extract_preprocessed_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflows.html#py_workflows.WorkflowFit.__init__"><code class="docutils literal notranslate"><span class="pre">WorkflowFit.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/workflows.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#py_workflows.workflow"><code class="docutils literal notranslate"><span class="pre">workflow()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/workflows.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#basic-workflow">Basic Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#method-chaining">Method Chaining</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#panel-grouped-models">Panel/Grouped Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflows.html#extracting-components">Extracting Components</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/recipes.html">py-recipes: Feature Engineering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe"><code class="docutils literal notranslate"><span class="pre">Recipe</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.steps"><code class="docutils literal notranslate"><span class="pre">Recipe.steps</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.template"><code class="docutils literal notranslate"><span class="pre">Recipe.template</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.roles"><code class="docutils literal notranslate"><span class="pre">Recipe.roles</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#id0"><code class="docutils literal notranslate"><span class="pre">Recipe.steps</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#id1"><code class="docutils literal notranslate"><span class="pre">Recipe.template</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#id2"><code class="docutils literal notranslate"><span class="pre">Recipe.roles</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.add_step"><code class="docutils literal notranslate"><span class="pre">Recipe.add_step()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_rm"><code class="docutils literal notranslate"><span class="pre">Recipe.step_rm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_normalize"><code class="docutils literal notranslate"><span class="pre">Recipe.step_normalize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_dummy"><code class="docutils literal notranslate"><span class="pre">Recipe.step_dummy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_impute_mean"><code class="docutils literal notranslate"><span class="pre">Recipe.step_impute_mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_impute_median"><code class="docutils literal notranslate"><span class="pre">Recipe.step_impute_median()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_mutate"><code class="docutils literal notranslate"><span class="pre">Recipe.step_mutate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_lag"><code class="docutils literal notranslate"><span class="pre">Recipe.step_lag()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_diff"><code class="docutils literal notranslate"><span class="pre">Recipe.step_diff()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_pct_change"><code class="docutils literal notranslate"><span class="pre">Recipe.step_pct_change()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_rolling"><code class="docutils literal notranslate"><span class="pre">Recipe.step_rolling()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_date"><code class="docutils literal notranslate"><span class="pre">Recipe.step_date()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_pca"><code class="docutils literal notranslate"><span class="pre">Recipe.step_pca()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_corr"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_corr()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_log"><code class="docutils literal notranslate"><span class="pre">Recipe.step_log()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_sqrt"><code class="docutils literal notranslate"><span class="pre">Recipe.step_sqrt()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_boxcox"><code class="docutils literal notranslate"><span class="pre">Recipe.step_boxcox()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_yeojohnson"><code class="docutils literal notranslate"><span class="pre">Recipe.step_yeojohnson()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_inverse"><code class="docutils literal notranslate"><span class="pre">Recipe.step_inverse()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_center"><code class="docutils literal notranslate"><span class="pre">Recipe.step_center()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_scale"><code class="docutils literal notranslate"><span class="pre">Recipe.step_scale()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_range"><code class="docutils literal notranslate"><span class="pre">Recipe.step_range()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_zv"><code class="docutils literal notranslate"><span class="pre">Recipe.step_zv()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_nzv"><code class="docutils literal notranslate"><span class="pre">Recipe.step_nzv()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_lincomb"><code class="docutils literal notranslate"><span class="pre">Recipe.step_lincomb()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_missing"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_missing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_anova"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_anova()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_rf_importance"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_rf_importance()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_mutual_info"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_mutual_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_roc_auc"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_roc_auc()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_filter_chisq"><code class="docutils literal notranslate"><span class="pre">Recipe.step_filter_chisq()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_shap"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_shap()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_permutation"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_permutation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_genetic_algorithm"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_genetic_algorithm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_splitwise"><code class="docutils literal notranslate"><span class="pre">Recipe.step_splitwise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_safe"><code class="docutils literal notranslate"><span class="pre">Recipe.step_safe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_safe_v2"><code class="docutils literal notranslate"><span class="pre">Recipe.step_safe_v2()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_eix"><code class="docutils literal notranslate"><span class="pre">Recipe.step_eix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_naomit"><code class="docutils literal notranslate"><span class="pre">Recipe.step_naomit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_other"><code class="docutils literal notranslate"><span class="pre">Recipe.step_other()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_novel"><code class="docutils literal notranslate"><span class="pre">Recipe.step_novel()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_unknown"><code class="docutils literal notranslate"><span class="pre">Recipe.step_unknown()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_indicate_na"><code class="docutils literal notranslate"><span class="pre">Recipe.step_indicate_na()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_integer"><code class="docutils literal notranslate"><span class="pre">Recipe.step_integer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_impute_mode"><code class="docutils literal notranslate"><span class="pre">Recipe.step_impute_mode()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_impute_knn"><code class="docutils literal notranslate"><span class="pre">Recipe.step_impute_knn()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_impute_linear"><code class="docutils literal notranslate"><span class="pre">Recipe.step_impute_linear()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_bs"><code class="docutils literal notranslate"><span class="pre">Recipe.step_bs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_ns"><code class="docutils literal notranslate"><span class="pre">Recipe.step_ns()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_poly"><code class="docutils literal notranslate"><span class="pre">Recipe.step_poly()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_harmonic"><code class="docutils literal notranslate"><span class="pre">Recipe.step_harmonic()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_interact"><code class="docutils literal notranslate"><span class="pre">Recipe.step_interact()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_ratio"><code class="docutils literal notranslate"><span class="pre">Recipe.step_ratio()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_discretize"><code class="docutils literal notranslate"><span class="pre">Recipe.step_discretize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_cut"><code class="docutils literal notranslate"><span class="pre">Recipe.step_cut()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_percentile"><code class="docutils literal notranslate"><span class="pre">Recipe.step_percentile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_ica"><code class="docutils literal notranslate"><span class="pre">Recipe.step_ica()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_kpca"><code class="docutils literal notranslate"><span class="pre">Recipe.step_kpca()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_pls"><code class="docutils literal notranslate"><span class="pre">Recipe.step_pls()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_holiday"><code class="docutils literal notranslate"><span class="pre">Recipe.step_holiday()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_fourier"><code class="docutils literal notranslate"><span class="pre">Recipe.step_fourier()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_timeseries_signature"><code class="docutils literal notranslate"><span class="pre">Recipe.step_timeseries_signature()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_lead"><code class="docutils literal notranslate"><span class="pre">Recipe.step_lead()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_ewm"><code class="docutils literal notranslate"><span class="pre">Recipe.step_ewm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_expanding"><code class="docutils literal notranslate"><span class="pre">Recipe.step_expanding()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.update_role"><code class="docutils literal notranslate"><span class="pre">Recipe.update_role()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.add_role"><code class="docutils literal notranslate"><span class="pre">Recipe.add_role()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.remove_role"><code class="docutils literal notranslate"><span class="pre">Recipe.remove_role()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.has_role"><code class="docutils literal notranslate"><span class="pre">Recipe.has_role()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_vip"><code class="docutils literal notranslate"><span class="pre">Recipe.step_vip()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_boruta"><code class="docutils literal notranslate"><span class="pre">Recipe.step_boruta()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_rfe"><code class="docutils literal notranslate"><span class="pre">Recipe.step_rfe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_dt_discretiser"><code class="docutils literal notranslate"><span class="pre">Recipe.step_dt_discretiser()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_winsorizer"><code class="docutils literal notranslate"><span class="pre">Recipe.step_winsorizer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_outlier_trimmer"><code class="docutils literal notranslate"><span class="pre">Recipe.step_outlier_trimmer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_dt_features"><code class="docutils literal notranslate"><span class="pre">Recipe.step_dt_features()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_smart_corr"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_smart_corr()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_psi"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_psi()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_clean_anomalies"><code class="docutils literal notranslate"><span class="pre">Recipe.step_clean_anomalies()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_stationary"><code class="docutils literal notranslate"><span class="pre">Recipe.step_stationary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_deseasonalize"><code class="docutils literal notranslate"><span class="pre">Recipe.step_deseasonalize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_detrend"><code class="docutils literal notranslate"><span class="pre">Recipe.step_detrend()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_h_stat"><code class="docutils literal notranslate"><span class="pre">Recipe.step_h_stat()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_best_lag"><code class="docutils literal notranslate"><span class="pre">Recipe.step_best_lag()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_vif"><code class="docutils literal notranslate"><span class="pre">Recipe.step_vif()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_pvalue"><code class="docutils literal notranslate"><span class="pre">Recipe.step_pvalue()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_stability"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_stability()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_lofo"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_lofo()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_granger"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_granger()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_stepwise"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_stepwise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_probe"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_probe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_lasso"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_lasso()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_ridge"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_ridge()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_elastic_net"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_elastic_net()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_univariate"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_univariate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_variance_threshold"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_variance_threshold()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_stationary"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_stationary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_cointegration"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_cointegration()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_select_seasonal"><code class="docutils literal notranslate"><span class="pre">Recipe.step_select_seasonal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_fractional_diff"><code class="docutils literal notranslate"><span class="pre">Recipe.step_fractional_diff()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_volatility_ewm"><code class="docutils literal notranslate"><span class="pre">Recipe.step_volatility_ewm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_permutation_entropy"><code class="docutils literal notranslate"><span class="pre">Recipe.step_permutation_entropy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.step_weight_time_decay"><code class="docutils literal notranslate"><span class="pre">Recipe.step_weight_time_decay()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.prep"><code class="docutils literal notranslate"><span class="pre">Recipe.prep()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/recipes.html#py_recipes.Recipe.__init__"><code class="docutils literal notranslate"><span class="pre">Recipe.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.recipe"><code class="docutils literal notranslate"><span class="pre">recipe()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#module-py_recipes.selectors">Selectors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_numeric"><code class="docutils literal notranslate"><span class="pre">all_numeric()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_nominal"><code class="docutils literal notranslate"><span class="pre">all_nominal()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_integer"><code class="docutils literal notranslate"><span class="pre">all_integer()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_float"><code class="docutils literal notranslate"><span class="pre">all_float()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_string"><code class="docutils literal notranslate"><span class="pre">all_string()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_datetime"><code class="docutils literal notranslate"><span class="pre">all_datetime()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.starts_with"><code class="docutils literal notranslate"><span class="pre">starts_with()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.ends_with"><code class="docutils literal notranslate"><span class="pre">ends_with()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.contains"><code class="docutils literal notranslate"><span class="pre">contains()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.matches"><code class="docutils literal notranslate"><span class="pre">matches()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.everything"><code class="docutils literal notranslate"><span class="pre">everything()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.one_of"><code class="docutils literal notranslate"><span class="pre">one_of()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.none_of"><code class="docutils literal notranslate"><span class="pre">none_of()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.where"><code class="docutils literal notranslate"><span class="pre">where()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.union"><code class="docutils literal notranslate"><span class="pre">union()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.intersection"><code class="docutils literal notranslate"><span class="pre">intersection()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.difference"><code class="docutils literal notranslate"><span class="pre">difference()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_predictors"><code class="docutils literal notranslate"><span class="pre">all_predictors()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_outcomes"><code class="docutils literal notranslate"><span class="pre">all_outcomes()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_numeric_predictors"><code class="docutils literal notranslate"><span class="pre">all_numeric_predictors()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.all_nominal_predictors"><code class="docutils literal notranslate"><span class="pre">all_nominal_predictors()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.has_role"><code class="docutils literal notranslate"><span class="pre">has_role()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#py_recipes.selectors.resolve_selector"><code class="docutils literal notranslate"><span class="pre">resolve_selector()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#imputation-steps-6">Imputation Steps (6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#normalization-steps-4">Normalization Steps (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#encoding-steps-6">Encoding Steps (6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#feature-engineering-steps-8">Feature Engineering Steps (8)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#filtering-steps-6">Filtering Steps (6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#row-operations-6">Row Operations (6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#transformation-steps-6">Transformation Steps (6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#time-series-steps-4">Time Series Steps (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/recipes.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#basic-recipe">Basic Recipe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#advanced-recipe">Advanced Recipe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/recipes.html#time-series-recipe">Time Series Recipe</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/yardstick.html">py-yardstick: Model Metrics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/yardstick.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#metric-set">Metric Set</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.metric_set"><code class="docutils literal notranslate"><span class="pre">metric_set()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#regression-metrics-7">Regression Metrics (7)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.rmse"><code class="docutils literal notranslate"><span class="pre">rmse()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.mae"><code class="docutils literal notranslate"><span class="pre">mae()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.mape"><code class="docutils literal notranslate"><span class="pre">mape()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.smape"><code class="docutils literal notranslate"><span class="pre">smape()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.r_squared"><code class="docutils literal notranslate"><span class="pre">r_squared()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#classification-metrics-10">Classification Metrics (10)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.accuracy"><code class="docutils literal notranslate"><span class="pre">accuracy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.precision"><code class="docutils literal notranslate"><span class="pre">precision()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.recall"><code class="docutils literal notranslate"><span class="pre">recall()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/yardstick.html#py_yardstick.roc_auc"><code class="docutils literal notranslate"><span class="pre">roc_auc()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/yardstick.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#individual-metrics">Individual Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#id1">Metric Set</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#with-dataframes">With DataFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/yardstick.html#classification-metrics">Classification Metrics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tune.html">py-tune: Hyperparameter Tuning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/tune.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults"><code class="docutils literal notranslate"><span class="pre">TuneResults</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.metrics"><code class="docutils literal notranslate"><span class="pre">TuneResults.metrics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.predictions"><code class="docutils literal notranslate"><span class="pre">TuneResults.predictions</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.workflow"><code class="docutils literal notranslate"><span class="pre">TuneResults.workflow</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.resamples"><code class="docutils literal notranslate"><span class="pre">TuneResults.resamples</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.grid"><code class="docutils literal notranslate"><span class="pre">TuneResults.grid</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.collect_metrics"><code class="docutils literal notranslate"><span class="pre">TuneResults.collect_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.collect_predictions"><code class="docutils literal notranslate"><span class="pre">TuneResults.collect_predictions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.show_best"><code class="docutils literal notranslate"><span class="pre">TuneResults.show_best()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.select_best"><code class="docutils literal notranslate"><span class="pre">TuneResults.select_best()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.select_by_one_std_err"><code class="docutils literal notranslate"><span class="pre">TuneResults.select_by_one_std_err()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.TuneResults.__init__"><code class="docutils literal notranslate"><span class="pre">TuneResults.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/tune.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#tuning">Tuning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.tune"><code class="docutils literal notranslate"><span class="pre">tune()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.tune_grid"><code class="docutils literal notranslate"><span class="pre">tune_grid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.fit_resamples"><code class="docutils literal notranslate"><span class="pre">fit_resamples()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#grid-generation">Grid Generation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.grid_regular"><code class="docutils literal notranslate"><span class="pre">grid_regular()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.grid_random"><code class="docutils literal notranslate"><span class="pre">grid_random()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#finalization">Finalization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/tune.html#py_tune.finalize_workflow"><code class="docutils literal notranslate"><span class="pre">finalize_workflow()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/tune.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#basic-tuning">Basic Tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#analyze-results">Analyze Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#finalize-workflow">Finalize Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#random-grid">Random Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/tune.html#fit-resamples-without-tuning">Fit Resamples Without Tuning</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/workflowsets.html">py-workflowsets: Multi-Model Comparison</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/workflowsets.html#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet"><code class="docutils literal notranslate"><span class="pre">WorkflowSet</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.workflows"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.workflows</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.info"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#id0"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.workflows</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#id1"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.info</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.from_workflows"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.from_workflows()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.from_cross"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.from_cross()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__len__"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.__len__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__iter__"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.__iter__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__getitem__"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.__getitem__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.workflow_ids"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.workflow_ids</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.workflow_map"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.workflow_map()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_resamples"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.fit_resamples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.tune_grid"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.tune_grid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_nested"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.fit_nested()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_global"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.fit_global()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_nested_resamples"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.fit_nested_resamples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_global_resamples"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.fit_global_resamples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__init__"><code class="docutils literal notranslate"><span class="pre">WorkflowSet.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.results"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.results</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.workflow_set"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.workflow_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.metrics"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.metrics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#id2"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.results</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#id3"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.workflow_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#id4"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.metrics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.collect_metrics"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.collect_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.collect_predictions"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.collect_predictions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.rank_results"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.rank_results()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.autoplot"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.autoplot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.__init__"><code class="docutils literal notranslate"><span class="pre">WorkflowSetResults.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/workflowsets.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#basic-workflow-set">Basic Workflow Set</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#evaluate-workflows">Evaluate Workflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#select-best-workflow">Select Best Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#from-explicit-workflows">From Explicit Workflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/workflowsets.html#access-individual-workflows">Access Individual Workflows</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/visualize.html">py-visualize: Interactive Visualizations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/visualize.html#main-functions">Main Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#forecast-visualization">Forecast Visualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/visualize.html#py_visualize.plot_forecast"><code class="docutils literal notranslate"><span class="pre">plot_forecast()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#residual-diagnostics">Residual Diagnostics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/visualize.html#py_visualize.plot_residuals"><code class="docutils literal notranslate"><span class="pre">plot_residuals()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#model-comparison">Model Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/visualize.html#py_visualize.plot_model_comparison"><code class="docutils literal notranslate"><span class="pre">plot_model_comparison()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#decomposition-plots">Decomposition Plots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/visualize.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#forecast-plot">Forecast Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#id1">Residual Diagnostics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#id2">Model Comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#decomposition-plot">Decomposition Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualize.html#customization">Customization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/stacks.html">py-stacks: Model Ensembling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/stacks.html#core-classes">Core Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/stacks.html#main-functions">Main Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/stacks.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/stacks.html#basic-stacking">Basic Stacking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/stacks.html#model-weights">Model Weights</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/stacks.html#non-negative-weights">Non-Negative Weights</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/stacks.html#cross-validation-stacking">Cross-Validation Stacking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/stacks.html#evaluate-stack">Evaluate Stack</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../models/linear_models.html">Linear Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/linear_models.html#linear-reg">linear_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/linear_models.html#poisson-reg">poisson_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/linear_models.html#gen-additive-mod">gen_additive_mod()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/linear_models.html#when-to-use">When to Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/linear_models.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../models/tree_models.html">Tree-Based Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/tree_models.html#decision-tree">decision_tree()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/tree_models.html#rand-forest">rand_forest()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/tree_models.html#boost-tree">boost_tree()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/tree_models.html#when-to-use">When to Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/tree_models.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../models/time_series.html">Time Series Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#arima-reg">arima_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#prophet-reg">prophet_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#exp-smoothing">exp_smoothing()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#seasonal-reg">seasonal_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#recursive-reg">recursive_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#hybrid-models">Hybrid Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../models/time_series.html#arima-boost">arima_boost()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../models/time_series.html#prophet-boost">prophet_boost()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#when-to-use">When to Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/time_series.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../models/ensemble_models.html">Ensemble Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/ensemble_models.html#boost-tree">boost_tree()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/ensemble_models.html#hybrid-time-series">Hybrid Time Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../models/ensemble_models.html#arima-boost">arima_boost()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../models/ensemble_models.html#prophet-boost">prophet_boost()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../models/ensemble_models.html#model-stacking">Model Stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/ensemble_models.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../models/baseline_models.html">Baseline Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline_models.html#null-model">null_model()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline_models.html#naive-reg">naive_reg()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline_models.html#when-to-use">When to Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/baseline_models.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples/basic_regression.html">Basic Regression Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/basic_regression.html#simple-linear-regression">Simple Linear Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/basic_regression.html#with-feature-engineering">With Feature Engineering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/basic_regression.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/time_series_forecasting.html">Time Series Forecasting Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/time_series_forecasting.html#prophet-forecasting">Prophet Forecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/time_series_forecasting.html#arima-forecasting">ARIMA Forecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/time_series_forecasting.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/hyperparameter_tuning.html">Hyperparameter Tuning Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/hyperparameter_tuning.html#grid-search">Grid Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/hyperparameter_tuning.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/panel_models.html">Panel/Grouped Model Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/panel_models.html#nested-approach">Nested Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/panel_models.html#global-approach">Global Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/panel_models.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/model_stacking.html">Model Stacking Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/model_stacking.html#basic-stacking">Basic Stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/model_stacking.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/contributing.html">Contributing Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html#development-setup">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html#running-tests">Running Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html#code-style">Code Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/contributing.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/architecture.html">Architecture Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/architecture.html#layers">Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/architecture.html#key-patterns">Key Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/architecture.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/testing.html">Testing Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/testing.html#test-structure">Test Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/testing.html#running-tests">Running Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/testing.html#test-coverage">Test Coverage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/testing.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/changelog.html#version-0-1-0-current">Version 0.1.0 (Current)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/changelog.html#see-also">See Also</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">py-tidymodels</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">py_workflowsets.workflowset</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for py_workflowsets.workflowset</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">WorkflowSets for multi-model comparison.</span>

<span class="sd">Provides tools for comparing multiple workflows across different</span>
<span class="sd">preprocessing strategies and model specifications.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">joblib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.parallel_utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">validate_n_jobs</span><span class="p">,</span>
    <span class="n">get_joblib_backend</span><span class="p">,</span>
    <span class="n">check_windows_compatibility</span><span class="p">,</span>
    <span class="n">format_parallel_info</span>
<span class="p">)</span>


<div class="viewcode-block" id="WorkflowSet">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WorkflowSet</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collection of workflows for multi-model comparison.</span>

<span class="sd">    A WorkflowSet allows you to compare multiple workflows, either by</span>
<span class="sd">    providing them directly or by creating all combinations of preprocessors</span>
<span class="sd">    and models (cross-product).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        workflows: Dictionary mapping workflow IDs to Workflow objects</span>
<span class="sd">        info: Metadata about each workflow (preprocessor type, model type, etc.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">workflows</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">info</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>

<div class="viewcode-block" id="WorkflowSet.from_workflows">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.from_workflows">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_workflows</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">workflows</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create WorkflowSet from a list of workflows.</span>

<span class="sd">        Args:</span>
<span class="sd">            workflows: List of Workflow objects OR list of (id, workflow) tuples</span>
<span class="sd">            ids: Optional list of IDs for workflows (auto-generated if None)</span>
<span class="sd">                 Ignored if workflows is a list of tuples</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowSet instance</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; wf1 = workflow().add_formula(&quot;y ~ x1&quot;).add_model(linear_reg())</span>
<span class="sd">            &gt;&gt;&gt; wf2 = workflow().add_formula(&quot;y ~ x1 + x2&quot;).add_model(rand_forest())</span>
<span class="sd">            &gt;&gt;&gt; # Method 1: Separate workflows and IDs</span>
<span class="sd">            &gt;&gt;&gt; wf_set = WorkflowSet.from_workflows([wf1, wf2], ids=[&quot;linear&quot;, &quot;rf&quot;])</span>
<span class="sd">            &gt;&gt;&gt; # Method 2: List of tuples</span>
<span class="sd">            &gt;&gt;&gt; wf_set = WorkflowSet.from_workflows([(&quot;linear&quot;, wf1), (&quot;rf&quot;, wf2)])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if workflows is a list of tuples (id, workflow)</span>
        <span class="k">if</span> <span class="n">workflows</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">workflows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">workflows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Extract IDs and workflows from tuples</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">wf_id</span> <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">workflows</span><span class="p">]</span>
            <span class="n">workflows</span> <span class="o">=</span> <span class="p">[</span><span class="n">wf</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">wf</span> <span class="ow">in</span> <span class="n">workflows</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;workflow_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">workflows</span><span class="p">))]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">workflows</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Length of ids must match length of workflows&quot;</span><span class="p">)</span>

        <span class="n">workflow_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">workflows</span><span class="p">))</span>

        <span class="c1"># Create info DataFrame</span>
        <span class="n">info_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span> <span class="ow">in</span> <span class="n">workflow_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">preprocessor_type</span> <span class="o">=</span> <span class="s2">&quot;formula&quot;</span> <span class="k">if</span> <span class="n">wf</span><span class="o">.</span><span class="n">preprocessor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;none&quot;</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">model_type</span> <span class="k">if</span> <span class="n">wf</span><span class="o">.</span><span class="n">spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;none&quot;</span>

            <span class="n">info_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;wflow_id&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">preprocessor_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                <span class="s2">&quot;preprocessor&quot;</span><span class="p">:</span> <span class="n">preprocessor_type</span><span class="p">,</span>
                <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model_type</span>
            <span class="p">})</span>

        <span class="n">info_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">info_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">workflows</span><span class="o">=</span><span class="n">workflow_dict</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info_df</span><span class="p">)</span></div>


<div class="viewcode-block" id="WorkflowSet.from_cross">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.from_cross">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_cross</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                   <span class="n">preproc</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]],</span>
                   <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
                   <span class="n">ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create WorkflowSet from cross-product of preprocessors and models.</span>

<span class="sd">        Creates all combinations of preprocessors (formulas or recipes) and models.</span>

<span class="sd">        Args:</span>
<span class="sd">            preproc: Preprocessors in one of three formats:</span>
<span class="sd">                - List: [recipe1, recipe2] or [&quot;y ~ x1&quot;, &quot;y ~ x2&quot;] (generic IDs: prep_1, prep_2, ...)</span>
<span class="sd">                - Dict: {&#39;rec_lags&#39;: recipe1, &#39;rec_pca&#39;: recipe2} (uses keys as IDs)</span>
<span class="sd">                - List of tuples: [(&#39;rec_lags&#39;, recipe1), (&#39;rec_pca&#39;, recipe2)] (uses names as IDs)</span>
<span class="sd">            models: List of ModelSpec objects</span>
<span class="sd">            ids: Optional list of ID prefixes for each preprocessor (only used with list format)</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowSet instance</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # List format with generic IDs</span>
<span class="sd">            &gt;&gt;&gt; formulas = [&quot;y ~ x1&quot;, &quot;y ~ x1 + x2&quot;]</span>
<span class="sd">            &gt;&gt;&gt; models = [linear_reg(), rand_forest()]</span>
<span class="sd">            &gt;&gt;&gt; wf_set = WorkflowSet.from_cross(formulas, models)</span>
<span class="sd">            # Creates: prep_1_linear_reg_1, prep_1_rand_forest_2, prep_2_linear_reg_1, prep_2_rand_forest_2</span>

<span class="sd">            &gt;&gt;&gt; # Dict format with custom names</span>
<span class="sd">            &gt;&gt;&gt; rec_lags = recipe().step_lag([&#39;x1&#39;], lag=7)</span>
<span class="sd">            &gt;&gt;&gt; rec_pca = recipe().step_pca(num_comp=3)</span>
<span class="sd">            &gt;&gt;&gt; wf_set = WorkflowSet.from_cross({&#39;rec_lags&#39;: rec_lags, &#39;rec_pca&#39;: rec_pca}, models)</span>
<span class="sd">            # Creates: rec_lags_linear_reg_1, rec_lags_rand_forest_2, rec_pca_linear_reg_1, rec_pca_rand_forest_2</span>

<span class="sd">            &gt;&gt;&gt; # Tuple format with custom names</span>
<span class="sd">            &gt;&gt;&gt; wf_set = WorkflowSet.from_cross([(&#39;rec_lags&#39;, rec_lags), (&#39;rec_pca&#39;, rec_pca)], models)</span>
<span class="sd">            # Same result as dict format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">py_workflows</span><span class="w"> </span><span class="kn">import</span> <span class="n">workflow</span>

        <span class="n">workflows_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">info_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Normalize preproc to list of (name, preprocessor) tuples</span>
        <span class="n">prep_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">preproc</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Dict format: {&#39;rec_lags&#39;: recipe1, &#39;rec_pca&#39;: recipe2}</span>
            <span class="n">prep_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">preproc</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">preproc</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">preproc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">preproc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c1"># Tuple format: [(&#39;rec_lags&#39;, recipe1), (&#39;rec_pca&#39;, recipe2)]</span>
            <span class="n">prep_items</span> <span class="o">=</span> <span class="n">preproc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># List format (backward compatible): [recipe1, recipe2] or [&quot;y ~ x1&quot;, &quot;y ~ x2&quot;]</span>
            <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;prep_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preproc</span><span class="p">))]</span>
            <span class="n">prep_items</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;prep_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">preproc</span><span class="p">)]</span>

        <span class="c1"># Create workflows from cross-product</span>
        <span class="k">for</span> <span class="n">prep_id</span><span class="p">,</span> <span class="n">prep</span> <span class="ow">in</span> <span class="n">prep_items</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
                <span class="n">model_type</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_type</span>
                <span class="c1"># Make ID unique by including model index</span>
                <span class="n">wf_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prep_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="c1"># Create workflow</span>
                <span class="n">wf</span> <span class="o">=</span> <span class="n">workflow</span><span class="p">()</span>

                <span class="c1"># Add preprocessor</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prep</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">add_formula</span><span class="p">(</span><span class="n">prep</span><span class="p">)</span>
                    <span class="n">prep_type</span> <span class="o">=</span> <span class="s2">&quot;formula&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Assume it&#39;s a recipe</span>
                    <span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">add_recipe</span><span class="p">(</span><span class="n">prep</span><span class="p">)</span>
                    <span class="n">prep_type</span> <span class="o">=</span> <span class="s2">&quot;recipe&quot;</span>

                <span class="c1"># Add model</span>
                <span class="n">wf</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

                <span class="n">workflows_dict</span><span class="p">[</span><span class="n">wf_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf</span>

                <span class="n">info_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;wflow_id&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                    <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prep_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="n">prep_id</span><span class="p">,</span>
                    <span class="s2">&quot;preprocessor&quot;</span><span class="p">:</span> <span class="n">prep_type</span><span class="p">,</span>
                    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model_type</span>
                <span class="p">})</span>

        <span class="n">info_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">info_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">workflows</span><span class="o">=</span><span class="n">workflows_dict</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info_df</span><span class="p">)</span></div>


<div class="viewcode-block" id="WorkflowSet.__len__">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__len__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of workflows in the set&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">)</span></div>


<div class="viewcode-block" id="WorkflowSet.__iter__">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__iter__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over workflow IDs&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="WorkflowSet.__getitem__">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.__getitem__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get workflow by ID&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">workflow_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of workflow IDs&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<div class="viewcode-block" id="WorkflowSet.workflow_map">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.workflow_map">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">workflow_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">resamples</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">metrics</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">grid</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowSetResults&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a function to all workflows.</span>

<span class="sd">        Args:</span>
<span class="sd">            fn: Function name to apply (&quot;fit_resamples&quot; or &quot;tune_grid&quot;)</span>
<span class="sd">            resamples: Resampling object (from py_rsample)</span>
<span class="sd">            metrics: Metric set (from py_yardstick)</span>
<span class="sd">            grid: Parameter grid (for tune_grid)</span>
<span class="sd">            **kwargs: Additional arguments passed to the function</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowSetResults object</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.workflow_map(</span>
<span class="sd">            ...     &quot;fit_resamples&quot;,</span>
<span class="sd">            ...     resamples=folds,</span>
<span class="sd">            ...     metrics=metric_set(rmse, mae)</span>
<span class="sd">            ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fn</span> <span class="o">==</span> <span class="s2">&quot;fit_resamples&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_resamples</span><span class="p">(</span><span class="n">resamples</span><span class="o">=</span><span class="n">resamples</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fn</span> <span class="o">==</span> <span class="s2">&quot;tune_grid&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tune_grid</span><span class="p">(</span><span class="n">resamples</span><span class="o">=</span><span class="n">resamples</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown function: </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_fit_single_workflow_resamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wf_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">wf</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">resamples</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
                                        <span class="n">metrics</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">control</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit single workflow across all resamples.</span>

<span class="sd">        Helper function for parallel execution in fit_resamples.</span>

<span class="sd">        Args:</span>
<span class="sd">            wf_id: Workflow ID</span>
<span class="sd">            wf: Workflow object</span>
<span class="sd">            resamples: Resampling object</span>
<span class="sd">            metrics: Metric set</span>
<span class="sd">            control: Control parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (result_dict, error_msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">py_tune</span><span class="w"> </span><span class="kn">import</span> <span class="n">fit_resamples</span> <span class="k">as</span> <span class="n">fit_resamples_fn</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Fit resamples for this workflow (n_jobs=1 to avoid nested parallelism)</span>
            <span class="n">tune_results</span> <span class="o">=</span> <span class="n">fit_resamples_fn</span><span class="p">(</span>
                <span class="n">wf</span><span class="p">,</span>
                <span class="n">resamples</span><span class="p">,</span>
                <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span>
                <span class="n">control</span><span class="o">=</span><span class="n">control</span><span class="p">,</span>
                <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>

            <span class="c1"># Collect metrics</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">tune_results</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">()</span>
            <span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_id</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;wflow_id&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                <span class="s2">&quot;tune_results&quot;</span><span class="p">:</span> <span class="n">tune_results</span><span class="p">,</span>
                <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="n">metrics_df</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2">&#39; failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>

<div class="viewcode-block" id="WorkflowSet.fit_resamples">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_resamples">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_resamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">resamples</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
                      <span class="n">metrics</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">control</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">n_jobs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowSetResults&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit all workflows to all resamples and evaluate.</span>

<span class="sd">        Args:</span>
<span class="sd">            resamples: Resampling object (VFoldCV, TimeSeriesCV, etc.)</span>
<span class="sd">            metrics: Metric set for evaluation</span>
<span class="sd">            control: Control parameters (e.g., {&#39;save_pred&#39;: True})</span>
<span class="sd">            n_jobs: Number of parallel jobs. None or 1 for sequential execution,</span>
<span class="sd">                    -1 for all CPU cores, or positive integer for specific number of cores.</span>
<span class="sd">            verbose: If True, display progress messages</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowSetResults containing metrics and predictions</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; folds = vfold_cv(data, v=5)</span>
<span class="sd">            &gt;&gt;&gt; metrics = metric_set(rmse, mae, r_squared)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Sequential execution</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.fit_resamples(folds, metrics)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Parallel execution</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.fit_resamples(folds, metrics, n_jobs=-1, verbose=True)</span>
<span class="sd">            &gt;&gt;&gt; results.rank_results(&quot;rmse&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">control</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># Prepare work items</span>
        <span class="n">work_items</span> <span class="o">=</span> <span class="p">[(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">resamples</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">control</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

        <span class="c1"># Validate and resolve n_jobs with warnings</span>
        <span class="n">effective_n_jobs</span> <span class="o">=</span> <span class="n">validate_n_jobs</span><span class="p">(</span><span class="n">n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Windows compatibility check</span>
        <span class="k">if</span> <span class="n">effective_n_jobs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">check_windows_compatibility</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Sequential or parallel execution</span>
        <span class="k">if</span> <span class="n">effective_n_jobs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Sequential execution</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">format_parallel_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="s2">&quot;workflows&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">resamples</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">control</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">work_items</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">)</span><span class="si">}</span><span class="s2">] Fitting </span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_workflow_resamples</span><span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">resamples</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">control</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Parallel execution</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">format_parallel_info</span><span class="p">(</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="s2">&quot;workflows&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

            <span class="n">joblib_verbose</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">get_joblib_backend</span><span class="p">()</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">joblib_verbose</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)(</span>
                <span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_workflow_resamples</span><span class="p">)(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">resamples</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">control</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">resamples</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">work_items</span>
            <span class="p">)</span>

        <span class="c1"># Process results</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result_dict</span><span class="p">,</span> <span class="n">error_msg</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_dict</span><span class="p">)</span>

        <span class="c1"># Print errors</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Workflow evaluation complete: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> successful&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">WorkflowSetResults</span><span class="p">(</span>
            <span class="n">results</span><span class="o">=</span><span class="n">all_results</span><span class="p">,</span>
            <span class="n">workflow_set</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="WorkflowSet.tune_grid">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.tune_grid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tune_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">resamples</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
                  <span class="n">grid</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
                  <span class="n">metrics</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">control</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowSetResults&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tune all workflows over parameter grids.</span>

<span class="sd">        Args:</span>
<span class="sd">            resamples: Resampling object</span>
<span class="sd">            grid: Parameter grid or dict of grids (one per workflow)</span>
<span class="sd">            metrics: Metric set for evaluation</span>
<span class="sd">            control: Control parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowSetResults containing tuning results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">py_tune</span><span class="w"> </span><span class="kn">import</span> <span class="n">tune_grid</span> <span class="k">as</span> <span class="n">tune_grid_fn</span>

        <span class="n">control</span> <span class="o">=</span> <span class="n">control</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle single grid vs per-workflow grids</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">grids</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use same grid for all workflows</span>
            <span class="n">grids</span> <span class="o">=</span> <span class="p">{</span><span class="n">wf_id</span><span class="p">:</span> <span class="n">grid</span> <span class="k">for</span> <span class="n">wf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tuning </span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

            <span class="c1"># Get grid for this workflow</span>
            <span class="n">wf_grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>

            <span class="c1"># Tune grid for this workflow</span>
            <span class="n">tune_results</span> <span class="o">=</span> <span class="n">tune_grid_fn</span><span class="p">(</span>
                <span class="n">wf</span><span class="p">,</span>
                <span class="n">resamples</span><span class="p">,</span>
                <span class="n">grid</span><span class="o">=</span><span class="n">wf_grid</span><span class="p">,</span>
                <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span>
                <span class="n">control</span><span class="o">=</span><span class="n">control</span>
            <span class="p">)</span>

            <span class="c1"># Collect metrics</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">tune_results</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">()</span>
            <span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_id</span>

            <span class="n">all_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;wflow_id&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                <span class="s2">&quot;tune_results&quot;</span><span class="p">:</span> <span class="n">tune_results</span><span class="p">,</span>
                <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="n">metrics_df</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">WorkflowSetResults</span><span class="p">(</span>
            <span class="n">results</span><span class="o">=</span><span class="n">all_results</span><span class="p">,</span>
            <span class="n">workflow_set</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_fit_single_workflow_nested</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wf_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">wf</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                                     <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">per_group_prep</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                                     <span class="n">min_group_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit single workflow across all groups.</span>

<span class="sd">        Helper function for parallel execution in fit_nested.</span>

<span class="sd">        Args:</span>
<span class="sd">            wf_id: Workflow ID</span>
<span class="sd">            wf: Workflow object</span>
<span class="sd">            data: Training data</span>
<span class="sd">            group_col: Group column name</span>
<span class="sd">            per_group_prep: Per-group preprocessing flag</span>
<span class="sd">            min_group_size: Minimum group size</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (result_dict, error_msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Fit nested workflow (n_jobs=1 to avoid nested parallelism)</span>
            <span class="n">nested_fit</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">fit_nested</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">group_col</span><span class="o">=</span><span class="n">group_col</span><span class="p">,</span>
                <span class="n">per_group_prep</span><span class="o">=</span><span class="n">per_group_prep</span><span class="p">,</span>
                <span class="n">min_group_size</span><span class="o">=</span><span class="n">min_group_size</span><span class="p">,</span>
                <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>

            <span class="c1"># Extract outputs with group column</span>
            <span class="n">outputs</span><span class="p">,</span> <span class="n">coefs</span><span class="p">,</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">nested_fit</span><span class="o">.</span><span class="n">extract_outputs</span><span class="p">()</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;wflow_id&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                <span class="s2">&quot;nested_fit&quot;</span><span class="p">:</span> <span class="n">nested_fit</span><span class="p">,</span>
                <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="n">outputs</span><span class="p">,</span>
                <span class="s2">&quot;coefs&quot;</span><span class="p">:</span> <span class="n">coefs</span><span class="p">,</span>
                <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="n">stats</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2">&#39; failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># Return error result with NaN metrics</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;wflow_id&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                <span class="s2">&quot;nested_fit&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;coefs&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>

<div class="viewcode-block" id="WorkflowSet.fit_nested">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_nested">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_nested</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                   <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                   <span class="n">per_group_prep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">min_group_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
                   <span class="n">n_jobs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowSetNestedResults&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit all workflows across all groups independently (nested/panel modeling).</span>

<span class="sd">        Fits a separate model for each group within each workflow. This allows</span>
<span class="sd">        different groups to have different model parameters and optionally</span>
<span class="sd">        different preprocessing.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Training data with group column</span>
<span class="sd">            group_col: Column name identifying groups</span>
<span class="sd">            per_group_prep: If True, fit separate recipe for each group (default: False)</span>
<span class="sd">            min_group_size: Minimum samples for group-specific prep (default: 30)</span>
<span class="sd">            n_jobs: Number of parallel jobs. None or 1 for sequential execution,</span>
<span class="sd">                    -1 for all CPU cores, or positive integer for specific number of cores.</span>
<span class="sd">            verbose: If True, display progress messages</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowSetNestedResults with group-aware metrics and outputs</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Create workflowset</span>
<span class="sd">            &gt;&gt;&gt; wf_set = WorkflowSet.from_cross(</span>
<span class="sd">            ...     preproc=[&quot;y ~ x1&quot;, &quot;y ~ x1 + x2&quot;],</span>
<span class="sd">            ...     models=[linear_reg(), rand_forest()]</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Fit all workflows on all groups (sequential)</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.fit_nested(train_data, group_col=&#39;country&#39;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Fit with parallel execution</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.fit_nested(train_data, group_col=&#39;country&#39;, n_jobs=-1, verbose=True)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Get metrics by workflow and group</span>
<span class="sd">            &gt;&gt;&gt; metrics = results.collect_metrics(by_group=True)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Rank workflows overall (average across groups)</span>
<span class="sd">            &gt;&gt;&gt; ranked = results.rank_results(&#39;rmse&#39;, by_group=False, n=5)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Get best workflow per group</span>
<span class="sd">            &gt;&gt;&gt; best_by_group = results.extract_best_workflow(&#39;rmse&#39;, by_group=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Prepare work items</span>
        <span class="n">work_items</span> <span class="o">=</span> <span class="p">[(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">per_group_prep</span><span class="p">,</span> <span class="n">min_group_size</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

        <span class="c1"># Validate and resolve n_jobs with warnings</span>
        <span class="n">effective_n_jobs</span> <span class="o">=</span> <span class="n">validate_n_jobs</span><span class="p">(</span><span class="n">n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Windows compatibility check</span>
        <span class="k">if</span> <span class="n">effective_n_jobs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">check_windows_compatibility</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Sequential or parallel execution</span>
        <span class="k">if</span> <span class="n">effective_n_jobs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Sequential execution</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">format_parallel_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="s2">&quot;workflows&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2"> across all groups...&quot;</span><span class="p">)</span>

            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">per_group_prep</span><span class="p">,</span> <span class="n">min_group_size</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">work_items</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">)</span><span class="si">}</span><span class="s2">] Fitting </span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2"> across all groups...&quot;</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_workflow_nested</span><span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">per_group_prep</span><span class="p">,</span> <span class="n">min_group_size</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Parallel execution</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">format_parallel_info</span><span class="p">(</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="s2">&quot;workflows&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2"> across all groups...&quot;</span><span class="p">)</span>

            <span class="n">joblib_verbose</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">get_joblib_backend</span><span class="p">()</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">joblib_verbose</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)(</span>
                <span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_workflow_nested</span><span class="p">)(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">per_group_prep</span><span class="p">,</span> <span class="n">min_group_size</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">per_group_prep</span><span class="p">,</span> <span class="n">min_group_size</span> <span class="ow">in</span> <span class="n">work_items</span>
            <span class="p">)</span>

        <span class="c1"># Process results</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result_dict</span><span class="p">,</span> <span class="n">error_msg</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">all_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_dict</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="c1"># Print errors</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">successful</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">all_results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nested_fit&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Nested fitting complete: </span><span class="si">{</span><span class="n">successful</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> workflows successful&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">WorkflowSetNestedResults</span><span class="p">(</span>
            <span class="n">results</span><span class="o">=</span><span class="n">all_results</span><span class="p">,</span>
            <span class="n">workflow_set</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">group_col</span><span class="o">=</span><span class="n">group_col</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="WorkflowSet.fit_global">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_global">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                   <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowSetResults&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit all workflows globally with group as a feature.</span>

<span class="sd">        Fits a single model per workflow using all groups, with the group</span>
<span class="sd">        column included as a predictor. This assumes groups share similar</span>
<span class="sd">        patterns and can be modeled together.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Training data with group column</span>
<span class="sd">            group_col: Column name identifying groups</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowSetResults containing global fits</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Create workflowset</span>
<span class="sd">            &gt;&gt;&gt; wf_set = WorkflowSet.from_cross(</span>
<span class="sd">            ...     preproc=[&quot;y ~ x1&quot;, &quot;y ~ x1 + x2&quot;],</span>
<span class="sd">            ...     models=[linear_reg(), rand_forest()]</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Fit all workflows globally</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.fit_global(train_data, group_col=&#39;country&#39;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Collect metrics</span>
<span class="sd">            &gt;&gt;&gt; metrics = results.collect_metrics()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitting </span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2"> globally with group feature...&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Fit global workflow</span>
                <span class="n">global_fit</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">fit_global</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group_col</span><span class="o">=</span><span class="n">group_col</span><span class="p">)</span>

                <span class="c1"># Extract outputs</span>
                <span class="n">outputs</span><span class="p">,</span> <span class="n">coefs</span><span class="p">,</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">global_fit</span><span class="o">.</span><span class="n">extract_outputs</span><span class="p">()</span>

                <span class="n">all_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;wflow_id&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                    <span class="s2">&quot;fit&quot;</span><span class="p">:</span> <span class="n">global_fit</span><span class="p">,</span>
                    <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="n">stats</span><span class="p">,</span>
                    <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="n">outputs</span><span class="p">,</span>
                    <span class="s2">&quot;coefs&quot;</span><span class="p">:</span> <span class="n">coefs</span>
                <span class="p">})</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Error fitting </span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">all_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;wflow_id&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                    <span class="s2">&quot;fit&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;coefs&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">WorkflowSetResults</span><span class="p">(</span>
            <span class="n">results</span><span class="o">=</span><span class="n">all_results</span><span class="p">,</span>
            <span class="n">workflow_set</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_fit_single_workflow_group_resamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wf_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">wf</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                              <span class="n">cv_splits</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                              <span class="n">metrics</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit single workflow on single group&#39;s CV splits.</span>

<span class="sd">        Helper function for parallel execution in fit_nested_resamples.</span>

<span class="sd">        Args:</span>
<span class="sd">            wf_id: Workflow ID</span>
<span class="sd">            wf: Workflow object</span>
<span class="sd">            group_name: Group name</span>
<span class="sd">            cv_splits: CV splits for this group</span>
<span class="sd">            group_col: Group column name</span>
<span class="sd">            metrics: Metric set</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (result_dict, error_msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Drop group column from CV splits to prevent it from being passed to models</span>
            <span class="c1"># This is critical for supervised feature selection steps</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">py_rsample</span><span class="w"> </span><span class="kn">import</span> <span class="n">Split</span><span class="p">,</span> <span class="n">RSplit</span>

            <span class="n">cv_splits_no_group</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rsplit</span> <span class="ow">in</span> <span class="n">cv_splits</span><span class="p">:</span>
                <span class="c1"># Get original data and drop group column</span>
                <span class="n">data_no_group</span> <span class="o">=</span> <span class="n">rsplit</span><span class="o">.</span><span class="n">_split</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">group_col</span><span class="p">])</span>

                <span class="c1"># Create new Split with modified data (same indices)</span>
                <span class="n">new_split</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">data_no_group</span><span class="p">,</span>
                    <span class="n">in_id</span><span class="o">=</span><span class="n">rsplit</span><span class="o">.</span><span class="n">_split</span><span class="o">.</span><span class="n">in_id</span><span class="p">,</span>
                    <span class="n">out_id</span><span class="o">=</span><span class="n">rsplit</span><span class="o">.</span><span class="n">_split</span><span class="o">.</span><span class="n">out_id</span><span class="p">,</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">rsplit</span><span class="o">.</span><span class="n">_split</span><span class="o">.</span><span class="n">id</span>
                <span class="p">)</span>

                <span class="c1"># Wrap in RSplit</span>
                <span class="n">cv_splits_no_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RSplit</span><span class="p">(</span><span class="n">new_split</span><span class="p">))</span>

            <span class="c1"># Evaluate workflow on this group&#39;s CV splits (without group column, n_jobs=1 to avoid nested parallelism)</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">py_tune</span><span class="w"> </span><span class="kn">import</span> <span class="n">fit_resamples</span> <span class="k">as</span> <span class="n">tune_fit_resamples</span>
            <span class="n">cv_results</span> <span class="o">=</span> <span class="n">tune_fit_resamples</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">resamples</span><span class="o">=</span><span class="n">cv_splits_no_group</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Extract metrics (fold-level)</span>
            <span class="n">fold_metrics</span> <span class="o">=</span> <span class="n">cv_results</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">()</span>

            <span class="c1"># Add metadata columns</span>
            <span class="n">fold_metrics</span><span class="p">[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_id</span>
            <span class="n">fold_metrics</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_name</span>

            <span class="c1"># Add fold column if not present</span>
            <span class="k">if</span> <span class="s1">&#39;fold&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fold_metrics</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">fold_metrics</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">fold_metrics</span><span class="p">[</span><span class="s1">&#39;fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_metrics</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;wflow_id&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="n">group_name</span><span class="p">,</span>
                <span class="s2">&quot;cv_results&quot;</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">,</span>
                <span class="s2">&quot;fold_metrics&quot;</span><span class="p">:</span> <span class="n">fold_metrics</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2">&#39;, Group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>

<div class="viewcode-block" id="WorkflowSet.fit_nested_resamples">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_nested_resamples">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_nested_resamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">resamples</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                            <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">metrics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">n_jobs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowSetNestedResamples&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit all workflows per group using pre-defined CV splits.</span>

<span class="sd">        Evaluates all workflows on pre-created CV splits for each group.</span>
<span class="sd">        This provides robust per-group model evaluation with full control</span>
<span class="sd">        over CV strategy.</span>

<span class="sd">        Args:</span>
<span class="sd">            resamples: Dict mapping group names to CV split objects</span>
<span class="sd">                      Example: {&#39;USA&#39;: cv_usa, &#39;Germany&#39;: cv_germany, ...}</span>
<span class="sd">            group_col: Name of the column identifying groups</span>
<span class="sd">            metrics: Metric set for evaluation</span>
<span class="sd">            n_jobs: Number of parallel jobs. None or 1 for sequential execution,</span>
<span class="sd">                    -1 for all CPU cores, or positive integer for specific number of cores.</span>
<span class="sd">            verbose: If True, print detailed progress (workflow, group, fold)</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowSetNestedResamples with group-aware CV results</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Create CV splits per group</span>
<span class="sd">            &gt;&gt;&gt; from py_rsample import time_series_cv</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; cv_by_group = {}</span>
<span class="sd">            &gt;&gt;&gt; for country in [&#39;USA&#39;, &#39;Germany&#39;, &#39;Japan&#39;]:</span>
<span class="sd">            ...     country_data = data[data[&#39;country&#39;] == country]</span>
<span class="sd">            ...     cv_by_group[country] = time_series_cv(</span>
<span class="sd">            ...         country_data,</span>
<span class="sd">            ...         date_column=&#39;date&#39;,</span>
<span class="sd">            ...         initial=&#39;4 years&#39;,</span>
<span class="sd">            ...         assess=&#39;1 year&#39;</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Evaluate all workflows on each group&#39;s CV splits (sequential)</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.fit_nested_resamples(</span>
<span class="sd">            ...     resamples=cv_by_group,</span>
<span class="sd">            ...     group_col=&#39;country&#39;,</span>
<span class="sd">            ...     metrics=metric_set(rmse, mae),</span>
<span class="sd">            ...     verbose=True</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Parallel execution</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.fit_nested_resamples(</span>
<span class="sd">            ...     resamples=cv_by_group,</span>
<span class="sd">            ...     group_col=&#39;country&#39;,</span>
<span class="sd">            ...     metrics=metric_set(rmse, mae),</span>
<span class="sd">            ...     n_jobs=-1,</span>
<span class="sd">            ...     verbose=True</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Collect and analyze results</span>
<span class="sd">            &gt;&gt;&gt; metrics_by_group = results.collect_metrics(by_group=True)</span>
<span class="sd">            &gt;&gt;&gt; ranked = results.rank_results(&#39;rmse&#39;, by_group=False)</span>
<span class="sd">            &gt;&gt;&gt; best = results.extract_best_workflow(&#39;rmse&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">py_yardstick</span><span class="w"> </span><span class="kn">import</span> <span class="n">metric_set</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">r_squared</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="n">metric_set</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">r_squared</span><span class="p">)</span>

        <span class="n">groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">resamples</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Prepare work items (flatten workflows  groups)</span>
        <span class="n">work_items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">cv_splits</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">cv_splits</span> <span class="ow">in</span> <span class="n">resamples</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="c1"># Validate and resolve n_jobs with warnings</span>
        <span class="n">effective_n_jobs</span> <span class="o">=</span> <span class="n">validate_n_jobs</span><span class="p">(</span><span class="n">n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Windows compatibility check</span>
        <span class="k">if</span> <span class="n">effective_n_jobs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">check_windows_compatibility</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Sequential or parallel execution</span>
        <span class="k">if</span> <span class="n">effective_n_jobs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Sequential execution</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">total_folds</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cv_splits</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv_splits</span> <span class="ow">in</span> <span class="n">resamples</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">)</span><span class="si">}</span><span class="s2"> workflows across </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2"> groups with CV...&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total evaluations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">)</span><span class="si">}</span><span class="s2"> workflows  </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2"> groups  avg </span><span class="si">{</span><span class="n">total_folds</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2"> folds&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">)</span><span class="si">}</span><span class="s2"> workflows across </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2"> groups with CV (sequential)...&quot;</span><span class="p">)</span>

            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">cv_splits</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">work_items</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">wf_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">group_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">group_idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="n">wf_idx</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">)</span><span class="si">}</span><span class="s2">] Workflow: </span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">group_idx</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2">] Group: </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cv_splits</span><span class="p">)</span><span class="si">}</span><span class="s2"> folds)&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_workflow_group_resamples</span><span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">cv_splits</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># No error</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Parallel execution</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">total_folds</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cv_splits</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv_splits</span> <span class="ow">in</span> <span class="n">resamples</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">format_parallel_info</span><span class="p">(</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="s2">&quot;workflow-group combinations&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2"> with CV...&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total evaluations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">)</span><span class="si">}</span><span class="s2"> (workflows  groups)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">format_parallel_info</span><span class="p">(</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="s2">&quot;workflow-group combinations&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2"> with CV...&quot;</span><span class="p">)</span>

            <span class="n">joblib_verbose</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">get_joblib_backend</span><span class="p">()</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">joblib_verbose</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)(</span>
                <span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_workflow_group_resamples</span><span class="p">)(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">cv_splits</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">cv_splits</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">metrics</span> <span class="ow">in</span> <span class="n">work_items</span>
            <span class="p">)</span>

        <span class="c1"># Process results</span>
        <span class="n">all_cv_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result_dict</span><span class="p">,</span> <span class="n">error_msg</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_cv_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_dict</span><span class="p">)</span>

        <span class="c1"># Print errors</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">n_jobs</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> CV evaluation complete: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_cv_results</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">)</span><span class="si">}</span><span class="s2"> successful&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">WorkflowSetNestedResamples</span><span class="p">(</span>
            <span class="n">results</span><span class="o">=</span><span class="n">all_cv_results</span><span class="p">,</span>
            <span class="n">workflow_set</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">group_col</span><span class="o">=</span><span class="n">group_col</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_fit_single_workflow_group_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wf_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                           <span class="n">cv_splits</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                           <span class="n">metrics</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit single global workflow on single group&#39;s CV splits.</span>

<span class="sd">        Helper function for parallel execution in fit_global_resamples().</span>

<span class="sd">        Args:</span>
<span class="sd">            wf_id: Workflow ID</span>
<span class="sd">            wf: Workflow object</span>
<span class="sd">            group_name: Name of the group</span>
<span class="sd">            cv_splits: CV split object for this group</span>
<span class="sd">            data: Full training data</span>
<span class="sd">            group_col: Column name identifying groups</span>
<span class="sd">            metrics: Metric set for evaluation</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (result_dict, error_msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get group data</span>
            <span class="n">group_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">group_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">group_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># For each fold, fit global model and evaluate</span>
            <span class="n">fold_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">fold_num</span><span class="p">,</span> <span class="n">split</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cv_splits</span><span class="o">.</span><span class="n">splits</span><span class="p">):</span>
                <span class="c1"># Extract train/test indices from RSplit object</span>
                <span class="n">train_idx</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">_split</span><span class="o">.</span><span class="n">in_id</span>
                <span class="n">test_idx</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">_split</span><span class="o">.</span><span class="n">out_id</span>

                <span class="c1"># Get fold data (with group_col)</span>
                <span class="n">fold_train</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">fold_test</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="c1"># Fit global workflow on training fold</span>
                <span class="n">fold_fit</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">fit_global</span><span class="p">(</span><span class="n">fold_train</span><span class="p">,</span> <span class="n">group_col</span><span class="o">=</span><span class="n">group_col</span><span class="p">)</span>

                <span class="c1"># Predict on test fold</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">fold_fit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fold_test</span><span class="p">)</span>

                <span class="c1"># Calculate metrics</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">py_yardstick</span><span class="w"> </span><span class="kn">import</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">r_squared</span>
                <span class="n">truth</span> <span class="o">=</span> <span class="n">fold_test</span><span class="p">[</span><span class="n">fold_fit</span><span class="o">.</span><span class="n">extract_formula</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

                <span class="k">for</span> <span class="n">metric_fn</span> <span class="ow">in</span> <span class="p">[</span><span class="n">rmse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">r_squared</span><span class="p">]:</span>
                    <span class="n">result_df</span> <span class="o">=</span> <span class="n">metric_fn</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">predictions</span><span class="p">[</span><span class="s1">&#39;.pred&#39;</span><span class="p">])</span>
                    <span class="n">metric_name</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span>
                    <span class="n">metric_value</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

                    <span class="n">fold_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;wflow_id&#39;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                        <span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="n">group_name</span><span class="p">,</span>
                        <span class="s1">&#39;fold&#39;</span><span class="p">:</span> <span class="n">fold_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">metric_value</span>
                    <span class="p">})</span>

            <span class="n">fold_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fold_results</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;wflow_id&quot;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="n">group_name</span><span class="p">,</span>
                <span class="s2">&quot;cv_results&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Not using standard fit_resamples</span>
                <span class="s2">&quot;fold_metrics&quot;</span><span class="p">:</span> <span class="n">fold_metrics_df</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2">&#39;, Group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>

<div class="viewcode-block" id="WorkflowSet.fit_global_resamples">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSet.fit_global_resamples">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_global_resamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                            <span class="n">resamples</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                            <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">metrics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">n_jobs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowSetNestedResamples&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit all workflows globally (with group as feature) using pre-defined per-group CV.</span>

<span class="sd">        Evaluates global models (with group as a feature) on pre-created CV splits</span>
<span class="sd">        for each group. This shows how a global model performs per-group.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Full training data with group column</span>
<span class="sd">            resamples: Dict mapping group names to CV split objects</span>
<span class="sd">                      Example: {&#39;USA&#39;: cv_usa, &#39;Germany&#39;: cv_germany, ...}</span>
<span class="sd">            group_col: Column name identifying groups</span>
<span class="sd">            metrics: Metric set for evaluation</span>
<span class="sd">            n_jobs: Number of parallel jobs. None or 1 for sequential,</span>
<span class="sd">                   -1 for all cores, or positive integer for specific cores.</span>
<span class="sd">            verbose: If True, display progress messages</span>

<span class="sd">        Returns:</span>
<span class="sd">            WorkflowSetNestedResamples with per-group CV results for global models</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Create CV splits per group</span>
<span class="sd">            &gt;&gt;&gt; from py_rsample import time_series_cv</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; cv_by_group = {}</span>
<span class="sd">            &gt;&gt;&gt; for country in [&#39;USA&#39;, &#39;Germany&#39;, &#39;Japan&#39;]:</span>
<span class="sd">            ...     country_data = data[data[&#39;country&#39;] == country]</span>
<span class="sd">            ...     cv_by_group[country] = time_series_cv(</span>
<span class="sd">            ...         country_data,</span>
<span class="sd">            ...         date_column=&#39;date&#39;,</span>
<span class="sd">            ...         initial=&#39;4 years&#39;,</span>
<span class="sd">            ...         assess=&#39;1 year&#39;</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Evaluate global workflows per-group (sequential)</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.fit_global_resamples(</span>
<span class="sd">            ...     data=data,</span>
<span class="sd">            ...     resamples=cv_by_group,</span>
<span class="sd">            ...     group_col=&#39;country&#39;,</span>
<span class="sd">            ...     metrics=metric_set(rmse, mae)</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Evaluate global workflows per-group (parallel)</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.fit_global_resamples(</span>
<span class="sd">            ...     data=data,</span>
<span class="sd">            ...     resamples=cv_by_group,</span>
<span class="sd">            ...     group_col=&#39;country&#39;,</span>
<span class="sd">            ...     metrics=metric_set(rmse, mae),</span>
<span class="sd">            ...     n_jobs=4,</span>
<span class="sd">            ...     verbose=True</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Compare performance across groups</span>
<span class="sd">            &gt;&gt;&gt; metrics_by_group = results.collect_metrics(by_group=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">py_yardstick</span><span class="w"> </span><span class="kn">import</span> <span class="n">metric_set</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">r_squared</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="n">metric_set</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">r_squared</span><span class="p">)</span>

        <span class="n">groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">resamples</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Prepare work items: workflows  groups</span>
        <span class="n">work_items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">resamples</span><span class="p">[</span><span class="n">group_name</span><span class="p">],</span> <span class="n">data</span><span class="p">,</span> <span class="n">group_col</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">groups</span>
        <span class="p">]</span>

        <span class="c1"># Validate and resolve n_jobs with warnings</span>
        <span class="n">effective_n_jobs</span> <span class="o">=</span> <span class="n">validate_n_jobs</span><span class="p">(</span><span class="n">n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Windows compatibility check</span>
        <span class="k">if</span> <span class="n">effective_n_jobs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">check_windows_compatibility</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Sequential or parallel execution</span>
        <span class="k">if</span> <span class="n">effective_n_jobs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">format_parallel_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="s2">&quot;global workflow evaluations&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2"> with per-group CV across </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2"> groups...&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total evaluations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">)</span><span class="si">}</span><span class="s2"> (workflows  groups)&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>

            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">cv_splits</span><span class="p">,</span> <span class="n">data_item</span><span class="p">,</span> <span class="n">group_col_item</span><span class="p">,</span> <span class="n">metrics_item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">work_items</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_workflow_group_global</span><span class="p">(</span>
                    <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">cv_splits</span><span class="p">,</span> <span class="n">data_item</span><span class="p">,</span> <span class="n">group_col_item</span><span class="p">,</span> <span class="n">metrics_item</span>
                <span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">workflow_num</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">group_num</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">workflow_num</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workflows</span><span class="p">)</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2"> - [</span><span class="si">{</span><span class="n">group_num</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">format_parallel_info</span><span class="p">(</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">),</span> <span class="s2">&quot;global workflow evaluations&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s2"> with per-group CV across </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2"> groups...&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total evaluations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">work_items</span><span class="p">)</span><span class="si">}</span><span class="s2"> (workflows  groups)&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>

            <span class="n">joblib_verbose</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">get_joblib_backend</span><span class="p">()</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">effective_n_jobs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">joblib_verbose</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)(</span>
                <span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_workflow_group_global</span><span class="p">)(</span>
                    <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">cv_splits</span><span class="p">,</span> <span class="n">data_item</span><span class="p">,</span> <span class="n">group_col_item</span><span class="p">,</span> <span class="n">metrics_item</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">wf_id</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">cv_splits</span><span class="p">,</span> <span class="n">data_item</span><span class="p">,</span> <span class="n">group_col_item</span><span class="p">,</span> <span class="n">metrics_item</span> <span class="ow">in</span> <span class="n">work_items</span>
            <span class="p">)</span>

        <span class="c1"># Process results</span>
        <span class="n">all_cv_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span><span class="p">,</span> <span class="n">error_msg</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_cv_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># Print errors if any</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Warning: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Global CV evaluation complete: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_cv_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> successful&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">WorkflowSetNestedResamples</span><span class="p">(</span>
            <span class="n">results</span><span class="o">=</span><span class="n">all_cv_results</span><span class="p">,</span>
            <span class="n">workflow_set</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">group_col</span><span class="o">=</span><span class="n">group_col</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="WorkflowSetResults">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WorkflowSetResults</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Results from fitting a WorkflowSet.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        results: List of dictionaries containing results for each workflow</span>
<span class="sd">        workflow_set: The original WorkflowSet</span>
<span class="sd">        metrics: The metric set used for evaluation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">workflow_set</span><span class="p">:</span> <span class="n">WorkflowSet</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">Any</span>

<div class="viewcode-block" id="WorkflowSetResults.collect_metrics">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.collect_metrics">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">collect_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summarize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect all metrics from all workflows.</span>

<span class="sd">        Args:</span>
<span class="sd">            summarize: If True, return mean and std across resamples.</span>
<span class="sd">                      If False, return raw metrics from each resample.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with metrics for all workflows</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; metrics_df = results.collect_metrics()</span>
<span class="sd">            &gt;&gt;&gt; metrics_df.head()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_metrics</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">wf_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Add workflow ID if not already present</span>
            <span class="k">if</span> <span class="s2">&quot;wflow_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_id</span>

            <span class="n">all_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics_df</span><span class="p">)</span>

        <span class="n">combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">summarize</span><span class="p">:</span>
            <span class="c1"># Convert value column to numeric</span>
            <span class="n">combined</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">combined</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

            <span class="c1"># Summarize by taking mean and std across resamples</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="n">combined</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;metric&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span>
                <span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span>
            <span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="c1"># Add workflow info</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workflow_set</span><span class="o">.</span><span class="n">info</span><span class="p">[[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]],</span>
                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">summary</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">combined</span></div>


<div class="viewcode-block" id="WorkflowSetResults.collect_predictions">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.collect_predictions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">collect_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect all predictions from all workflows.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with predictions for all workflows</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_preds</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">wf_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span>
            <span class="n">tune_results</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tune_results&quot;</span><span class="p">]</span>

            <span class="n">preds_df</span> <span class="o">=</span> <span class="n">tune_results</span><span class="o">.</span><span class="n">collect_predictions</span><span class="p">()</span>
            <span class="n">preds_df</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_id</span>

            <span class="n">all_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds_df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_preds</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="WorkflowSetResults.rank_results">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.rank_results">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rank_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">rank_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">select_best</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rank workflows by a specific metric.</span>

<span class="sd">        Args:</span>
<span class="sd">            rank_metric: Metric name to rank by (e.g., &quot;rmse&quot;) - deprecated, use &#39;metric&#39; instead</span>
<span class="sd">            metric: Metric name to rank by (e.g., &quot;rmse&quot;)</span>
<span class="sd">            select_best: If True, return only the best workflow per model type</span>
<span class="sd">            n: Number of top workflows to return (if select_best=False)</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with ranked workflows (wide format with metric-specific columns)</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Get top 5 workflows by RMSE</span>
<span class="sd">            &gt;&gt;&gt; top5 = results.rank_results(metric=&quot;rmse&quot;, n=5)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Get best workflow for each model type</span>
<span class="sd">            &gt;&gt;&gt; best = results.rank_results(metric=&quot;rmse&quot;, select_best=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle both &#39;metric&#39; and &#39;rank_metric&#39; parameter names</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rank_metric</span> <span class="o">=</span> <span class="n">metric</span>
        <span class="k">elif</span> <span class="n">rank_metric</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either &#39;metric&#39; or &#39;rank_metric&#39; parameter&quot;</span><span class="p">)</span>

        <span class="c1"># Get summarized metrics</span>
        <span class="n">metrics_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">summarize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Pivot to wide format: one column per metric (rmse_mean, mae_mean, etc.)</span>
        <span class="n">wide_metrics</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">],</span>
            <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;metric&quot;</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Flatten multi-level columns: (mean, rmse) -&gt; rmse_mean</span>
        <span class="n">wide_metrics</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">wide_metrics</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">wide_metrics</span> <span class="o">=</span> <span class="n">wide_metrics</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Determine if we want to minimize or maximize</span>
        <span class="n">minimize_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rmse&quot;</span><span class="p">,</span> <span class="s2">&quot;mae&quot;</span><span class="p">,</span> <span class="s2">&quot;mape&quot;</span><span class="p">,</span> <span class="s2">&quot;smape&quot;</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">,</span> <span class="s2">&quot;log_loss&quot;</span><span class="p">,</span> <span class="s2">&quot;brier_score&quot;</span><span class="p">}</span>
        <span class="n">ascending</span> <span class="o">=</span> <span class="n">rank_metric</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">minimize_metrics</span>

        <span class="c1"># Sort by the specified metric mean</span>
        <span class="n">sort_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rank_metric</span><span class="si">}</span><span class="s2">_mean&quot;</span>
        <span class="k">if</span> <span class="n">sort_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wide_metrics</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metric &#39;</span><span class="si">{</span><span class="n">rank_metric</span><span class="si">}</span><span class="s2">&#39; not found in results&quot;</span><span class="p">)</span>

        <span class="n">wide_metrics</span> <span class="o">=</span> <span class="n">wide_metrics</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sort_col</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">select_best</span><span class="p">:</span>
            <span class="c1"># Get best workflow for each model type</span>
            <span class="n">wide_metrics</span> <span class="o">=</span> <span class="n">wide_metrics</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">wide_metrics</span> <span class="o">=</span> <span class="n">wide_metrics</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sort_col</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get top n</span>
            <span class="n">wide_metrics</span> <span class="o">=</span> <span class="n">wide_metrics</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="c1"># Add rank column</span>
        <span class="n">wide_metrics</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wide_metrics</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">wide_metrics</span></div>


<div class="viewcode-block" id="WorkflowSetResults.autoplot">
<a class="viewcode-back" href="../../api/workflowsets.html#py_workflowsets.WorkflowSetResults.autoplot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">select_best</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot workflow comparison results.</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Metric to plot (if None, plots first metric)</span>
<span class="sd">            select_best: If True, show only best workflow per model</span>
<span class="sd">            top_n: Number of top workflows to show</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib Figure object</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; fig = results.autoplot(&quot;rmse&quot;, top_n=10)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get summarized metrics</span>
        <span class="n">metrics_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">summarize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Determine metric to plot</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Filter for the specified metric</span>
        <span class="n">metric_data</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="p">[</span><span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Determine ordering</span>
        <span class="n">minimize_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rmse&quot;</span><span class="p">,</span> <span class="s2">&quot;mae&quot;</span><span class="p">,</span> <span class="s2">&quot;mape&quot;</span><span class="p">,</span> <span class="s2">&quot;smape&quot;</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">,</span> <span class="s2">&quot;log_loss&quot;</span><span class="p">,</span> <span class="s2">&quot;brier_score&quot;</span><span class="p">}</span>
        <span class="n">ascending</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">minimize_metrics</span>

        <span class="n">metric_data</span> <span class="o">=</span> <span class="n">metric_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">select_best</span><span class="p">:</span>
            <span class="n">metric_data</span> <span class="o">=</span> <span class="n">metric_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">metric_data</span> <span class="o">=</span> <span class="n">metric_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metric_data</span> <span class="o">=</span> <span class="n">metric_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>

        <span class="c1"># Create plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_data</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">)))</span>

        <span class="c1"># Create bar plot with error bars</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metric_data</span><span class="p">))</span>
        <span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">metric_data</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">metric_data</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">],</span>
                       <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

        <span class="c1"># Color by model type</span>
        <span class="n">model_types</span> <span class="o">=</span> <span class="n">metric_data</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set3</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_types</span><span class="p">)))</span>
        <span class="n">color_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">model_types</span><span class="p">,</span> <span class="n">colors</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metric_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
            <span class="n">bars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]])</span>

        <span class="c1"># Set labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">metric_data</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> (mean  std)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Workflow Comparison: </span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>  <span class="c1"># Best at top</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="c1"># Add legend</span>
        <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color_map</span><span class="p">[</span><span class="n">model</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_types</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">model_types</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Model Type&quot;</span><span class="p">,</span>
                 <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span></div>
</div>



<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WorkflowSetNestedResults</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Results from fitting WorkflowSet with fit_nested().</span>

<span class="sd">    Provides group-aware metrics and results analysis across all workflows</span>
<span class="sd">    and all groups.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        results: List of nested fit results per workflow</span>
<span class="sd">        workflow_set: The original WorkflowSet</span>
<span class="sd">        group_col: Grouping column name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">workflow_set</span><span class="p">:</span> <span class="n">WorkflowSet</span>
    <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by_group</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect metrics across all workflows and groups.</span>

<span class="sd">        Args:</span>
<span class="sd">            by_group: If True, return metrics per workflow per group.</span>
<span class="sd">                     If False, return metrics per workflow (averaged across groups).</span>
<span class="sd">            split: Data split to include - &quot;train&quot;, &quot;test&quot;, or &quot;all&quot; (default: &quot;all&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with metrics</span>

<span class="sd">            If by_group=True:</span>
<span class="sd">                Columns: wflow_id, group, metric, value, split, preprocessor, model</span>

<span class="sd">            If by_group=False:</span>
<span class="sd">                Columns: wflow_id, metric, mean, std, n, split, preprocessor, model</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Get metrics per workflow per group</span>
<span class="sd">            &gt;&gt;&gt; metrics = results.collect_metrics(by_group=True)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Get average metrics per workflow (across groups)</span>
<span class="sd">            &gt;&gt;&gt; avg_metrics = results.collect_metrics(by_group=False)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Get only test metrics</span>
<span class="sd">            &gt;&gt;&gt; test_metrics = results.collect_metrics(by_group=True, split=&#39;test&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_stats</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">wf_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stats&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Skip failed workflows</span>

            <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_id</span>
            <span class="n">all_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_stats</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid results to collect metrics from&quot;</span><span class="p">)</span>

        <span class="n">combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_stats</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Filter by split</span>
        <span class="k">if</span> <span class="n">split</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="n">combined</span><span class="p">[</span><span class="n">combined</span><span class="p">[</span><span class="s2">&quot;split&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">split</span><span class="p">]</span>

        <span class="c1"># Filter to only numeric metrics columns before aggregation</span>
        <span class="c1"># Select only the columns we need to avoid aggregating metadata columns</span>
        <span class="n">required_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="s2">&quot;metric&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;split&quot;</span><span class="p">]</span>
        <span class="n">available_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">required_cols</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">combined</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">combined_filtered</span> <span class="o">=</span> <span class="n">combined</span><span class="p">[</span><span class="n">available_cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">by_group</span><span class="p">:</span>
            <span class="c1"># Return per-group metrics with workflow info</span>
            <span class="n">result_df</span> <span class="o">=</span> <span class="n">combined_filtered</span><span class="p">[[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="s2">&quot;metric&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;split&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Add workflow info</span>
            <span class="n">result_df</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workflow_set</span><span class="o">.</span><span class="n">info</span><span class="p">[[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]],</span>
                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">result_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Average across groups - ensure value column is numeric</span>
            <span class="n">combined_filtered</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">combined_filtered</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

            <span class="c1"># Drop any rows where value couldn&#39;t be converted</span>
            <span class="n">combined_filtered</span> <span class="o">=</span> <span class="n">combined_filtered</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>

            <span class="n">summary</span> <span class="o">=</span> <span class="n">combined_filtered</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;metric&quot;</span><span class="p">,</span> <span class="s2">&quot;split&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span>
                <span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span>
            <span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="c1"># Add workflow info</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workflow_set</span><span class="o">.</span><span class="n">info</span><span class="p">[[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]],</span>
                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">summary</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rank_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
                    <span class="n">by_group</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rank workflows by a specific metric.</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Metric to rank by (e.g., &#39;rmse&#39;, &#39;mae&#39;, &#39;r_squared&#39;)</span>
<span class="sd">            split: Data split to use - &#39;train&#39;, &#39;test&#39;, or &#39;all&#39; (default: &#39;test&#39;)</span>
<span class="sd">            by_group: If True, rank within each group separately.</span>
<span class="sd">                     If False, rank by average across groups.</span>
<span class="sd">            n: Number of top workflows to return per group (default: 10)</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with ranked workflows</span>

<span class="sd">            If by_group=False:</span>
<span class="sd">                Columns: rank, wflow_id, mean, std, n, preprocessor, model</span>

<span class="sd">            If by_group=True:</span>
<span class="sd">                Columns: group, rank, wflow_id, value, preprocessor, model</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Rank workflows overall (average across groups)</span>
<span class="sd">            &gt;&gt;&gt; ranked = results.rank_results(&#39;rmse&#39;, by_group=False, n=5)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Rank workflows within each group</span>
<span class="sd">            &gt;&gt;&gt; ranked_by_group = results.rank_results(&#39;rmse&#39;, by_group=True, n=3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metrics_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">by_group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">)</span>
        <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="p">[</span><span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data found for metric &#39;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&#39; and split &#39;</span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Determine if we want to minimize or maximize</span>
        <span class="n">minimize_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rmse&quot;</span><span class="p">,</span> <span class="s2">&quot;mae&quot;</span><span class="p">,</span> <span class="s2">&quot;mape&quot;</span><span class="p">,</span> <span class="s2">&quot;smape&quot;</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">,</span> <span class="s2">&quot;log_loss&quot;</span><span class="p">,</span> <span class="s2">&quot;brier_score&quot;</span><span class="p">}</span>
        <span class="n">ascending</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">minimize_metrics</span>

        <span class="k">if</span> <span class="n">by_group</span><span class="p">:</span>
            <span class="c1"># Rank within each group</span>
            <span class="n">ranked</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="n">group_data</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="p">[</span><span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">group_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span>
                <span class="n">group_data</span><span class="p">[</span><span class="s2">&quot;rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ranked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">ranked</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[[</span><span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Rank by average across groups</span>
            <span class="n">avg</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span>
                <span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span>
            <span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span>
            <span class="n">avg</span><span class="p">[</span><span class="s2">&quot;rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">avg</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[[</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_best_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                             <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                             <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
                             <span class="n">by_group</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract best performing workflow(s).</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Metric to optimize (e.g., &#39;rmse&#39;, &#39;mae&#39;, &#39;r_squared&#39;)</span>
<span class="sd">            split: Data split to use - &#39;train&#39;, &#39;test&#39;, or &#39;all&#39; (default: &#39;test&#39;)</span>
<span class="sd">            by_group: If True, return best workflow per group.</span>
<span class="sd">                     If False, return single best workflow overall.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If by_group=False: workflow_id (str) - single best workflow overall</span>

<span class="sd">            If by_group=True: DataFrame with columns:</span>
<span class="sd">                group, wflow_id, value, preprocessor, model</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Get single best workflow overall</span>
<span class="sd">            &gt;&gt;&gt; best_wf_id = results.extract_best_workflow(&#39;rmse&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(best_wf_id)  # &#39;formula_1_rf_2&#39;</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Get best workflow per group</span>
<span class="sd">            &gt;&gt;&gt; best_by_group = results.extract_best_workflow(&#39;rmse&#39;, by_group=True)</span>
<span class="sd">            &gt;&gt;&gt; print(best_by_group)</span>
<span class="sd">            &gt;&gt;&gt;   group      wflow_id         value  preprocessor  model</span>
<span class="sd">            &gt;&gt;&gt;   Germany    formula_2_rf_2   1.20   formula       rand_forest</span>
<span class="sd">            &gt;&gt;&gt;   France     formula_3_xgb_3  1.55   formula       boost_tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ranked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank_results</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">by_group</span><span class="o">=</span><span class="n">by_group</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">by_group</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ranked</span><span class="p">[[</span><span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="s2">&quot;wflow_id&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ranked</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect all outputs (actuals, fitted, forecast, residuals) from all workflows.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with outputs from all workflows and groups</span>
<span class="sd">            Columns include: wflow_id, group, actuals, fitted, forecast, residuals, split</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; outputs = results.collect_outputs()</span>
<span class="sd">            &gt;&gt;&gt; # Filter to specific workflow and group</span>
<span class="sd">            &gt;&gt;&gt; wf_group = outputs[</span>
<span class="sd">            ...     (outputs[&#39;wflow_id&#39;] == &#39;formula_1_rf_2&#39;) &amp;</span>
<span class="sd">            ...     (outputs[&#39;group&#39;] == &#39;Germany&#39;)</span>
<span class="sd">            ... ]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_outputs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">wf_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Skip failed workflows</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_id</span>
            <span class="n">all_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_outputs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid results to collect outputs from&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_outputs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract all outputs, coefficients, and stats from all workflows.</span>

<span class="sd">        Returns the standard three-DataFrame pattern used throughout py-tidymodels.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (outputs, coefficients, stats) DataFrames:</span>
<span class="sd">            - outputs: Observation-level data (actuals, fitted, forecast, residuals)</span>
<span class="sd">            - coefficients: Model parameters/importances for all workflows and groups</span>
<span class="sd">            - stats: Aggregated metrics for all workflows and groups</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Get all three DataFrames</span>
<span class="sd">            &gt;&gt;&gt; outputs, coefs, stats = results.extract_outputs()</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Filter outputs to specific workflow</span>
<span class="sd">            &gt;&gt;&gt; wf_outputs = outputs[outputs[&#39;wflow_id&#39;] == &#39;formula_1_rf_2&#39;]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Filter coefficients to specific group</span>
<span class="sd">            &gt;&gt;&gt; group_coefs = coefs[coefs[&#39;group&#39;] == &#39;Germany&#39;]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Get test statistics</span>
<span class="sd">            &gt;&gt;&gt; test_stats = stats[stats[&#39;split&#39;] == &#39;test&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Collect outputs</span>
        <span class="n">all_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">wf_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_id</span>

            <span class="c1"># FIX: Ensure generic &#39;group&#39; column matches specific group column</span>
            <span class="c1"># This handles cases where &#39;group&#39; is &#39;global&#39; but self.group_col has actual values</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_col</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;group&#39;</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span>

            <span class="n">all_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_outputs</span><span class="p">:</span>
            <span class="n">outputs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outputs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_outputs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Collect coefficients</span>
        <span class="n">all_coefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">wf_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coefs&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">coefs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">coefs</span> <span class="o">=</span> <span class="n">coefs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">coefs</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_id</span>

            <span class="c1"># FIX: Ensure generic &#39;group&#39; column matches specific group column</span>
            <span class="c1"># This handles cases where &#39;group&#39; is &#39;global&#39; but self.group_col has actual values</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_col</span> <span class="ow">in</span> <span class="n">coefs</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;group&#39;</span> <span class="ow">in</span> <span class="n">coefs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">coefs</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coefs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">group_col</span><span class="p">]</span>

            <span class="n">all_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_coefs</span><span class="p">:</span>
            <span class="n">coefs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coefs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_coefs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Collect stats (use existing collect_metrics with all splits)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stats_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">by_group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># No valid results</span>
            <span class="n">stats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">outputs_df</span><span class="p">,</span> <span class="n">coefs_df</span><span class="p">,</span> <span class="n">stats_df</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_formulas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract actual formulas from all workflows for all groups.</span>

<span class="sd">        Returns a DataFrame showing the ACTUAL formula used by each workflow</span>
<span class="sd">        for each group after all preprocessing. This is critical when using</span>
<span class="sd">        supervised feature selection steps (like step_select_corr, step_select_vif),</span>
<span class="sd">        which may select different features per group.</span>

<span class="sd">        The returned formulas reflect the features that actually made it through</span>
<span class="sd">        preprocessing, not the original formula before feature selection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with columns:</span>
<span class="sd">            - wflow_id: Workflow identifier</span>
<span class="sd">            - group: Group name</span>
<span class="sd">            - formula: Actual formula with features that survived preprocessing</span>
<span class="sd">            - n_features: Number of predictor features</span>
<span class="sd">            - preprocessor: Preprocessor type (formula or recipe)</span>
<span class="sd">            - model: Model type</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Get formulas from all workflows</span>
<span class="sd">            &gt;&gt;&gt; formulas_df = results.extract_formulas()</span>
<span class="sd">            &gt;&gt;&gt; print(formulas_df)</span>
<span class="sd">               wflow_id   group          formula  n_features preprocessor      model</span>
<span class="sd">            0  prep_1...     USA      y ~ x1 + x2           2       recipe  linear_reg</span>
<span class="sd">            1  prep_1... Germany          y ~ x1           1       recipe  linear_reg</span>
<span class="sd">            2  prep_2...     USA  y ~ x1 + x2 + x3           3       recipe rand_forest</span>

<span class="sd">            &gt;&gt;&gt; # Filter to specific workflow</span>
<span class="sd">            &gt;&gt;&gt; wf1_formulas = formulas_df[formulas_df[&#39;wflow_id&#39;] == &#39;prep_1_linear_reg_1&#39;]</span>

<span class="sd">            &gt;&gt;&gt; # Check if formulas differ across groups</span>
<span class="sd">            &gt;&gt;&gt; formulas_df.groupby(&#39;wflow_id&#39;)[&#39;formula&#39;].nunique()</span>

<span class="sd">            &gt;&gt;&gt; # See which groups have different feature counts</span>
<span class="sd">            &gt;&gt;&gt; formulas_df.pivot(index=&#39;wflow_id&#39;, columns=&#39;group&#39;, values=&#39;n_features&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_formulas</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">wf_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">]</span>
            <span class="n">nested_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nested_fit&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">nested_fit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Skip failed workflows</span>

            <span class="c1"># Extract ACTUAL formula from each group&#39;s fit</span>
            <span class="c1"># This shows which features the MODEL actually used (critical for supervised feature selection)</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">wf_fit</span> <span class="ow">in</span> <span class="n">nested_fit</span><span class="o">.</span><span class="n">group_fits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Get original formula for outcome variable name</span>
                    <span class="n">original_formula</span> <span class="o">=</span> <span class="n">wf_fit</span><span class="o">.</span><span class="n">extract_formula</span><span class="p">()</span>
                    <span class="n">outcome_name</span> <span class="o">=</span> <span class="n">original_formula</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                    <span class="c1"># Get ACTUAL feature names from the fitted model</span>
                    <span class="c1"># This is more reliable than preprocessing because it shows what the model ACTUALLY used</span>
                    <span class="n">model_fit</span> <span class="o">=</span> <span class="n">wf_fit</span><span class="o">.</span><span class="n">fit</span>  <span class="c1"># The ModelFit object</span>
                    <span class="n">predictor_cols</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model_fit</span><span class="p">,</span> <span class="s1">&#39;fit_data&#39;</span><span class="p">):</span>
                        <span class="n">fit_data</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">fit_data</span>

                        <span class="c1"># Try sklearn-based engines first (store X_train DataFrame)</span>
                        <span class="k">if</span> <span class="s1">&#39;X_train&#39;</span> <span class="ow">in</span> <span class="n">fit_data</span><span class="p">:</span>
                            <span class="n">X_train</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;X_train&#39;</span><span class="p">]</span>

                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                                <span class="c1"># Get column names from the actual training data used by model</span>
                                <span class="c1"># This reflects what survived ALL preprocessing including feature selection</span>
                                <span class="n">predictor_cols</span> <span class="o">=</span> <span class="p">[</span>
                                    <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span>
                                    <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;Intercept&#39;</span>  <span class="c1"># Exclude patsy&#39;s Intercept column</span>
                                <span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># X_train is array, can&#39;t get column names</span>
                                <span class="n">n_features</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>

                        <span class="c1"># Try time series engines (store exog_vars list)</span>
                        <span class="k">elif</span> <span class="s1">&#39;exog_vars&#39;</span> <span class="ow">in</span> <span class="n">fit_data</span><span class="p">:</span>
                            <span class="n">exog_vars</span> <span class="o">=</span> <span class="n">fit_data</span><span class="p">[</span><span class="s1">&#39;exog_vars&#39;</span><span class="p">]</span>

                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog_vars</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                                <span class="c1"># Time series models store exogenous variable names as list</span>
                                <span class="n">predictor_cols</span> <span class="o">=</span> <span class="n">exog_vars</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># Unexpected format</span>
                                <span class="k">pass</span>

                    <span class="c1"># Fallback if we couldn&#39;t extract features</span>
                    <span class="k">if</span> <span class="n">predictor_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">formula</span> <span class="o">=</span> <span class="n">original_formula</span>
                        <span class="n">n_features</span> <span class="o">=</span> <span class="n">formula</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;+&#39;</span> <span class="ow">in</span> <span class="n">formula</span> <span class="k">else</span> <span class="mi">1</span>

                    <span class="c1"># Reconstruct formula with actual features</span>
                    <span class="k">if</span> <span class="n">predictor_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictor_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">formula</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outcome_name</span><span class="si">}</span><span class="s2"> ~ 1&quot;</span>  <span class="c1"># Intercept only</span>
                            <span class="n">n_features</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">formula</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outcome_name</span><span class="si">}</span><span class="s2"> ~ </span><span class="si">{</span><span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">predictor_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="n">n_features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictor_cols</span><span class="p">)</span>

                    <span class="n">all_formulas</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;wflow_id&#39;</span><span class="p">:</span> <span class="n">wf_id</span><span class="p">,</span>
                        <span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="n">group_name</span><span class="p">,</span>
                        <span class="s1">&#39;formula&#39;</span><span class="p">:</span> <span class="n">formula</span><span class="p">,</span>
                        <span class="s1">&#39;n_features&#39;</span><span class="p">:</span> <span class="n">n_features</span>
                    <span class="p">})</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># If extraction fails, skip this group</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to extract formula for </span><span class="si">{</span><span class="n">wf_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

        <span class="c1"># Create DataFrame</span>
        <span class="n">formulas_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_formulas</span><span class="p">)</span>

        <span class="c1"># Add workflow info from workflow_set</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">formulas_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">formulas_df</span> <span class="o">=</span> <span class="n">formulas_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">workflow_set</span><span class="o">.</span><span class="n">info</span><span class="p">[[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">]],</span>
                <span class="n">on</span><span class="o">=</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span>
                <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">formulas_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
                <span class="n">by_group</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot workflow comparison results.</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Metric to plot (e.g., &#39;rmse&#39;, &#39;mae&#39;)</span>
<span class="sd">            split: Data split to plot - &#39;train&#39;, &#39;test&#39;, or &#39;all&#39;</span>
<span class="sd">            by_group: If True, create separate plot per group.</span>
<span class="sd">                     If False, plot average across groups.</span>
<span class="sd">            top_n: Number of top workflows to show</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib Figure object</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Plot average performance across groups</span>
<span class="sd">            &gt;&gt;&gt; fig = results.autoplot(&#39;rmse&#39;, by_group=False, top_n=10)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Plot performance per group</span>
<span class="sd">            &gt;&gt;&gt; fig = results.autoplot(&#39;rmse&#39;, by_group=True, top_n=5)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">by_group</span><span class="p">:</span>
            <span class="c1"># Create subplot for each group</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">by_group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">)</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="p">[</span><span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric</span><span class="p">]</span>

            <span class="n">groups</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
            <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

            <span class="c1"># Calculate subplot layout</span>
            <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_groups</span><span class="p">)</span>
            <span class="n">n_rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_groups</span> <span class="o">+</span> <span class="n">n_cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">n_cols</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">n_cols</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">n_rows</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">n_groups</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">if</span> <span class="n">n_rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

            <span class="c1"># Determine if we want to minimize or maximize</span>
            <span class="n">minimize_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rmse&quot;</span><span class="p">,</span> <span class="s2">&quot;mae&quot;</span><span class="p">,</span> <span class="s2">&quot;mape&quot;</span><span class="p">,</span> <span class="s2">&quot;smape&quot;</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">,</span> <span class="s2">&quot;log_loss&quot;</span><span class="p">,</span> <span class="s2">&quot;brier_score&quot;</span><span class="p">}</span>
            <span class="n">ascending</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">minimize_metrics</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">group_data</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="p">[</span><span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">group_data</span> <span class="o">=</span> <span class="n">group_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>

                <span class="c1"># Create bar plot</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">group_data</span><span class="p">))</span>
                <span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">group_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

                <span class="c1"># Color by model type</span>
                <span class="n">model_types</span> <span class="o">=</span> <span class="n">group_data</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set3</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_types</span><span class="p">)))</span>
                <span class="n">color_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">model_types</span><span class="p">,</span> <span class="n">colors</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
                    <span class="n">bars</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]])</span>

                <span class="c1"># Set labels</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">group_data</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

            <span class="c1"># Remove empty subplots</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_groups</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="c1"># Add legend to first subplot</span>
            <span class="k">if</span> <span class="n">n_groups</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color_map</span><span class="p">[</span><span class="n">model</span><span class="p">])</span>
                                  <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_types</span><span class="p">]</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">model_types</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span>
                             <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Workflow Comparison by Group: </span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.00</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Plot average across groups</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">by_group</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">)</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="p">[</span><span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric</span><span class="p">]</span>

            <span class="c1"># Determine if we want to minimize or maximize</span>
            <span class="n">minimize_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rmse&quot;</span><span class="p">,</span> <span class="s2">&quot;mae&quot;</span><span class="p">,</span> <span class="s2">&quot;mape&quot;</span><span class="p">,</span> <span class="s2">&quot;smape&quot;</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">,</span> <span class="s2">&quot;log_loss&quot;</span><span class="p">,</span> <span class="s2">&quot;brier_score&quot;</span><span class="p">}</span>
            <span class="n">ascending</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">minimize_metrics</span>

            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>

            <span class="c1"># Create plot</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics_df</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">)))</span>

            <span class="c1"># Create bar plot with error bars</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics_df</span><span class="p">))</span>
            <span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">],</span>
                          <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

            <span class="c1"># Color by model type</span>
            <span class="n">model_types</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set3</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_types</span><span class="p">)))</span>
            <span class="n">color_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">model_types</span><span class="p">,</span> <span class="n">colors</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
                <span class="n">bars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]])</span>

            <span class="c1"># Set labels</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">metrics_df</span><span class="p">[</span><span class="s2">&quot;wflow_id&quot;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> (mean  std)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Workflow Comparison (Avg Across Groups): </span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

            <span class="c1"># Add legend</span>
            <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color_map</span><span class="p">[</span><span class="n">model</span><span class="p">])</span>
                              <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_types</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">model_types</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Model Type&quot;</span><span class="p">,</span>
                     <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowSetNestedResults&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate all workflows on test data.</span>

<span class="sd">        Calls evaluate() on each nested workflow fit to compute test metrics.</span>
<span class="sd">        Updates the results in place and returns self for method chaining.</span>

<span class="sd">        Args:</span>
<span class="sd">            test_data: Test data DataFrame with group column</span>

<span class="sd">        Returns:</span>
<span class="sd">            Self (for method chaining)</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Fit on training data</span>
<span class="sd">            &gt;&gt;&gt; results = wf_set.fit_nested(train_data, group_col=&#39;country&#39;)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Evaluate on test data</span>
<span class="sd">            &gt;&gt;&gt; results = results.evaluate(test_data)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Now collect_metrics includes both train and test splits</span>
<span class="sd">            &gt;&gt;&gt; metrics = results.collect_metrics(split=&#39;test&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">):</span>
            <span class="n">nested_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nested_fit&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">nested_fit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Skip failed workflows</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Evaluate nested workflow on test data</span>
                <span class="n">evaluated_fit</span> <span class="o">=</span> <span class="n">nested_fit</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

                <span class="c1"># Extract updated outputs with test metrics</span>
                <span class="n">outputs</span><span class="p">,</span> <span class="n">coefs</span><span class="p">,</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">evaluated_fit</span><span class="o">.</span><span class="n">extract_outputs</span><span class="p">()</span>

                <span class="c1"># Update result with evaluated fit and new outputs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;nested_fit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluated_fit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;outputs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;coefs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coefs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Error evaluating </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Keep original results if evaluation fails</span>

        <span class="k">return</span> <span class="bp">self</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WorkflowSetNestedResamples</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Results from fit_nested_resamples() or fit_global_resamples().</span>

<span class="sd">    Contains CV evaluation results for each workflow across each group.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        results: List of dictionaries with CV results per (workflow, group)</span>
<span class="sd">        workflow_set: The original WorkflowSet</span>
<span class="sd">        group_col: Name of the group column</span>
<span class="sd">        metrics: The metric set used for evaluation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">workflow_set</span><span class="p">:</span> <span class="n">WorkflowSet</span>
    <span class="n">group_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">Any</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by_group</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">summarize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect metrics from CV evaluations.</span>

<span class="sd">        Args:</span>
<span class="sd">            by_group: If True, return metrics per group; if False, average across groups</span>
<span class="sd">            summarize: If True, average across CV folds; if False, return fold-level metrics</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with metrics</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Average metrics per group</span>
<span class="sd">            &gt;&gt;&gt; metrics_by_group = results.collect_metrics(by_group=True, summarize=True)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Average across all groups</span>
<span class="sd">            &gt;&gt;&gt; metrics_overall = results.collect_metrics(by_group=False, summarize=True)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Fold-level metrics per group</span>
<span class="sd">            &gt;&gt;&gt; fold_metrics = results.collect_metrics(by_group=True, summarize=False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_metrics</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">fold_metrics</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;fold_metrics&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">summarize</span><span class="p">:</span>
                <span class="c1"># Average across folds</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="n">fold_metrics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;metric&#39;</span><span class="p">])[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="n">summary</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">]</span>
                <span class="n">all_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Keep fold-level detail</span>
                <span class="n">all_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fold_metrics</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_metrics</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">by_group</span> <span class="ow">and</span> <span class="n">summarize</span><span class="p">:</span>
            <span class="c1"># Average across groups</span>
            <span class="n">grouped</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;metric&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
                <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span>
            <span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;global&#39;</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">grouped</span>

        <span class="c1"># Add workflow info</span>
        <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workflow_set</span><span class="o">.</span><span class="n">info</span><span class="p">[[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">]],</span>
            <span class="n">on</span><span class="o">=</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span>
            <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">metrics_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rank_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;rmse&#39;</span><span class="p">,</span>
                    <span class="n">by_group</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rank workflows by CV performance.</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Metric to rank by</span>
<span class="sd">            by_group: If True, rank per group; if False, rank overall</span>
<span class="sd">            n: Number of top workflows to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with ranked workflows</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Top 10 workflows overall</span>
<span class="sd">            &gt;&gt;&gt; top_overall = results.rank_results(&#39;rmse&#39;, by_group=False, n=10)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Top 5 workflows per group</span>
<span class="sd">            &gt;&gt;&gt; top_per_group = results.rank_results(&#39;rmse&#39;, by_group=True, n=5)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">by_group</span><span class="o">=</span><span class="n">by_group</span><span class="p">,</span> <span class="n">summarize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Filter to ranking metric</span>
        <span class="n">metric_df</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">by_group</span><span class="p">:</span>
            <span class="c1"># Rank within each group</span>
            <span class="n">metric_df</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
            <span class="n">ranked</span> <span class="o">=</span> <span class="n">metric_df</span><span class="p">[</span><span class="n">metric_df</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Rank overall</span>
            <span class="n">metric_df</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_df</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
            <span class="n">ranked</span> <span class="o">=</span> <span class="n">metric_df</span><span class="p">[</span><span class="n">metric_df</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ranked</span><span class="p">[[</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">]]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_best_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                             <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;rmse&#39;</span><span class="p">,</span>
                             <span class="n">by_group</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract ID of best workflow.</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Metric to use for selection</span>
<span class="sd">            by_group: If True, return best per group; if False, return single best</span>

<span class="sd">        Returns:</span>
<span class="sd">            If by_group=False: workflow ID string</span>
<span class="sd">            If by_group=True: DataFrame with best workflow per group</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Best workflow overall</span>
<span class="sd">            &gt;&gt;&gt; best_id = results.extract_best_workflow(&#39;rmse&#39;, by_group=False)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Best workflow per group</span>
<span class="sd">            &gt;&gt;&gt; best_by_group = results.extract_best_workflow(&#39;rmse&#39;, by_group=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ranked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank_results</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">by_group</span><span class="o">=</span><span class="n">by_group</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">by_group</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ranked</span><span class="p">[[</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ranked</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;rmse&#39;</span><span class="p">,</span>
                <span class="n">by_group</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot CV performance comparison.</span>

<span class="sd">        Args:</span>
<span class="sd">            metric: Metric to plot</span>
<span class="sd">            by_group: If True, separate subplot per group</span>
<span class="sd">            top_n: Number of top workflows to show</span>

<span class="sd">        Returns:</span>
<span class="sd">            Matplotlib figure</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Overall comparison with error bars</span>
<span class="sd">            &gt;&gt;&gt; fig = results.autoplot(&#39;rmse&#39;, by_group=False, top_n=10)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Per-group comparison</span>
<span class="sd">            &gt;&gt;&gt; fig = results.autoplot(&#39;rmse&#39;, by_group=True, top_n=5)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">by_group</span><span class="o">=</span><span class="n">by_group</span><span class="p">,</span> <span class="n">summarize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">metric_df</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">by_group</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">metric_df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_groups</span><span class="p">)</span>
            <span class="n">nrows</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_groups</span> <span class="o">+</span> <span class="n">ncols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">ncols</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">ncols</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">nrows</span><span class="p">))</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">if</span> <span class="n">n_groups</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
                <span class="n">group_df</span> <span class="o">=</span> <span class="n">metric_df</span><span class="p">[</span><span class="n">metric_df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>

                <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">group_df</span><span class="p">)),</span> <span class="n">group_df</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">group_df</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">group_df</span><span class="p">)))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">group_df</span><span class="p">[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

            <span class="c1"># Hide unused subplots</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_groups</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Overall plot</span>
            <span class="n">top_workflows</span> <span class="o">=</span> <span class="n">metric_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">top_n</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_workflows</span><span class="p">)),</span> <span class="n">top_workflows</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">top_workflows</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_workflows</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">top_workflows</span><span class="p">[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1"> (mean  std across CV folds &amp; groups)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Top </span><span class="si">{</span><span class="n">top_n</span><span class="si">}</span><span class="s1"> Workflows by CV </span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compare_train_cv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">train_stats</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                        <span class="n">metrics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compare training metrics with CV metrics to identify overfitting.</span>

<span class="sd">        This helper method combines training performance (from extract_outputs() stats)</span>
<span class="sd">        with CV performance (from collect_metrics()) to provide a comprehensive view</span>
<span class="sd">        of workflow generalization.</span>

<span class="sd">        Args:</span>
<span class="sd">            train_stats: DataFrame from extract_outputs()[2] containing training metrics</span>
<span class="sd">                        Must have columns: wflow_id, group, and metric columns (rmse, mae, r_squared, etc.)</span>
<span class="sd">                        Can be in long format (metric/value columns) or wide format (individual metric columns)</span>
<span class="sd">            metrics: List of metrics to compare (default: [&#39;rmse&#39;, &#39;mae&#39;, &#39;r_squared&#39;])</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with columns:</span>
<span class="sd">                - wflow_id: Workflow identifier</span>
<span class="sd">                - group: Group name</span>
<span class="sd">                - {metric}_train: Training metric value (optimistic, in-sample)</span>
<span class="sd">                - {metric}_cv: CV metric value (realistic, out-of-sample)</span>
<span class="sd">                - {metric}_overfit_ratio: Ratio of CV/train (&gt;1.2 indicates overfitting)</span>
<span class="sd">                - fit_quality: Status flag (&#39; Good Generalization&#39;, &#39; Moderate Overfit&#39;, etc.)</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Get training stats from fitted workflows</span>
<span class="sd">            &gt;&gt;&gt; outputs, coeffs, wfset_stats = wf_set.extract_outputs()</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Compare with CV results</span>
<span class="sd">            &gt;&gt;&gt; comparison = cv_results.compare_train_cv(wfset_stats)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # View workflows with overfitting issues</span>
<span class="sd">            &gt;&gt;&gt; overfit = comparison[comparison[&#39;rmse_overfit_ratio&#39;] &gt; 1.2]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Top workflows by CV performance (per group)</span>
<span class="sd">            &gt;&gt;&gt; best = comparison.sort_values([&#39;group&#39;, &#39;rmse_cv&#39;]).groupby(&#39;group&#39;).head(5)</span>

<span class="sd">        Notes:</span>
<span class="sd">            - Training metrics show in-sample fit (optimistic)</span>
<span class="sd">            - CV metrics show out-of-sample generalization (realistic)</span>
<span class="sd">            - Overfit ratio &gt;1.2 suggests moderate overfitting</span>
<span class="sd">            - Overfit ratio &gt;1.5 suggests severe overfitting</span>
<span class="sd">            - Good models have ratio close to 1.0 (similar train/CV performance)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span> <span class="s1">&#39;mae&#39;</span><span class="p">,</span> <span class="s1">&#39;r_squared&#39;</span><span class="p">]</span>

        <span class="c1"># Check if train_stats is in long format (metric, value columns) or wide format</span>
        <span class="k">if</span> <span class="s1">&#39;metric&#39;</span> <span class="ow">in</span> <span class="n">train_stats</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">train_stats</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># Long format - pivot to wide</span>
            <span class="n">train_wide</span> <span class="o">=</span> <span class="n">train_stats</span><span class="p">[</span><span class="n">train_stats</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">metrics</span><span class="p">)]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">],</span>
                <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Already in wide format</span>
            <span class="n">train_wide</span> <span class="o">=</span> <span class="n">train_stats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Validate required columns exist</span>
        <span class="n">required_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">metrics</span>
        <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">required_cols</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">train_wide</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;train_stats missing required columns: </span><span class="si">{</span><span class="n">missing_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Step 1: Aggregate training metrics (in-sample)</span>
        <span class="n">train_summary</span> <span class="o">=</span> <span class="n">train_wide</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">])[</span><span class="n">metrics</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="s1">&#39;_train&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Step 2: Get CV metrics (out-of-sample) - always test metrics from CV folds</span>
        <span class="n">cv_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">by_group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">summarize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Pivot CV metrics to wide format</span>
        <span class="n">cv_summary</span> <span class="o">=</span> <span class="n">cv_metrics</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">],</span>
            <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Only keep requested metrics, add _cv suffix</span>
        <span class="n">cv_cols_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">cv_summary</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">cv_summary</span> <span class="o">=</span> <span class="n">cv_summary</span><span class="p">[</span><span class="n">cv_cols_to_keep</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Add _cv suffix to metric columns</span>
        <span class="n">rename_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">_cv&quot;</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">cv_summary</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
        <span class="n">cv_summary</span> <span class="o">=</span> <span class="n">cv_summary</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_dict</span><span class="p">)</span>

        <span class="c1"># Step 3: Merge training and CV metrics</span>
        <span class="n">comparison</span> <span class="o">=</span> <span class="n">train_summary</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cv_summary</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;wflow_id&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>

        <span class="c1"># Step 4: Add overfitting indicators for each metric</span>
        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
            <span class="n">train_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">_train&quot;</span>
            <span class="n">cv_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">_cv&quot;</span>

            <span class="k">if</span> <span class="n">train_col</span> <span class="ow">in</span> <span class="n">comparison</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">cv_col</span> <span class="ow">in</span> <span class="n">comparison</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="c1"># For metrics where lower is better (rmse, mae)</span>
                <span class="k">if</span> <span class="n">metric</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span> <span class="s1">&#39;mae&#39;</span><span class="p">,</span> <span class="s1">&#39;mape&#39;</span><span class="p">,</span> <span class="s1">&#39;smape&#39;</span><span class="p">,</span> <span class="s1">&#39;mse&#39;</span><span class="p">]:</span>
                    <span class="n">comparison</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">_overfit_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comparison</span><span class="p">[</span><span class="n">cv_col</span><span class="p">]</span> <span class="o">/</span> <span class="n">comparison</span><span class="p">[</span><span class="n">train_col</span><span class="p">]</span>
                <span class="c1"># For metrics where higher is better (r_squared)</span>
                <span class="k">elif</span> <span class="n">metric</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;r_squared&#39;</span><span class="p">,</span> <span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">]:</span>
                    <span class="n">comparison</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">_generalization_drop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comparison</span><span class="p">[</span><span class="n">train_col</span><span class="p">]</span> <span class="o">-</span> <span class="n">comparison</span><span class="p">[</span><span class="n">cv_col</span><span class="p">]</span>

        <span class="c1"># Step 5: Add overall fit quality status (based on RMSE if available)</span>
        <span class="k">if</span> <span class="s1">&#39;rmse_overfit_ratio&#39;</span> <span class="ow">in</span> <span class="n">comparison</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">comparison</span><span class="p">[</span><span class="s1">&#39;fit_quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comparison</span><span class="p">[</span><span class="s1">&#39;rmse_overfit_ratio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                <span class="s1">&#39; Severe Overfit&#39;</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">1.5</span> <span class="k">else</span>
                <span class="s1">&#39; Moderate Overfit&#39;</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">1.2</span> <span class="k">else</span>
                <span class="s1">&#39; Good Generalization&#39;</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.1</span> <span class="k">else</span>
                <span class="s1">&#39; Normal&#39;</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span>
                <span class="s1">&#39; Unknown&#39;</span>
            <span class="p">)</span>

        <span class="c1"># Step 6: Sort by CV performance (most important metric)</span>
        <span class="n">primary_metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Usually rmse</span>
        <span class="n">cv_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">primary_metric</span><span class="si">}</span><span class="s2">_cv&quot;</span>
        <span class="k">if</span> <span class="n">cv_col</span> <span class="ow">in</span> <span class="n">comparison</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># Sort ascending for metrics where lower is better</span>
            <span class="n">ascending</span> <span class="o">=</span> <span class="n">primary_metric</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span> <span class="s1">&#39;mae&#39;</span><span class="p">,</span> <span class="s1">&#39;mape&#39;</span><span class="p">,</span> <span class="s1">&#39;smape&#39;</span><span class="p">,</span> <span class="s1">&#39;mse&#39;</span><span class="p">]</span>
            <span class="n">comparison</span> <span class="o">=</span> <span class="n">comparison</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">cv_col</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">comparison</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Matthew Deane.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>